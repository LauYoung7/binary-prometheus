"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1477],{19870:(L,h,n)=>{n.d(h,{H:()=>oe});var e=n(68404),d=n(94929),p=n(86647),v=n(2555),g=n(81168),s=n(25e3),c=n(52423),m=n(68183),O=n(81764),P=n(46967),x=n(8944),V=n(72648),N=n(19985);function z({dataSourceName:t,isDefault:a,onDefaultChange:r,onNameChange:o,alertingSupported:l,disabled:i}){return e.createElement(e.Fragment,null,e.createElement(w,{enabled:l}),e.createElement("div",{className:"gf-form-group","aria-label":"Datasource settings page basic settings"},e.createElement("div",{className:"gf-form-inline"},e.createElement("div",{className:"gf-form max-width-30"},e.createElement(O._,{label:"Name",tooltip:`The name is used when you select the data source in panels. The default data source is
              'preselected in new panels.`,grow:!0,disabled:i},e.createElement(P.I,{id:"basic-settings-name",type:"text",value:t,placeholder:"Name",onChange:u=>o(u.currentTarget.value),required:!0,"aria-label":m.wl.pages.DataSource.name}))),e.createElement(O._,{label:"Default",labelWidth:8,disabled:i},e.createElement(x.x,{id:"basic-settings-default",value:a,onChange:u=>{r(u.currentTarget.checked)}})))))}function w({enabled:t}){const a=(0,V.wW)(Y);return e.createElement("div",{className:a.badge},t?e.createElement(N.C,{color:"green",icon:"check-circle",text:"Alerting supported"}):e.createElement(N.C,{color:"orange",icon:"exclamation-triangle",text:"Alerting not supported"}))}const Y=t=>({badge:c.css`
    margin-bottom: ${t.spacing(2)};
  `});var f=n(31403),$=n(77582);function j({canSave:t,canDelete:a,onDelete:r,onSubmit:o,onTest:l,exploreUrl:i}){const u=$.Vt.hasPermission(g.AccessControlAction.DataSourcesExplore);return e.createElement("div",{className:"gf-form-button-row"},e.createElement(f.zx,{variant:"secondary",fill:"solid",type:"button",onClick:()=>history.back()},"Back"),e.createElement(f.Qj,{variant:"secondary",fill:"solid",href:i,disabled:!u},"Explore"),e.createElement(f.zx,{type:"button",variant:"destructive",disabled:!a,onClick:r,"aria-label":m.wl.pages.DataSource.delete},"Delete"),t&&e.createElement(f.zx,{type:"submit",variant:"primary",disabled:!t,onClick:D=>o(D),"aria-label":m.wl.pages.DataSource.saveAndTest},"Save & test"),!t&&e.createElement(f.zx,{variant:"primary",onClick:l},"Test"))}var U=(t=>(t.OpenSource="Open Source",t.Pro="Pro",t.Enterprise="Enterprise",t))(U||{}),S=n(45253),G=n(59796),H=n(47694);const Q="datasources.settings.cloudInfoBox.isDismissed";function X({dataSource:t}){let a="",r="";if(t.readOnly||(t.version??0)>2||H.vc.buildInfo.edition!==U.OpenSource)return null;switch(t.type){case"prometheus":a="Prometheus",r="Loki";break;case"loki":a="Loki",r="Prometheus";break;default:return null}return e.createElement(G.G,{storageKey:Q,defaultValue:!1},(o,l)=>o?null:e.createElement(S.b,{title:`Configure your ${a} data source below`,severity:"info",bottomSpacing:4,onRemove:()=>{l(!0)}},"Or skip the effort and get ",a," (and ",r,") as fully-managed, scalable, and hosted data sources from Grafana Labs with the"," ",e.createElement("a",{className:"external-link",href:`https://grafana.com/signup/cloud/connect-account?src=grafana-oss&cnt=${t.type}-settings`,target:"_blank",rel:"noreferrer",title:"The free plan includes 10k active metrics and 50gb storage."},"free-forever Grafana Cloud plan"),"."))}const Z="This data source was added by config and cannot be modified using the UI. Please contact your server admin to update this data source.";function W(){return e.createElement(S.b,{"aria-label":m.wl.pages.DataSource.readOnly,severity:"info",title:"Provisioned data source"},Z)}function k({dataSourceRights:t,onDelete:a}){const{readOnly:r,hasDeleteRights:o}=t,l=!r&&o,i=()=>history.back();return e.createElement(e.Fragment,null,r&&e.createElement(W,null),e.createElement("div",{className:"gf-form-button-row"},l&&e.createElement(f.zx,{type:"submit",variant:"destructive",onClick:a},"Delete"),e.createElement(f.zx,{variant:"secondary",fill:"outline",type:"button",onClick:i},"Back")))}const J="You are not allowed to modify this data source. Please contact your server admin to update this data source.";function q(){return e.createElement(S.b,{severity:"info",title:"Missing rights"},J)}function _({plugin:t,pageId:a}){if(!t||!t.configPages)return null;const r=t.configPages.find(({id:o})=>o===a);return r?e.createElement(r.body,{plugin:t,query:{}}):e.createElement("div",null,"Page not found: ",r)}var K=n(82897),ee=n(11484);class te extends e.PureComponent{constructor(a){super(a),this.element=null,this.onModelChanged=r=>{this.props.onModelChange(r)},this.scopeProps={ctrl:{datasourceMeta:a.dataSourceMeta,current:(0,K.cloneDeep)(a.dataSource)},onModelChanged:this.onModelChanged},this.onModelChanged=this.onModelChanged.bind(this)}componentDidMount(){const{plugin:a}=this.props;if(this.element&&!a.components.ConfigEditor){const r=(0,ee.w)(),o='<plugin-component type="datasource-config-ctrl" />';this.component=r.load(this.element,this.scopeProps,o)}}componentDidUpdate(a){const{plugin:r}=this.props;!r.components.ConfigEditor&&this.props.dataSource!==a.dataSource&&(this.scopeProps.ctrl.current=(0,K.cloneDeep)(this.props.dataSource),this.component?.digest())}componentWillUnmount(){this.component&&this.component.destroy()}render(){const{plugin:a,dataSource:r}=this.props;return a?e.createElement("div",{ref:o=>this.element=o},a.components.ConfigEditor&&e.createElement(a.components.ConfigEditor,{options:r,onOptionsChange:this.onModelChanged})):null}}var ae=n(81731);function ne({state:t}){return e.createElement("div",{className:"gf-form"},e.createElement("div",{className:"gf-form-label width-10"},"Plugin state"),e.createElement("div",{className:"gf-form-label gf-form-label--transparent"},e.createElement(ae.u,{state:t})))}function re({testingStatus:t}){const a=t?.status==="error",r=t?.message,o=t?.details?.message,l=t?.details?.verboseMessage;return r?e.createElement("div",{className:"gf-form-group p-t-2"},e.createElement(S.b,{severity:a?"error":"success",title:r,"aria-label":m.wl.pages.DataSource.alert},t?.details&&e.createElement(e.Fragment,null,o,l?e.createElement("details",{style:{whiteSpace:"pre-wrap"}},l):null))):null}function oe({uid:t,pageId:a}){(0,s.E)(t);const r=(0,g.useDispatch)(),o=(0,s.wl)(t),l=(0,s.Qs)(o.type),i=(0,s._l)(),u=(0,s.YY)(t),D=(0,s.Rz)(t),T=(0,s.q6)(),B=(0,s.hw)(t),b=(0,s.qj)(),A=E=>r((0,s.yr)(E)),y=E=>r((0,s.BX)(E)),I=E=>r((0,s.rl)(E));return e.createElement(se,{pageId:a,dataSource:o,dataSourceMeta:l,dataSourceSettings:i,dataSourceRights:u,exploreUrl:D,onDelete:T,onDefaultChange:A,onNameChange:y,onOptionsChange:I,onTest:B,onUpdate:b})}function se({pageId:t,dataSource:a,dataSourceMeta:r,dataSourceSettings:o,dataSourceRights:l,exploreUrl:i,onDelete:u,onDefaultChange:D,onNameChange:T,onOptionsChange:B,onTest:b,onUpdate:A}){const{plugin:y,loadError:I,testingStatus:E,loading:le}=o,{readOnly:M,hasWriteRights:R,hasDeleteRights:ce}=l,ie=a.id>0,C=(0,p.F)()?.getInstanceSettings(a.uid),ue=Boolean(C?.meta?.alerting??!1),de=C?.type==="alertmanager",me=ue||de,F=async ge=>{ge.preventDefault(),await A({...a}),b()};return I?e.createElement(k,{dataSourceRights:l,onDelete:u}):le?e.createElement(v.Z,null):!ie||!C?null:t?e.createElement(d.n,{instanceSettings:C},e.createElement(_,{pageId:t,plugin:y})):e.createElement("form",{onSubmit:F},!R&&e.createElement(q,null),M&&e.createElement(W,null),r.state&&e.createElement(ne,{state:r.state}),e.createElement(X,{dataSource:a}),e.createElement(z,{dataSourceName:a.name,isDefault:a.isDefault,onDefaultChange:D,onNameChange:T,alertingSupported:me,disabled:M||!R}),y&&e.createElement(d.n,{instanceSettings:C},e.createElement(te,{plugin:y,dataSource:a,dataSourceMeta:r,onModelChange:B})),e.createElement(re,{testingStatus:E}),e.createElement(j,{onSubmit:F,onDelete:u,onTest:b,exploreUrl:i,canSave:!M&&R,canDelete:!M&&ce}))}},72443:(L,h,n)=>{n.r(h),n.d(h,{EditDataSourcePage:()=>g,default:()=>s});var e=n(68404),d=n(79396),p=n(19870),v=n(25e3);function g(c){const m=c.match.params.uid,P=new URLSearchParams(c.location.search).get("page"),x=(0,v.MF)(m,P);return e.createElement(d.T,{navId:"datasources",pageNav:x.main},e.createElement(d.T.Contents,null,e.createElement(p.H,{uid:m,pageId:P})))}const s=g},81731:(L,h,n)=>{n.d(h,{u:()=>v});var e=n(68404),d=n(24699),p=n(19985);const v=s=>{const c=g(s.state);return c?e.createElement(p.C,{color:c.color,title:c.tooltip,text:c.text,icon:c.icon}):null};function g(s){switch(s){case d.BV.deprecated:return{text:"Deprecated",color:"red",tooltip:"This feature is deprecated and will be removed in a future release"};case d.BV.alpha:return{text:"Alpha",color:"blue",tooltip:"This feature is experimental and future updates might not be backward compatible"};case d.BV.beta:return{text:"Beta",color:"blue",tooltip:"This feature is close to complete but not fully tested"};default:return null}}}}]);

//# sourceMappingURL=EditDataSourcePage.3287fb8ba579ffd11e7e.js.map