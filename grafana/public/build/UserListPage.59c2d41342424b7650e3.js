"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7497,8039],{21038:($,v,t)=>{t.r(v),t.d(v,{default:()=>T});var e=t(52423),l=t(68404),D=t(72648),U=t(72142),A=t(79841),g=t(82002),o=t(79396),i=t(81168),h=t(71221),f=t(68082);function T(){const m=g.Vt.hasAccess(i.AccessControlAction.UsersRead,g.Vt.isGrafanaAdmin),O=g.Vt.hasPermission(i.AccessControlAction.OrgUsersRead),d=(0,D.wW)(P),[E,I]=(0,l.useState)(()=>m?"admin":O?"org":null),L=O&&m;return l.createElement(o.T,{navId:"global-users"},L&&l.createElement(U.J,{className:d.tabsMargin},l.createElement(A.O,{label:"All users",active:E==="admin",onChangeTab:()=>I("admin")}),l.createElement(A.O,{label:"Organization users",active:E==="org",onChangeTab:()=>I("org")})),E==="admin"?l.createElement(f.UserListAdminPageContent,null):l.createElement(h.UsersListPageContent,null))}const P=m=>({tabsMargin:(0,e.css)({marginBottom:m.spacing(3)})})},71221:($,v,t)=>{t.r(v),t.d(v,{UsersListPageContent:()=>j,UsersListPageUnconnected:()=>z,default:()=>ie});var e=t(68404),l=t(36635),D=t(41959),U=t(52081),A=t(78889),g=t(79396),o=t(77582),i=t(94599),h=t(31403),f=t(90336);const T={revokeInvite:f.GY},P=(0,l.connect)(null,T);class m extends e.PureComponent{render(){const{invitee:a,revokeInvite:r}=this.props;return e.createElement("tr",null,e.createElement("td",null,a.email),e.createElement("td",null,a.name),e.createElement("td",{className:"text-right"},e.createElement(i.m,{icon:"copy",variant:"secondary",size:"sm",getText:()=>a.url},"Copy Invite"),"\xA0"),e.createElement("td",null,e.createElement(h.zx,{variant:"destructive",size:"sm",icon:"times",onClick:()=>r(a.code),"aria-label":"Revoke Invite"})))}}const O=P(m);class d extends e.PureComponent{render(){const{invitees:a}=this.props;return e.createElement("table",{className:"filter-table form-inline"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,"Email"),e.createElement("th",null,"Name"),e.createElement("th",null),e.createElement("th",{style:{width:"34px"}}))),e.createElement("tbody",{"data-testid":"InviteesTable-body"},a.map((r,u)=>e.createElement(O,{key:`${r.id}-${u}`,invitee:r}))))}}var E=t(90158),I=t(75804);const{selectAll:L,selectById:s,selectTotal:C}=I.wl,R=(n,a)=>a,G=(0,E.P1)([L,R],(n,a)=>{const r=new RegExp(a,"i");return n.filter(c=>r.test(c.name)||r.test(c.email))});var H=t(14747),J=t(2594),Z=t(81168),Y=t(82897),W=t(54899),X=t(95156),M=t(46002);function p(){return async(n,a)=>{try{const{perPage:r,page:u,searchQuery:c}=a().users,y=await(0,W.i)().get("/api/org/users/search",(0,X.y)({perpage:r,page:u,query:c}));n((0,M.eT)(y))}catch{(0,M.k7)()}}}const w=(0,Y.debounce)(n=>n(p()),300);function _(n){return async a=>{await(0,W.i)().patch(`/api/org/users/${n.userId}`,{role:n.role}),a(p())}}function k(n){return async a=>{await(0,W.i)().delete(`/api/org/users/${n}`),a(p())}}function q(n){return async a=>{a((0,M.tZ)()),a((0,M.PJ)(n)),a(p())}}function ee(n){return async a=>{a((0,M.tZ)()),a((0,M.w4)(n)),w(a)}}const te=n=>{const a=new RegExp(n.searchQuery,"i");return n.users.filter(r=>a.test(r.login)||a.test(r.email)||a.test(r.name))},S=n=>n.searchQuery;function ne(n){return{searchQuery:S(n.users),pendingInvitesCount:C(n.invites),externalUserMngLinkName:n.users.externalUserMngLinkName,externalUserMngLinkUrl:n.users.externalUserMngLinkUrl,canInvite:n.users.canInvite}}const ae={changeSearchQuery:ee},se=(0,l.connect)(ne,ae)(({canInvite:n,externalUserMngLinkName:a,externalUserMngLinkUrl:r,searchQuery:u,pendingInvitesCount:c,changeSearchQuery:y,onShowInvites:x,showInvites:N})=>{const K=[{label:"Users",value:"users"},{label:`Pending Invites (${c})`,value:"invites"}],Q=o.Vt.hasAccess(Z.AccessControlAction.OrgUsersAdd,n);return e.createElement("div",{className:"page-action-bar","data-testid":"users-action-bar"},e.createElement("div",{className:"gf-form gf-form--grow"},e.createElement(H.H,{value:u,onChange:y,placeholder:"Search user by login, email or name"})),c>0&&e.createElement("div",{style:{marginLeft:"1rem"}},e.createElement(J.S,{value:N?"invites":"users",options:K,onChange:x})),Q&&e.createElement(h.Qj,{href:"org/users/invite"},"Invite"),r&&e.createElement(h.Qj,{href:r,target:"_blank",rel:"noopener"},a))});var re=t(68903);function le(n){const a=S(n.users);return{users:te(n.users),searchQuery:S(n.users),page:n.users.page,totalPages:n.users.totalPages,perPage:n.users.perPage,invitees:G(n.invites,a),externalUserMngInfo:n.users.externalUserMngInfo,isLoading:n.users.isLoading}}const oe={loadUsers:p,fetchInvitees:f.nW,changePage:q,updateUser:_,removeUser:k},ce=(0,l.connect)(le,oe),z=({users:n,page:a,totalPages:r,invitees:u,externalUserMngInfo:c,isLoading:y,loadUsers:x,fetchInvitees:N,changePage:K,updateUser:Q,removeUser:me})=>{const[b,Ee]=(0,e.useState)(!1),F=c?(0,D.a)(c):"";(0,e.useEffect)(()=>{x(),N()},[N,x]);const ge=(B,V)=>{Q({...V,role:B})},de=()=>{Ee(!b)},ue=()=>b?e.createElement(d,{invitees:u}):e.createElement(U.wc,{spacing:"md"},e.createElement(re.P,{users:n,orgId:o.Vt.user.orgId,onRoleChange:(B,V)=>ge(B,V),onRemoveUser:B=>me(B.userId)}),e.createElement(U.Lh,{justify:"flex-end"},e.createElement(A.t,{onNavigate:K,currentPage:a,numberOfPages:r,hideWhenSinglePage:!0})));return e.createElement(g.T.Contents,{isLoading:!y},e.createElement(se,{onShowInvites:de,showInvites:b}),F&&e.createElement("div",{className:"grafana-info-box",dangerouslySetInnerHTML:{__html:F}}),y&&ue())},j=ce(z);function ie(){return e.createElement(g.T,{navId:"users"},e.createElement(j,null))}},68903:($,v,t)=>{t.d(v,{P:()=>f});var e=t(68404),l=t(31403),D=t(98102),U=t(66226),A=t(11630),g=t(21731),o=t(77582),i=t(81168),h=t(65135);const f=({users:T,orgId:P,onRoleChange:m,onRemoveUser:O})=>{const[d,E]=(0,e.useState)(null),[I,L]=(0,e.useState)([]);return(0,e.useEffect)(()=>{async function s(){try{if(o.Vt.hasPermission(i.AccessControlAction.ActionRolesList)){let C=await(0,A.ul)(P);L(C)}}catch{console.error("Error loading options")}}o.Vt.licensedAccessControlEnabled()&&s()},[P]),e.createElement(e.Fragment,null,e.createElement("table",{className:"filter-table form-inline"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null),e.createElement("th",null,"Login"),e.createElement("th",null,"Email"),e.createElement("th",null,"Name"),e.createElement("th",null,"Seen"),e.createElement("th",null,"Role"),e.createElement("th",{style:{width:"34px"}}),e.createElement("th",null),e.createElement("th",null))),e.createElement("tbody",null,T.map((s,C)=>e.createElement("tr",{key:`${s.userId}-${C}`},e.createElement("td",{className:"width-2 text-center"},e.createElement("img",{className:"filter-table__avatar",src:s.avatarUrl,alt:"User avatar"})),e.createElement("td",{className:"max-width-6"},e.createElement("span",{className:"ellipsis",title:s.login},s.login)),e.createElement("td",{className:"max-width-5"},e.createElement("span",{className:"ellipsis",title:s.email},s.email)),e.createElement("td",{className:"max-width-5"},e.createElement("span",{className:"ellipsis",title:s.name},s.name)),e.createElement("td",{className:"width-1"},s.lastSeenAtAge),e.createElement("td",{className:"width-8"},o.Vt.licensedAccessControlEnabled()?e.createElement(U.R,{userId:s.userId,orgId:P,roleOptions:I,basicRole:s.role,onBasicRoleChange:R=>m(R,s),basicRoleDisabled:!o.Vt.hasPermissionInMetadata(i.AccessControlAction.OrgUsersWrite,s)}):e.createElement(h.A,{"aria-label":"Role",value:s.role,disabled:!o.Vt.hasPermissionInMetadata(i.AccessControlAction.OrgUsersWrite,s),onChange:R=>m(R,s)})),e.createElement("td",{className:"width-1 text-center"},s.isDisabled&&e.createElement("span",{className:"label label-tag label-tag--gray"},"Disabled")),e.createElement("td",{className:"width-1"},Array.isArray(s.authLabels)&&s.authLabels.length>0&&e.createElement(g.e,{label:s.authLabels[0],removeIcon:!1,count:0})),o.Vt.hasPermissionInMetadata(i.AccessControlAction.OrgUsersRemove,s)&&e.createElement("td",{className:"text-right"},e.createElement(l.zx,{size:"sm",variant:"destructive",onClick:()=>{E(s)},icon:"times","aria-label":"Delete user"})))))),Boolean(d)&&e.createElement(D.s,{body:`Are you sure you want to delete user ${d?.login}?`,confirmText:"Delete",title:"Delete",onDismiss:()=>{E(null)},isOpen:!0,onConfirm:()=>{d&&(O(d),E(null))}}))}}}]);

//# sourceMappingURL=UserListPage.59c2d41342424b7650e3.js.map