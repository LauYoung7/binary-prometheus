(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4251],{95756:(H,N,r)=>{"use strict";r.d(N,{d:()=>D});var l=r(68404),d=r(5916),i=r(81764),R=r(30810);const D=p=>{const{labelWidth:S,editorProps:c,showCACert:O,showKeyPair:g=!0}=p,{secureJsonFields:T}=c.options;return l.createElement(l.Fragment,null,g?l.createElement(i._,{tooltip:l.createElement("span",null,"To authenticate with an TLS/SSL client certificate, provide the client certificate here."),labelWidth:S,label:"TLS/SSL Client Certificate"},l.createElement(R.Zk,{placeholder:"Begins with -----BEGIN CERTIFICATE-----",cols:45,rows:7,isConfigured:T&&T.tlsClientCert,onChange:(0,d.fi)(c,"tlsClientCert"),onReset:()=>{(0,d.Mf)(c,"tlsClientCert")}})):null,O?l.createElement(i._,{tooltip:l.createElement("span",null,"If the selected TLS/SSL mode requires a server root certificate, provide it here."),labelWidth:S,label:"TLS/SSL Root Certificate"},l.createElement(R.Zk,{placeholder:"Begins with -----BEGIN CERTIFICATE-----",cols:45,rows:7,isConfigured:T&&T.tlsCACert,onChange:(0,d.fi)(c,"tlsCACert"),onReset:()=>{(0,d.Mf)(c,"tlsCACert")}})):null,g?l.createElement(i._,{tooltip:l.createElement("span",null,"To authenticate with a client TLS/SSL certificate, provide the key here."),labelWidth:S,label:"TLS/SSL Client Key"},l.createElement(R.Zk,{placeholder:"Begins with -----BEGIN RSA PRIVATE KEY-----",cols:45,rows:7,isConfigured:T&&T.tlsClientKey,onChange:(0,d.fi)(c,"tlsClientKey"),onReset:()=>{(0,d.Mf)(c,"tlsClientKey")}})):null)}},30221:(H,N,r)=>{"use strict";r.r(N),r.d(N,{plugin:()=>oe});var l=r(7238),d=r(44674),i=r(26418),R=r(25748),D=r(13930);function p(e){const t=[];for(const a of e){let n="text";switch(a.type?.toUpperCase()){case"BOOLEAN":case"BOOL":{n="boolean";break}case"BYTES":case"VARCHAR":{n="text";break}case"FLOAT":case"FLOAT64":case"INT":case"INTEGER":case"INT64":case"NUMERIC":case"BIGNUMERIC":{n="number";break}case"DATE":{n="date";break}case"DATETIME":{n="datetime";break}case"TIME":{n="time";break}case"TIMESTAMP":{n="datetime";break}case"GEOGRAPHY":{n="text";break}default:break}t.push({...a,raqbFieldType:n,icon:S(a.type.toUpperCase())})}return t}function S(e){switch(e){case"TIME":case"DATETIME":case"TIMESTAMP":return"clock-nine";case"BOOLEAN":return"toggle-off";case"INTEGER":case"FLOAT":case"FLOAT64":case"INT":case"SMALLINT":case"BIGINT":case"TINYINT":case"BYTEINT":case"INT64":case"NUMERIC":case"DECIMAL":return"calculator-alt";case"CHAR":case"VARCHAR":case"STRING":case"BYTES":case"TEXT":case"TINYTEXT":case"MEDIUMTEXT":case"LONGTEXT":return"text";case"GEOGRAPHY":return"map";default:return}}var c=r(82897),O=r(12936);function g({sql:e,dataset:t,table:a}){let n="";if(!e||!(0,O.IC)(e.columns))return n;if(n+=(0,O.zE)(e.columns),t&&a&&(n+=`FROM ${t}.${a} `),e.whereString&&(n+=`WHERE ${e.whereString} `),e.groupBy?.[0]?.property.name){const o=e.groupBy.map(E=>E.property.name).filter(E=>!(0,c.isEmpty)(E));n+=`GROUP BY ${o.join(", ")} `}return e.orderBy?.property.name&&(n+=`ORDER BY ${e.orderBy.property.name} `),e.orderBy?.property.name&&e.orderByDirection&&(n+=`${e.orderByDirection} `),e.limit!==void 0&&e.limit>=0&&(n+=`LIMIT ${e.limit} `),n}function T(e){return K(e)?e:`\`${e}\``}function K(e){const t=/^[a-zA-Z_][a-zA-Z0-9_$]*$/g.test(e);return!w.includes(e.toUpperCase())&&t}function Y(e){return e[0]==='"'&&e[e.length-1]==='"'?e.substring(1,e.length-1).replace(/""/g,'"'):e[0]==="`"&&e[e.length-1]==="`"?e.substring(1,e.length-1):e}function F(e){return"'"+e.replace(/'/g,"''")+"'"}const w=["ACCESSIBLE","ADD","ALL","ALTER","ANALYZE","AND","AS","ASC","ASENSITIVE","BEFORE","BETWEEN","BIGINT","BINARY","BLOB","BOTH","BY","CALL","CASCADE","CASE","CHANGE","CHAR","CHARACTER","CHECK","COLLATE","COLUMN","CONDITION","CONSTRAINT","CONTINUE","CONVERT","CREATE","CROSS","CUBE","CUME_DIST","CURRENT_DATE","CURRENT_TIME","CURRENT_TIMESTAMP","CURRENT_USER","CURSOR","DATABASE","DATABASES","DAY_HOUR","DAY_MICROSECOND","DAY_MINUTE","DAY_SECOND","DEC","DECIMAL","DECLARE","DEFAULT","DELAYED","DELETE","DENSE_RANK","DESC","DESCRIBE","DETERMINISTIC","DISTINCT","DISTINCTROW","DIV","DOUBLE","DROP","DUAL","EACH","ELSE","ELSEIF","EMPTY","ENCLOSED","ESCAPED","EXCEPT","EXISTS","EXIT","EXPLAIN","FALSE","FETCH","FIRST_VALUE","FLOAT","FLOAT4","FLOAT8","FOR","FORCE","FOREIGN","FROM","FULLTEXT","FUNCTION","GENERATED","GET","GRANT","GROUP","GROUPING","GROUPS","HAVING","HIGH_PRIORITY","HOUR_MICROSECOND","HOUR_MINUTE","HOUR_SECOND","IF","IGNORE","IN","INDEX","INFILE","INNER","INOUT","INSENSITIVE","INSERT","INT","INT1","INT2","INT3","INT4","INT8","INTEGER","INTERSECT","INTERVAL","INTO","IO_AFTER_GTIDS","IO_BEFORE_GTIDS","IS","ITERATE","JOIN","JSON_TABLE","KEY","KEYS","KILL","LAG","LAST_VALUE","LATERAL","LEAD","LEADING","LEAVE","LEFT","LIKE","LIMIT","LINEAR","LINES","LOAD","LOCALTIME","LOCALTIMESTAMP","LOCK","LONG","LONGBLOB","LONGTEXT","LOOP","LOW_PRIORITY","MASTER_BIND","MASTER_SSL_VERIFY_SERVER_CERT","MATCH","MAXVALUE","MEDIUMBLOB","MEDIUMINT","MEDIUMTEXT","MIDDLEINT","MINUTE_MICROSECOND","MINUTE_SECOND","MOD","MODIFIES","NATURAL","NOT","NO_WRITE_TO_BINLOG","NTH_VALUE","NTILE","NULL","NUMERIC","OF","ON","OPTIMIZE","OPTIMIZER_COSTS","OPTION","OPTIONALLY","OR","ORDER","OUT","OUTER","OUTFILE","OVER","PARTITION","PERCENT_RANK","PRECISION","PRIMARY","PROCEDURE","PURGE","RANGE","RANK","READ","READS","READ_WRITE","REAL","RECURSIVE","REFERENCES","REGEXP","RELEASE","RENAME","REPEAT","REPLACE","REQUIRE","RESIGNAL","RESTRICT","RETURN","REVOKE","RIGHT","RLIKE","ROW","ROWS","ROW_NUMBER","SCHEMA","SCHEMAS","SECOND_MICROSECOND","SELECT","SENSITIVE","SEPARATOR","SET","SHOW","SIGNAL","SMALLINT","SPATIAL","SPECIFIC","SQL","SQLEXCEPTION","SQLSTATE","SQLWARNING","SQL_BIG_RESULT","SQL_CALC_FOUND_ROWS","SQL_SMALL_RESULT","SSL","STARTING","STORED","STRAIGHT_JOIN","SYSTEM","TABLE","TERMINATED","THEN","TINYBLOB","TINYINT","TINYTEXT","TO","TRAILING","TRIGGER","TRUE","UNDO","UNION","UNIQUE","UNLOCK","UNSIGNED","UPDATE","USAGE","USE","USING","UTC_DATE","UTC_TIME","UTC_TIMESTAMP","VALUES","VARBINARY","VARCHAR","VARCHARACTER","VARYING","VIRTUAL","WHEN","WHERE","WHILE","WINDOW","WITH","WRITE","XOR","YEAR_MONTH","ZEROFILL"];function V(e){return`SELECT table_name FROM information_schema.tables WHERE table_schema = ${e!==void 0?C(e):"database()"} ORDER BY table_name`}function Q(){return"SELECT DISTINCT TABLE_SCHEMA from information_schema.TABLES where TABLE_TYPE != 'SYSTEM VIEW' ORDER BY TABLE_SCHEMA"}function k(e,t){let a="SELECT column_name, data_type FROM information_schema.columns WHERE ";return a+=X(e,t),a+=" ORDER BY column_name",a}function X(e,t){let a="";if(e.includes(".")){const n=e.split(".");return a="table_schema = "+C(n[0]),a+=" AND table_name = "+C(n[1]),a}else return a=`table_schema = ${t!==void 0?C(t):"database()"} AND table_name = `+C(e),a}function C(e){return F(Y(e))}const x=({getMeta:e})=>(t,a)=>({...a&&(0,i.getStandardSQLCompletionProvider)(t,a),customStatementPlacement:Z,customSuggestionKinds:z(e)}),G={afterDatabase:"afterDatabase"},$={tablesWithinDatabase:"tablesWithinDatabase"},y="FROM",Z=()=>[{id:G.afterDatabase,resolve:(e,t,a)=>Boolean(e?.is(i.TokenType.Delimiter,".")&&t?.value===y&&(a?.is(i.TokenType.IdentifierQuote)||a?.isIdentifier())&&e?.getPreviousUntil(i.TokenType.Keyword,[i.TokenType.IdentifierQuote],y)?.filter(n=>n.isIdentifier()).length===1)}],z=e=>()=>[{id:i.SuggestionKind.Tables,overrideDefault:!0,suggestionsResolver:async t=>{const a=b(t.currentToken);return(await e({schema:a})).map(M(t))}},{id:i.SuggestionKind.Columns,overrideDefault:!0,suggestionsResolver:async t=>{const a=_(t.currentToken),n=b(a),o=J(a);return!n||!o?[]:(await e({schema:n,table:o})).map(M(t))}},{id:$.tablesWithinDatabase,applyTo:[G.afterDatabase],suggestionsResolver:async t=>{const a=b(t.currentToken);return(await e({schema:a})).map(M(t))}}];function M(e){return function(t){return{label:t.name,insertText:t.completion??t.name,command:{id:"editor.action.triggerSuggest",title:""},kind:i.CompletionItemKind.Field,sortText:i.CompletionItemPriority.High,range:{...e.range,startColumn:e.range.endColumn,endColumn:e.range.endColumn}}}}function b(e){if(e?.isIdentifier()&&e.value[e.value.length-1]!==".")return e.value;if(e?.is(i.TokenType.Delimiter,"."))return e.getPreviousOfType(i.TokenType.Identifier)?.value;if(e?.is(i.TokenType.IdentifierQuote))return e.getPreviousOfType(i.TokenType.Identifier)?.value||e.getNextOfType(i.TokenType.Identifier)?.value}function J(e){return e?.getNextOfType(i.TokenType.Identifier)?.value}const j=e=>(e?.getPreviousOfType(i.TokenType.Keyword,"SELECT")??null)?.getNextOfType(i.TokenType.Keyword,y),_=e=>{const a=j(e)?.getNextOfType(i.TokenType.Identifier);return a?.isKeyword()&&a.next?.is(i.TokenType.Parenthesis,"(")?null:a};class q extends R.D{constructor(t){super(t),this.instanceSettings=t}getQueryModel(){return{quoteLiteral:F}}getSqlLanguageDefinition(){if(this.sqlLanguageDefinition!==void 0)return this.sqlLanguageDefinition;const t={getMeta:a=>this.fetchMeta(a)};return this.sqlLanguageDefinition={id:"mysql",completionProvider:x(t),formatter:D._},this.sqlLanguageDefinition}async fetchDatasets(){return(await this.runSql(Q(),{refId:"datasets"})).map(a=>T(a[0]))}async fetchTables(t){return(await this.runSql(V(t),{refId:"tables"})).map(n=>T(n[0]))}async fetchFields(t){if(!t.dataset||!t.table)return[];const a=k(t.table,t.dataset),o=(await this.runSql(a,{refId:"fields"})).map(E=>({name:E[0],text:E[0],value:T(E[0]),type:E[1],label:E[0]}));return p(o)}async fetchMeta(t){const a=this.instanceSettings.jsonData.database;return!t?.schema&&a?(await this.fetchTables(a)).map(o=>({name:o,completion:`${a}.${o}`,kind:i.CompletionItemKind.Class})):!t?.schema&&!a?(await this.fetchDatasets()).map(o=>({name:o,completion:`${o}.`,kind:i.CompletionItemKind.Module})):!t?.table&&(!a||t?.schema)?(await this.fetchTables(t?.schema)).map(o=>({name:o,completion:o,kind:i.CompletionItemKind.Class})):t?.table&&t.schema?(await this.fetchFields({dataset:t.schema,table:t.table})).map(o=>({name:o.name,completion:o.value,kind:i.CompletionItemKind.Field})):[]}getDB(){return this.db!==void 0?this.db:{datasets:()=>this.fetchDatasets(),tables:t=>this.fetchTables(t),fields:t=>this.fetchFields(t),validateQuery:(t,a)=>Promise.resolve({query:t,error:"",isError:!1,isValid:!0}),dsID:()=>this.id,toRawSql:g,functions:()=>["VARIANCE","STDDEV"],getEditorLanguageDefinition:()=>this.getSqlLanguageDefinition()}}}var s=r(68404),I=r(5916),U=r(13393),u=r(81764),A=r(46967),W=r(11543),ee=r(52953),P=r(8944),te=r(45253),ae=r(29460),ne=r(16705),se=r(95756),re=r(59024);const ie=e=>{const{options:t,onOptionsChange:a}=e,n=t.jsonData;(0,re.Q)(e);const o=()=>{(0,I.Mf)(e,"password")},E=L=>f=>{a({...t,[L]:f.currentTarget.value})},B=L=>f=>{(0,I.tp)(e,L,f.currentTarget.checked)},h=20,m=15,v=40;return s.createElement(s.Fragment,null,s.createElement(U.C,{label:"MySQL Connection",width:400},s.createElement(u._,{labelWidth:m,label:"Host"},s.createElement(A.I,{width:v,name:"host",type:"text",value:t.url||"",placeholder:"localhost:3306",onChange:E("url")})),s.createElement(u._,{labelWidth:m,label:"Database"},s.createElement(A.I,{width:v,name:"database",value:n.database||"",placeholder:"database name",onChange:(0,I._R)(e,"database")})),s.createElement(W.Z,null,s.createElement(u._,{labelWidth:m,label:"User"},s.createElement(A.I,{width:m,value:t.user||"",placeholder:"user",onChange:E("user")})),s.createElement(u._,{labelWidth:m-5,label:"Password"},s.createElement(ee.m4,{width:m,placeholder:"Password",isConfigured:t.secureJsonFields&&t.secureJsonFields.password,onReset:o,onBlur:(0,I.fi)(e,"password")}))),s.createElement(u._,{tooltip:s.createElement("span",null,"Specify the time zone used in the database session, e.g. ",s.createElement("code",null,"Europe/Berlin")," or",s.createElement("code",null,"+02:00"),". This is necessary, if the timezone of the database (or the host of the database) is set to something other than UTC. The value is set in the session with",s.createElement("code",null,"SET time_zone='...'"),". If you leave this field empty, the timezone is not updated. You can find more information in the MySQL documentation."),label:"Session timezone",labelWidth:h},s.createElement(A.I,{width:v-5,value:n.timezone||"",onChange:(0,I._R)(e,"timezone"),placeholder:"(default)"})),s.createElement(W.Z,null,s.createElement(u._,{labelWidth:h,htmlFor:"tlsAuth",label:"TLS Client Auth"},s.createElement(P.x,{id:"tlsAuth",onChange:B("tlsAuth"),value:n.tlsAuth||!1})),s.createElement(u._,{labelWidth:h,tooltip:"Needed for verifing self-signed TLS Certs",htmlFor:"tlsCaCert",label:"With CA Cert"},s.createElement(P.x,{id:"tlsCaCert",onChange:B("tlsAuthWithCACert"),value:n.tlsAuthWithCACert||!1}))),s.createElement(u._,{labelWidth:h,htmlFor:"skipTLSVerify",label:"Skip TLS Verify"},s.createElement(P.x,{id:"skipTLSVerify",onChange:B("tlsSkipVerify"),value:n.tlsSkipVerify||!1}))),n.tlsAuth||n.tlsAuthWithCACert?s.createElement(U.C,{label:"TLS/SSL Auth Details"},s.createElement(se.d,{showCACert:n.tlsAuthWithCACert,showKeyPair:n.tlsAuth,editorProps:e,labelWidth:25})):null,s.createElement(ne.K,{labelWidth:m,jsonData:n,onPropertyChanged:(L,f)=>{(0,I.tp)(e,L,f)}}),s.createElement(U.C,{label:"MySQL details"},s.createElement(u._,{tooltip:s.createElement("span",null,"A lower limit for the auto group by time interval. Recommended to be set to write frequency, for example",s.createElement("code",null,"1m")," if your data is written every minute."),labelWidth:h,label:"Min time interval"},s.createElement(A.I,{placeholder:"1m",value:n.timeInterval||"",onChange:(0,I._R)(e,"timeInterval")}))),s.createElement(te.b,{title:"User Permission",severity:"info"},"The database user should only be granted SELECT permissions on the specified database & tables you want to query. Grafana does not validate that queries are safe so queries can contain any SQL statement. For example, statements like ",s.createElement("code",null,"USE otherdb;")," and ",s.createElement("code",null,"DROP TABLE user;")," would be executed. To protect against this we ",s.createElement("strong",null,"Highly")," recommend you create a specific MySQL user with restricted permissions. Check out the"," ",s.createElement(ae.r,{rel:"noreferrer",target:"_blank",href:"http://docs.grafana.org/features/datasources/mysql/"},"MySQL Data Source Docs")," ","for more information."))},oe=new l.hf(q).setQueryEditor(d.M).setConfigEditor(ie)},76345:()=>{},56834:()=>{}}]);

//# sourceMappingURL=mysqlPlugin.6c8d5d3e3a6c27a85164.js.map