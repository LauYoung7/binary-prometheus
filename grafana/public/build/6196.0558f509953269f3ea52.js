"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6196],{41285:(w,M,a)=>{a.d(M,{P:()=>re});var r=a(52423),t=a(68404),P=a(19677),x=a(24015),S=a(54291),y=a(26418),d=a(72648),I=a(95093),m=a(31403),s=a(61860),R=a(39904),D=a(53217),B=a(85361),L=a(41959),z=a(85511);const _=t.memo(({def:e,operation:n})=>{const l=(0,d.wW)(N),[i,c]=(0,t.useState)(!1),{getTooltipProps:v,setTooltipRef:C,setTriggerRef:O,visible:E}=(0,B.O)({placement:"top",visible:i,offset:[0,16],onVisibleChange:c,interactive:!0,trigger:["click"]});return t.createElement(t.Fragment,null,t.createElement(m.zx,{title:"Click to show description",ref:O,icon:"info-circle",size:"sm",variant:"secondary",fill:"text"}),E&&t.createElement(z.h_,null,t.createElement("div",{ref:C,...v(),className:l.docBox},t.createElement("div",{className:l.docBoxHeader},t.createElement("span",null,e.renderer(n,e,"<expr>")),t.createElement(y.FlexItem,{grow:1}),t.createElement(m.zx,{icon:"times",onClick:()=>c(!1),fill:"text",variant:"secondary",title:"Remove operation"})),t.createElement("div",{className:l.docBoxBody,dangerouslySetInnerHTML:{__html:h(e,n)}}))))});_.displayName="OperationDocs";const N=e=>({docBox:(0,r.css)({overflow:"hidden",background:e.colors.background.primary,border:`1px solid ${e.colors.border.strong}`,boxShadow:e.shadows.z3,maxWidth:"600px",padding:e.spacing(1),borderRadius:e.shape.borderRadius(),zIndex:e.zIndex.tooltip}),docBoxHeader:(0,r.css)({fontSize:e.typography.h5.fontSize,fontFamily:e.typography.fontFamilyMonospace,paddingBottom:e.spacing(1),display:"flex",alignItems:"center"}),docBoxBody:(0,r.css)({marginBottom:e.spacing(-1),color:e.colors.text.secondary}),signature:(0,r.css)({fontSize:e.typography.bodySmall.fontSize,fontFamily:e.typography.fontFamilyMonospace}),dropdown:(0,r.css)({opacity:0,color:e.colors.text.secondary})});function h(e,n){return(0,L.a)(e.explainHandler?e.explainHandler(n,e):e.documentation??"no docs")}const W=t.memo(({operation:e,def:n,index:l,onChange:i,onRemove:c,queryModeller:v,dragHandleProps:C})=>{const O=(0,d.wW)(H),[E,K]=(0,t.useState)({}),f=()=>{if(E.isOpen)K({...E,isOpen:!1});else{const g=v.getAlternativeOperations(n.alternativesKey).map(b=>({label:b.name,value:b}));K({isOpen:!0,alternatives:g})}};return t.createElement("div",{className:O.header},!E.isOpen&&t.createElement(t.Fragment,null,t.createElement("div",{...C},n.name??n.id),t.createElement(y.FlexItem,{grow:1}),t.createElement("div",{className:`${O.operationHeaderButtons} operation-header-show-on-hover`},t.createElement(m.zx,{icon:"angle-down",size:"sm",onClick:f,fill:"text",variant:"secondary",title:"Click to view alternative operations"}),t.createElement(_,{def:n,operation:e}),t.createElement(m.zx,{icon:"times",size:"sm",onClick:()=>c(l),fill:"text",variant:"secondary",title:"Remove operation"}))),E.isOpen&&t.createElement("div",{className:O.selectWrapper},t.createElement(D.Ph,{autoFocus:!0,openMenuOnFocus:!0,placeholder:"Replace with",options:E.alternatives,isOpen:!0,onCloseMenu:f,onChange:g=>{if(g.value){const b=v.getOperationDef(g.value.id),A=[...b.defaultParams];for(let T=0;T<Math.min(e.params.length,A.length);T++)b.params[T].type===n.params[T].type&&(A[T]=e.params[T]);const U={...e,params:A,id:g.value.id};i(l,n.changeTypeHandler?n.changeTypeHandler(U,b):U)}}})))});W.displayName="OperationHeader";const H=e=>({header:(0,r.css)({borderBottom:`1px solid ${e.colors.border.medium}`,padding:e.spacing(.5,.5,.5,1),display:"flex",alignItems:"center","&:hover .operation-header-show-on-hover":(0,r.css)({opacity:1})}),operationHeaderButtons:(0,r.css)({opacity:0,transition:e.transitions.create(["opacity"],{duration:e.transitions.duration.short})}),selectWrapper:(0,r.css)({paddingRight:e.spacing(2)})});var V=a(63134),Z=a(68668),J=a(58255),$=a(8373);function G(e){if(e.editor)return e.editor;if(e.options)return Y;switch(e.type){case"boolean":return X;case"number":case"string":default:return j}}function j(e){return t.createElement(Z.H,{id:(0,$.i1)(e.operationIndex,e.index),defaultValue:e.value?.toString(),minWidth:e.paramDef.minWidth,placeholder:e.paramDef.placeholder,title:e.paramDef.description,maxWidth:(e.paramDef.minWidth||20)*3,onCommitChange:n=>{e.onChange(e.index,n.currentTarget.value),e.paramDef.runQueryOnEnter&&n.type==="keydown"&&e.onRunQuery()}})}function X(e){return t.createElement(J.X,{id:(0,$.i1)(e.operationIndex,e.index),value:e.value,onChange:n=>e.onChange(e.index,n.currentTarget.checked)})}function Y({paramDef:e,value:n,index:l,operationIndex:i,onChange:c}){const v=(0,d.wW)(q);let C=e.options;C[0]?.label||(C=e.options.map(E=>({label:E.toString(),value:E})));let O=C.find(E=>E.value===n)??(0,V.E)(n);return!n&&e.optional?t.createElement("div",{className:v.optionalParam},t.createElement(m.zx,{size:"sm",variant:"secondary",title:`Add ${e.name}`,icon:"plus",onClick:()=>c(l,C[0].value)},e.name)):t.createElement(y.Stack,{gap:.5,direction:"row",alignItems:"center",wrap:!1},t.createElement(D.Ph,{id:(0,$.i1)(i,l),value:O,options:C,placeholder:e.placeholder,allowCustomValue:!0,onChange:E=>c(l,E.value)}),e.optional&&t.createElement(m.zx,{"data-testid":`operations.${l}.remove-param`,size:"sm",fill:"text",icon:"times",variant:"secondary",title:`Remove ${e.name}`,onClick:()=>c(l,"")}))}const q=e=>({optionalParam:(0,r.css)({marginTop:e.spacing(1)})});function ee({operation:e,index:n,onRemove:l,onChange:i,onRunQuery:c,queryModeller:v,query:C,datasource:O,flash:E,highlight:K}){const f=(0,d.wW)(ne),g=v.getOperationDef(e.id),b=te(E);if(!g)return t.createElement("span",null,"Operation ",e.id," not found");const A=(o,u)=>{const Q={...e,params:[...e.params]};Q.params[o]=u,k(g,Q,n,o,i)},U=()=>{const o={...e,params:[...e.params,""]};k(g,o,n,e.params.length,i)},T=o=>{const u={...e,params:[...e.params.slice(0,o),...e.params.slice(o+1)]};k(g,u,n,o,i)},F=[];for(let o=0;o<e.params.length;o++){const u=g.params[Math.min(g.params.length-1,o)],Q=G(u);F.push(t.createElement("div",{className:f.paramRow,key:`${o}-1`},!u.hideName&&t.createElement("div",{className:f.paramName},t.createElement("label",{htmlFor:(0,$.i1)(n,o)},u.name),u.description&&t.createElement(s.u,{placement:"top",content:u.description,theme:"info"},t.createElement(R.J,{name:"info-circle",size:"sm",className:f.infoIcon}))),t.createElement("div",{className:f.paramValue},t.createElement(y.Stack,{gap:.5,direction:"row",alignItems:"center",wrap:!1},t.createElement(Q,{index:o,paramDef:u,value:e.params[o],operation:e,operationIndex:n,onChange:A,onRunQuery:c,query:C,datasource:O}),u.restParam&&(e.params.length>g.params.length||u.optional)&&t.createElement(m.zx,{"data-testid":`operations.${n}.remove-rest-param`,size:"sm",fill:"text",icon:"times",variant:"secondary",title:`Remove ${u.name}`,onClick:()=>T(o)})))))}let p;if(g.params.length>0){const o=g.params[g.params.length-1];o.restParam&&(p=ae(o,U,n,e.params.length,f))}return t.createElement(P._l,{draggableId:`operation-${n}`,index:n},o=>t.createElement("div",{className:(0,r.cx)(f.card,(b||K)&&f.cardHighlight),ref:o.innerRef,...o.draggableProps,"data-testid":`operations.${n}.wrapper`},t.createElement(W,{operation:e,dragHandleProps:o.dragHandleProps,def:g,index:n,onChange:i,onRemove:l,queryModeller:v}),t.createElement("div",{className:f.body},F),p,n<C.operations.length-1&&t.createElement("div",{className:f.arrow},t.createElement("div",{className:f.arrowLine}),t.createElement("div",{className:f.arrowArrow}))))}function te(e){const[n,l]=(0,t.useState)(!0);return(0,t.useEffect)(()=>{let i;return e?i=setTimeout(()=>{l(!1)},1e3):l(!0),()=>clearTimeout(i)},[e]),n&&e}function ae(e,n,l,i,c){return t.createElement("div",{className:c.restParam,key:`${i}-2`},t.createElement(m.zx,{size:"sm",icon:"plus",title:`Add ${e.name}`,variant:"secondary",onClick:n,"data-testid":`operations.${l}.add-rest-param`},e.name))}function k(e,n,l,i,c){e.paramChangedHandler?c(l,e.paramChangedHandler(i,n,e)):c(l,n)}const ne=e=>({card:(0,r.css)({background:e.colors.background.primary,border:`1px solid ${e.colors.border.medium}`,display:"flex",flexDirection:"column",cursor:"grab",borderRadius:e.shape.borderRadius(1),marginBottom:e.spacing(1),position:"relative",transition:"all 0.5s ease-in 0s"}),cardHighlight:(0,r.css)({boxShadow:`0px 0px 4px 0px ${e.colors.primary.border}`,border:`1px solid ${e.colors.primary.border}`}),infoIcon:(0,r.css)({marginLeft:e.spacing(.5),color:e.colors.text.secondary,":hover":{color:e.colors.text.primary}}),body:(0,r.css)({margin:e.spacing(1,1,.5,1),display:"table"}),paramRow:(0,r.css)({label:"paramRow",display:"table-row",verticalAlign:"middle"}),paramName:(0,r.css)({display:"table-cell",padding:e.spacing(0,1,0,0),fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium,verticalAlign:"middle",height:"32px"}),paramValue:(0,r.css)({label:"paramValue",display:"table-cell",verticalAlign:"middle"}),restParam:(0,r.css)({padding:e.spacing(0,1,1,1)}),arrow:(0,r.css)({position:"absolute",top:"0",right:"-18px",display:"flex"}),arrowLine:(0,r.css)({height:"2px",width:"8px",backgroundColor:e.colors.border.strong,position:"relative",top:"14px"}),arrowArrow:(0,r.css)({width:0,height:0,borderTop:"5px solid transparent",borderBottom:"5px solid transparent",borderLeft:`7px solid ${e.colors.border.strong}`,position:"relative",top:"10px"})});function re({query:e,datasource:n,queryModeller:l,onChange:i,onRunQuery:c,highlightedOp:v}){const C=(0,d.wW)(le),{operations:O}=e,E=oe(O),[K,f]=(0,t.useState)(!1),g=(p,o)=>{const u=[...O];u.splice(p,1,o),i({...e,operations:u})},b=p=>{const o=[...O.slice(0,p),...O.slice(p+1)];i({...e,operations:o})},A=l.getCategories().map(p=>({value:p,label:p,items:l.getOperationsForCategory(p).map(o=>({value:o.id,label:o.name,isLeaf:!0}))})),U=p=>{const o=l.getOperationDef(p);o&&(i(o.addOperationHandler(o,e,l)),f(!1))},T=p=>{if(!p.destination)return;const o=[...O],u=o[p.source.index];o.splice(p.source.index,1),o.splice(p.destination.index,0,u),i({...e,operations:o})},F=()=>{f(!1)};return t.createElement(y.Stack,{gap:1,direction:"column"},t.createElement(y.Stack,{gap:1},O.length>0&&t.createElement(P.Z5,{onDragEnd:T},t.createElement(P.bK,{droppableId:"sortable-field-mappings",direction:"horizontal"},p=>t.createElement("div",{className:C.operationList,ref:p.innerRef,...p.droppableProps},O.map((o,u)=>t.createElement(ee,{key:o.id+JSON.stringify(o.params)+u,queryModeller:l,index:u,operation:o,query:e,datasource:n,onChange:g,onRemove:b,onRunQuery:c,flash:E[u],highlight:v===o})),p.placeholder))),t.createElement("div",{className:C.addButton},K?t.createElement(I.v,{options:A,onSelect:U,onBlur:F,autoFocus:!0,alwaysOpen:!0,hideActiveLevelLabel:!0,placeholder:"Search"}):t.createElement(m.zx,{icon:"plus",variant:"secondary",onClick:()=>f(!0),title:"Add operation"},"Operations"))))}function oe(e){const n=(0,x.Z)(),l=(0,S.Z)(e);if(!n())return e.map(()=>!1);if(!l)return e.map(()=>!0);let i=[];if(l.length-1===e.length&&e.every(c=>l.includes(c)))return e.map(()=>!1);if(l.length+1===e.length&&l.every(c=>e.includes(c))){const c=e.find(v=>!l.includes(v));i=e.map(v=>v===c)}else i=e.map((c,v)=>!se(c.id,l[v]?.id));return i}function se(e,n){return e===n||`__${e}_by`===n||e===`__${n}_by`}const le=e=>({heading:(0,r.css)({label:"heading",fontSize:12,fontWeight:e.typography.fontWeightMedium,marginBottom:0}),operationList:(0,r.css)({label:"operationList",display:"flex",flexWrap:"wrap",gap:e.spacing(2)}),addButton:(0,r.css)({label:"addButton",width:126,paddingBottom:e.spacing(1)})})},73250:(w,M,a)=>{a.d(M,{B:()=>S});var r=a(52423),t=a(68404),P=a(26418),x=a(72648);function S({children:d}){const I=(0,x.wW)(y);return t.createElement("div",{className:I.root},t.createElement(P.Stack,{gap:1},d))}const y=d=>({root:(0,r.css)({padding:d.spacing(1,1,0,1),backgroundColor:d.colors.background.secondary,borderRadius:d.shape.borderRadius(1)})})},75765:(w,M,a)=>{a.d(M,{L:()=>d});var r=a(52423),t=a(68404),P=a(41818),x=a(72648),S=a(61860),y=a(31403);const d=({datasource:m,query:s,onChange:R,data:D,queryModeller:B,buildVisualQueryFromString:L})=>{const[z,_]=(0,t.useState)([]),N=(0,x.wW)(I);return(0,t.useEffect)(()=>{const h={expr:B.renderQuery(s),refId:""},W=m.getQueryHints(h,D?.series||[]).filter(H=>H.fix?.action);_(W)},[m,s,D,B]),t.createElement(t.Fragment,null,z.length>0&&t.createElement("div",{className:N.container},z.map(h=>t.createElement(S.u,{content:`${h.label} ${h.fix?.label}`,key:h.type},t.createElement(y.zx,{onClick:()=>{if((0,P.ff)("grafana_query_builder_hints_clicked",{hint:h.type,datasourceType:m.type}),h?.fix?.action){const W={expr:B.renderQuery(s),refId:""},H=m.modifyQuery(W,h.fix.action),V=L(H.expr);return R(V.query)}},fill:"outline",size:"sm",className:N.hint},"hint: ",h.fix?.title||h.fix?.action?.type.toLowerCase().replace("_"," "))))))};d.displayName="QueryBuilderHints";const I=m=>({container:r.css`
      display: flex;
      align-items: start;
    `,hint:r.css`
      margin-right: ${m.spacing(1)};
    `})},92611:(w,M,a)=>{a.d(M,{k:()=>S});var r=a(68404),t=a(2594),P=a(58079);const x=[{label:"Builder",value:P.c.Builder},{label:"Code",value:P.c.Code}];function S({mode:y,onChange:d}){return r.createElement("div",{"data-testid":"QueryEditorModeToggle"},r.createElement(t.S,{options:x,size:"sm",value:y,onChange:d}))}},61458:(w,M,a)=>{a.d(M,{n:()=>I});var r=a(52423),t=a(82897),P=a.n(t),x=a(68404),S=a(26418),y=a(72648),d=a(8944);function I({label:s,...R}){const D=s.replace(" ","-"),B=(0,x.useRef)((0,t.uniqueId)(`switch-${D}`)),L=(0,y.wW)(m);return x.createElement(S.Stack,{gap:1},x.createElement("label",{htmlFor:B.current,className:L.switchLabel},s),x.createElement(d.r,{...R,id:B.current}))}const m=s=>({switchLabel:(0,r.css)({color:s.colors.text.secondary,cursor:"pointer",fontSize:s.typography.bodySmall.fontSize,"&:hover":{color:s.colors.text.primary}})})},38435:(w,M,a)=>{a.d(M,{d:()=>I});var r=a(52423),t=a(68404),P=a(86253),x=a(20112),S=a(26418),y=a(72648),d=a(39904);function I({title:s,children:R,collapsedInfo:D,queryStats:B}){const[L,z]=(0,P.Z)(!1),_=(0,y.wW)(m),N=()=>{const{text:h,suffix:W}=(0,x.Cf)("bytes")(B.bytes,1);return h+W};return t.createElement("div",{className:_.wrapper},t.createElement(S.Stack,{gap:0,direction:"column"},t.createElement("div",{className:_.header,onClick:z,title:"Click to edit options"},t.createElement("div",{className:_.toggle},t.createElement(d.J,{name:L?"angle-down":"angle-right"})),t.createElement("h6",{className:_.title},s),!L&&t.createElement("div",{className:_.description},D.map((h,W)=>t.createElement("span",{key:W},h)))),L&&t.createElement("div",{className:_.body},R)),B&&t.createElement("p",{className:_.stats},"This query will process approximately ",N(),"."))}const m=s=>({wrapper:(0,r.css)({width:"100%",display:"flex",justifyContent:"space-between",alignItems:"baseline"}),switchLabel:(0,r.css)({color:s.colors.text.secondary,cursor:"pointer",fontSize:s.typography.bodySmall.fontSize,"&:hover":{color:s.colors.text.primary}}),header:(0,r.css)({display:"flex",cursor:"pointer",alignItems:"baseline",color:s.colors.text.primary,"&:hover":{background:s.colors.emphasize(s.colors.background.primary,.03)}}),title:(0,r.css)({flexGrow:1,overflow:"hidden",fontSize:s.typography.bodySmall.fontSize,fontWeight:s.typography.fontWeightMedium,margin:0}),description:(0,r.css)({color:s.colors.text.secondary,fontSize:s.typography.bodySmall.fontSize,paddingLeft:s.spacing(2),gap:s.spacing(2),display:"flex"}),body:(0,r.css)({display:"flex",paddingTop:s.spacing(2),gap:s.spacing(2),flexWrap:"wrap"}),toggle:(0,r.css)({color:s.colors.text.secondary,marginRight:`${s.spacing(1)}`}),stats:(0,r.css)({margin:"0px",color:s.colors.text.secondary,fontSize:s.typography.bodySmall.fontSize})})},89290:(w,M,a)=>{a.d(M,{P5:()=>m,ar:()=>P,iS:()=>S});var r=a(68404),t=a(58379);const P="PrometheusQueryEditorExplainDefault",x="PrometheusQueryEditorRawQueryDefault",S="LokiQueryEditorExplainDefault",y="LokiQueryEditorRawQueryDefault";function d(s,R=!1){const D=t.Z.get(s);return D===void 0?R:Boolean(parseInt(D,10))}function I(s,R){t.Z.set(s,R?"1":"0")}function m(s,R=!1){const[D,B]=(0,r.useState)(d(s,R)),L=(0,r.useCallback)(z=>{I(s,z),B(z)},[s]);return{flag:D,setFlag:L}}}}]);

//# sourceMappingURL=6196.0558f509953269f3ea52.js.map