"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3320],{91159:(_,A,l)=>{l.d(A,{n:()=>re});var P=l(57706),b=l(68404),K=l(40400),w=l(35645),e=l(31220),T=l(13193),Q=l(67660),B=l(69659),U=l(59796),V=l(31439);const R=b.lazy(()=>Promise.all([l.e(1899),l.e(4254),l.e(794),l.e(7142)]).then(l.bind(l,47864))),E=N=>b.createElement(b.Suspense,{fallback:null},b.createElement(R,{...N})),F=N=>{const z=(0,b.useRef)(null),{runQueryOnBlur:D,onRunQuery:S,onChange:$,...g}=N,O=I=>{z.current=I,$(I),S()},G=I=>{D?I!==z.current&&O(I):$(I)};return b.createElement(E,{onRunQuery:O,onBlur:G,...g})},W="grafana.datasources.loki.browser.labels";function x(N,{typeaheadContext:z,typeaheadText:D}){switch(z){case"context-labels":{const S=e.getNextCharacter();(!S||S==="}"||S===",")&&(N+="=");break}case"context-label-values":{let S="";D.match(/^(!?=~?"|")/)||(S='"'),S+=(0,V.Hk)(N,D),e.getNextCharacter()!=='"'&&(S+='"'),N=S;break}default:}return N}class re extends b.PureComponent{constructor(z){super(z),this._isMounted=!1,this.onChangeLabelBrowser=D=>{this.onChangeQuery(D,!0),this.setState({labelBrowserVisible:!1})},this.onChangeQuery=(D,S)=>{const{query:$,onChange:g,onRunQuery:O}=this.props;if(g){const G={...$,expr:D};g(G),S&&O&&O()}},this.onTypeahead=async D=>{const{datasource:S}=this.props;if(!S.languageProvider)return{suggestions:[]};const $=S.languageProvider,{history:g}=this.props,{prefix:O,text:G,value:I,wrapperClasses:te,labelKey:ae}=D;return await $.provideCompletionItems({text:G,value:I,prefix:O,wrapperClasses:te,labelKey:ae},{history:g})},this.state={labelsLoaded:!1,labelBrowserVisible:!1},this.plugins=[(0,T.h)(),(0,Q.Z)({onlyIn:D=>D.object==="block"&&D.type==="code_block",getSyntax:D=>"logql"},{...P.languages,logql:this.props.datasource.languageProvider.getSyntax()})]}async componentDidMount(){this._isMounted=!0,await this.props.datasource.languageProvider.start(),this._isMounted&&this.setState({labelsLoaded:!0})}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(z){const{range:D,datasource:{languageProvider:S}}=this.props;(0,V.rf)(D,z.range)&&S.fetchLabels()}render(){const{ExtraFieldElement:z,query:D,app:S,datasource:$,placeholder:g="Enter a Loki query (run with Shift+Enter)",history:O,onRunQuery:G,onBlur:I}=this.props;return b.createElement(U.G,{storageKey:W,defaultValue:[]},(te,ae,oe)=>b.createElement(b.Fragment,null,b.createElement("div",{className:"gf-form-inline gf-form-inline--xs-view-flex-column flex-grow-1","data-testid":this.props["data-testid"]},b.createElement("div",{className:"gf-form gf-form--grow flex-shrink-1 min-width-15"},w.v.featureToggles.lokiMonacoEditor?b.createElement(F,{runQueryOnBlur:S!==K.zj.Explore,datasource:$,history:O??[],onChange:this.onChangeQuery,onRunQuery:G,initialValue:D.expr??""}):b.createElement(B.q,{additionalPlugins:this.plugins,cleanText:$.languageProvider.cleanText,query:D.expr,onTypeahead:this.onTypeahead,onWillApplySuggestion:x,onChange:this.onChangeQuery,onBlur:I,onRunQuery:G,placeholder:g,portalOrigin:"loki"}))),z))}}},31439:(_,A,l)=>{l.d(A,{Hk:()=>U,U9:()=>T,_z:()=>V,aC:()=>R,iS:()=>Q,rf:()=>K,tU:()=>B});function P(E){return b(E/1e3)}function b(E){return Math.floor(E/60)}function K(E,F){if(E&&F){const W=P(E.from.valueOf())===P(F.from.valueOf()),x=P(E.to.valueOf())===P(F.to.valueOf());return!(W&&x)}return!1}const w=/[*+?()|\\.\[\]{}^$]/g;function e(E){return E.replace(w,"\\$&")}function T(E){return E.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/"/g,'\\"')}function Q(E){return E.replace(/\\n/g,`
`).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}function B(E){return T(e(E))}function U(E,F){return V(F)?B(E):T(E)}function V(E){return!!(E&&(E.includes("=~")||E.includes("!~")))}function R(E){const F=["b","kib","Kib","kb","KB","mib","Mib","mb","MB","gib","Gib","gb","GB","tib","Tib","tb","TB","pib","Pib","pb","PB","eib","Eib","eb","EB"],W=new RegExp(`^(?:-?\\d+(?:\\.\\d+)?)(?:${F.join("|")})$`);return!!E.match(W)}},33320:(_,A,l)=>{l.r(A),l.d(A,{plugin:()=>la});var P=l(7238),b=l(55294),K=l(82378),w=l(82897),e=l(68404),T=l(41818);const Q=['{job="default/prometheus"}'],B=["job","app","k8s_app"],U=5,V=[{title:"Log pipeline",expression:'{job="mysql"} |= "metrics" | logfmt | duration > 10s',label:'This query targets the MySQL job, keeps logs that contain the substring "metrics", and then parses and filters the logs further.'},{title:"Count over time",expression:'count_over_time({job="mysql"}[5m])',label:"This query counts all the log lines within the last five minutes for the MySQL job."},{title:"Rate",expression:'rate(({job="mysql"} |= "error" != "timeout")[10s])',label:"This query gets the per-second rate of all non-timeout errors within the last ten seconds for the MySQL job."},{title:"Aggregate, count, and group",expression:'sum(count_over_time({job="mysql"}[5m])) by (level)',label:"Get the count of logs during the last five minutes, grouping by level."}];class R extends e.PureComponent{constructor(){super(...arguments),this.state={userExamples:[]},this.checkUserLabels=async()=>{const t=this.props.datasource?.languageProvider;if(t.started){const s=t.getLabelKeys()||[],n=B.find(r=>s.includes(r));if(n){const r=await t.getLabelValues(n),i=(0,w.shuffle)(r).slice(0,U).map(c=>`{${n}="${c}"}`);this.setState({userExamples:i})}}else this.scheduleUserLabelChecking()}}componentDidMount(){this.scheduleUserLabelChecking(),(0,T.ff)("grafana_loki_cheatsheet_opened",{})}componentWillUnmount(){clearTimeout(this.userLabelTimer)}scheduleUserLabelChecking(){this.userLabelTimer=setTimeout(this.checkUserLabels,1e3)}renderExpression(t){const{onClickExample:s}=this.props,n=r=>{s(r),(0,T.ff)("grafana_loki_cheatsheet_example_clicked",{})};return e.createElement("button",{type:"button",className:"cheat-sheet-item__example",key:t,onClick:r=>n({refId:"A",expr:t})},e.createElement("code",null,t))}render(){const{userExamples:t}=this.state,s=t.length>0;return e.createElement("div",null,e.createElement("h2",null,"Loki Cheat Sheet"),e.createElement("div",{className:"cheat-sheet-item"},e.createElement("div",{className:"cheat-sheet-item__title"},"See your logs"),e.createElement("div",{className:"cheat-sheet-item__label"},"Start by selecting a log stream from the Label browser, or alternatively you can write a stream selector into the query field."),s?e.createElement("div",null,e.createElement("div",{className:"cheat-sheet-item__label"},"Here are some example streams from your logs:"),t.map(n=>this.renderExpression(n))):e.createElement("div",null,e.createElement("div",{className:"cheat-sheet-item__label"},"Here is an example of a log stream:"),this.renderExpression(Q[0]))),e.createElement("div",{className:"cheat-sheet-item"},e.createElement("div",{className:"cheat-sheet-item__title"},"Combine stream selectors"),this.renderExpression('{app="cassandra",namespace="prod"}'),e.createElement("div",{className:"cheat-sheet-item__label"},"Returns all log lines from streams that have both labels.")),e.createElement("div",{className:"cheat-sheet-item"},e.createElement("div",{className:"cheat-sheet-item__title"},"Filtering for search terms."),this.renderExpression('{app="cassandra"} |~ "(duration|latency)s*(=|is|of)s*[d.]+"'),this.renderExpression('{app="cassandra"} |= "exact match"'),this.renderExpression('{app="cassandra"} != "do not match"'),e.createElement("div",{className:"cheat-sheet-item__label"},e.createElement("a",{href:"https://grafana.com/docs/loki/latest/logql/#log-pipeline",target:"logql"},"LogQL")," ","supports exact and regular expression filters.")),V.map(n=>e.createElement("div",{className:"cheat-sheet-item",key:n.expression},e.createElement("div",{className:"cheat-sheet-item__title"},n.title),this.renderExpression(n.expression),e.createElement("div",{className:"cheat-sheet-item__label"},n.label))))}}var E=l(40400),F=l(49922),W=l(68183),x=l(26418),re=l(98102),N=l(31403),z=l(92611),D=l(61458),S=l(58079),$=l(89290),g=l(52423),O=l(72648),G=l(35029),I=l(61744),te=l(59796),ae=l(75478),oe=l(27303),ie=l(64353),ce=l(85951),Ve=l(46967),$e=l(52081),ue=l(31439);const de=1e3,me=1e4,Ie=4,ge="{}";function H(a){const t=[];for(const s of a)if(s.selected&&s.values&&s.values.length>0){const n=s.values.filter(r=>r.selected).map(r=>r.name);n.length>1?t.push(`${s.name}=~"${n.map(ue.tU).join("|")}"`):n.length===1&&t.push(`${s.name}="${(0,ue.U9)(n[0])}"`)}return["{",t.join(","),"}"].join("")}function Ae(a,t,s){return a.map(n=>{const r=t[n.name];if(r){let i;if(n.name===s&&n.values)i=n.values;else{const c=new Set(n.values?.filter(o=>o.selected).map(o=>o.name)||[]);i=r.map(o=>({name:o,selected:c.has(o)}))}return{...n,loading:!1,values:i,facets:i.length}}return{...n,loading:!1,hidden:!r,values:void 0,facets:0}})}const We=a=>({wrapper:g.css`
    background-color: ${a.colors.background.secondary};
    padding: ${a.spacing(2)};
    width: 100%;
  `,list:g.css`
    margin-top: ${a.spacing(1)};
    display: flex;
    flex-wrap: wrap;
    max-height: 200px;
    overflow: auto;
  `,section:g.css`
    & + & {
      margin: ${a.spacing(2,0)};
    }
    position: relative;
  `,selector:g.css`
    font-family: ${a.typography.fontFamilyMonospace};
    margin-bottom: ${a.spacing(1)};
  `,status:g.css`
    margin-bottom: ${a.spacing(1)};
    color: ${a.colors.text.secondary};
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    transition: opacity 100ms linear;
    opacity: 0;
  `,statusShowing:g.css`
    opacity: 1;
  `,error:g.css`
    color: ${a.colors.error.main};
  `,valueList:g.css`
    margin-right: ${a.spacing(1)};
    resize: horizontal;
  `,valueListWrapper:g.css`
    border-left: 1px solid ${a.colors.border.medium};
    margin: ${a.spacing(1,0)};
    padding: ${a.spacing(1,0,1,1)};
  `,valueListArea:g.css`
    display: flex;
    flex-wrap: wrap;
    margin-top: ${a.spacing(1)};
  `,valueTitle:g.css`
    margin-left: -${a.spacing(.5)};
    margin-bottom: ${a.spacing(1)};
  `,validationStatus:g.css`
    padding: ${a.spacing(.5)};
    margin-bottom: ${a.spacing(1)};
    color: ${a.colors.text.maxContrast};
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  `});class ze extends e.Component{constructor(){super(...arguments),this.state={labels:[],searchTerm:"",status:"Ready",error:"",validationStatus:""},this.onChangeSearch=t=>{this.setState({searchTerm:t.target.value})},this.onClickRunLogsQuery=()=>{(0,T.ff)("grafana_loki_label_browser_closed",{app:this.props.app,closeType:"showLogsButton"});const t=H(this.state.labels);this.props.onChange(t)},this.onClickRunMetricsQuery=()=>{(0,T.ff)("grafana_loki_label_browser_closed",{app:this.props.app,closeType:"showLogsRateButton"});const s=`rate(${H(this.state.labels)}[$__interval])`;this.props.onChange(s)},this.onClickClear=()=>{this.setState(t=>({labels:t.labels.map(n=>({...n,values:void 0,selected:!1,loading:!1,hidden:!1,facets:void 0})),searchTerm:"",status:"",error:"",validationStatus:""})),this.props.deleteLastUsedLabels()},this.onClickLabel=(t,s,n)=>{const r=this.state.labels.find(o=>o.name===t);if(!r)return;const i=!r.selected;let c={selected:i};if(r.values&&!i){const o=r.values.map(d=>({...d,selected:!1}));c={...c,facets:0,values:o}}this.setState({searchTerm:""}),this.updateLabelState(t,c,"",()=>this.doFacettingForLabel(t))},this.onClickValue=(t,s,n)=>{const r=this.state.labels.find(c=>c.name===t);if(!r||!r.values)return;this.setState({searchTerm:""});const i=r.values.map(c=>({...c,selected:c.name===s?!c.selected:c.selected}));this.updateLabelState(t,{values:i},"",()=>this.doFacetting(t))},this.onClickValidate=()=>{const t=H(this.state.labels);this.validateSelector(t)},this.doFacetting=t=>{const s=H(this.state.labels);if(s===ge){const n=this.state.labels.map(r=>({...r,facets:0,values:void 0,hidden:!1}));this.setState({labels:n},()=>{this.state.labels.forEach(r=>r.selected&&this.fetchValues(r.name,s))})}else this.fetchSeries(s,t)}}updateLabelState(t,s,n="",r){this.setState(i=>{const c=i.labels.map(d=>d.name===t?{...d,...s}:d),o=n?"":i.error;return{labels:c,status:n,error:o,validationStatus:""}},r)}componentDidMount(){const{languageProvider:t,autoSelect:s=Ie,lastUsedLabels:n}=this.props;if(t){const r=n;t.start().then(()=>{let i=t.getLabelKeys();if(i.length>de){const o=`Too many labels found (showing only ${de} of ${i.length})`;i=i.slice(0,de),this.setState({error:o})}const c=i.map((o,d,h)=>({name:o,selected:h.length<=s&&r.length===0||r.includes(o),loading:!1}));this.setState({labels:c},()=>{this.state.labels.forEach(o=>{o.selected&&this.fetchValues(o.name,ge)})})})}}doFacettingForLabel(t){const s=this.state.labels.find(r=>r.name===t);if(!s)return;const n=this.state.labels.filter(r=>r.selected).map(r=>r.name);this.props.storeLastUsedLabels(n),s.selected?s.values||this.fetchValues(t,H(this.state.labels)):this.doFacetting()}async fetchValues(t,s){const{languageProvider:n}=this.props;this.updateLabelState(t,{loading:!0},`Fetching values for ${t}`);try{let r=await n.getLabelValues(t);if(s!==H(this.state.labels)){this.updateLabelState(t,{loading:!1},"");return}if(r.length>me){const c=`Too many values for ${t} (showing only ${me} of ${r.length})`;r=r.slice(0,me),this.setState({error:c})}const i=r.map(c=>({name:c}));this.updateLabelState(t,{values:i,loading:!1})}catch(r){console.error(r)}}async fetchSeries(t,s){const{languageProvider:n}=this.props;s&&this.updateLabelState(s,{loading:!0},`Loading labels for ${t}`);try{const r=await n.fetchSeriesLabels(t,!0);if(t!==H(this.state.labels)){s&&this.updateLabelState(s,{loading:!1});return}if(Object.keys(r).length===0){this.setState({error:`Empty results, no matching label for ${t}`});return}const i=Ae(this.state.labels,r,s);this.setState({labels:i,error:""}),s&&this.updateLabelState(s,{loading:!1})}catch(r){console.error(r)}}async validateSelector(t){const{languageProvider:s}=this.props;this.setState({validationStatus:`Validating selector ${t}`,error:""});const n=await s.fetchSeries(t);this.setState({validationStatus:`Selector is valid (${n.length} streams found)`})}render(){const{theme:t}=this.props,{labels:s,searchTerm:n,status:r,error:i,validationStatus:c}=this.state;if(s.length===0)return e.createElement(I.u,{text:"Loading labels..."});const o=We(t),d=H(this.state.labels),h=d===ge;let f=s.filter(u=>u.selected&&u.values);return n?f=f.map(u=>{const C=u.values.filter(m=>{if(m.selected)return m.highlightParts=void 0,!0;const L=(0,oe.C)(m.name.toLowerCase(),n.toLowerCase());return L.found?(m.highlightParts=L.ranges,m.order=L.distance,!0):!1});return{...u,values:(0,w.sortBy)(C,m=>m.selected?-1/0:m.order)}}):f=this.state.labels.filter(u=>u.selected&&u.values).map(u=>({...u,values:u?.values?u.values.map(C=>({...C,highlightParts:void 0})):[]})),e.createElement("div",{className:o.wrapper},e.createElement("div",{className:o.section},e.createElement(ie._,{description:"Which labels would you like to consider for your search?"},"1. Select labels to search in"),e.createElement("div",{className:o.list},s.map(u=>e.createElement(ce._,{key:u.name,name:u.name,loading:u.loading,active:u.selected,hidden:u.hidden,facets:u.facets,onClick:this.onClickLabel})))),e.createElement("div",{className:o.section},e.createElement(ie._,{description:"Choose the label values that you would like to use for the query. Use the search field to find values across selected labels."},"2. Find values for the selected labels"),e.createElement("div",null,e.createElement(Ve.I,{onChange:this.onChangeSearch,"aria-label":"Filter expression for values",value:n,placeholder:"Enter a label value"})),e.createElement("div",{className:o.valueListArea},f.map(u=>e.createElement("div",{role:"list",key:u.name,className:o.valueListWrapper},e.createElement("div",{className:o.valueTitle,"aria-label":`Values for ${u.name}`},e.createElement(ce._,{name:u.name,loading:u.loading,active:u.selected,hidden:u.hidden,facets:u.facets||u.values?.length,onClick:this.onClickLabel})),e.createElement(ae.t7,{height:200,itemCount:u.values?.length||0,itemSize:28,itemKey:C=>u.values[C].name,width:200,className:o.valueList},({index:C,style:m})=>{const L=u.values?.[C];return L?e.createElement("div",{style:m},e.createElement(ce._,{name:u.name,value:L?.name,active:L?.selected,highlightParts:L?.highlightParts,onClick:this.onClickValue,searchTerm:n})):null}))))),e.createElement("div",{className:o.section},e.createElement(ie._,null,"3. Resulting selector"),e.createElement("div",{"aria-label":"selector",className:o.selector},d),c&&e.createElement("div",{className:o.validationStatus},c),e.createElement("div",{className:(0,g.cx)(o.status,(r||i)&&o.statusShowing)},e.createElement("span",{className:i?o.error:""},i||r)),e.createElement($e.Lh,null,e.createElement(N.zx,{"aria-label":"Use selector as logs button",disabled:h,onClick:this.onClickRunLogsQuery},"Show logs"),e.createElement(N.zx,{"aria-label":"Use selector as metrics button",variant:"secondary",disabled:h,onClick:this.onClickRunMetricsQuery},"Show logs rate"),e.createElement(N.zx,{"aria-label":"Validate submit button",variant:"secondary",disabled:h,onClick:this.onClickValidate},"Validate selector"),e.createElement(N.zx,{"aria-label":"Selector clear button",variant:"secondary",onClick:this.onClickClear},"Clear"))))}}const je=(0,O.HE)(ze),Ke=a=>{const{isOpen:t,onClose:s,datasource:n,app:r}=a,[i,c]=(0,e.useState)(!1),[o,d]=(0,e.useState)(!1),h="grafana.datasources.loki.browser.labels",f=(0,O.wW)(Ge);(0,e.useEffect)(()=>{t&&n.languageProvider.start().then(()=>{c(!0),d(n.languageProvider.getLabelKeys().length>0)})},[n,t]);const u=L=>{const{query:v,onChange:p,onRunQuery:M}=a,y={...v,expr:L};p(y),M()},C=L=>{u(L),s()},m=()=>{(0,T.ff)("grafana_loki_label_browser_closed",{app:r,closeType:"modalClose"}),s()};return e.createElement(G.u,{isOpen:t,title:"Label browser",onDismiss:m,className:f.modal},!i&&e.createElement(I.u,{text:"Loading labels..."}),i&&!o&&e.createElement("p",null,"No labels found."),i&&o&&e.createElement(te.G,{storageKey:h,defaultValue:[]},(L,v,p)=>e.createElement(je,{languageProvider:n.languageProvider,onChange:C,lastUsedLabels:L,storeLastUsedLabels:v,deleteLastUsedLabels:p,app:r})))},Ge=a=>({modal:g.css`
      width: 85vw;
      ${a.breakpoints.down("md")} {
        width: 100%;
      }
    `});var He=l(32557),k=l(39682),Z=l(21745),Ze=l(69311),X=l(63134),J=l(53217);function Ye({item:a,defaultOp:t,onChange:s,onDelete:n,onGetLabelNames:r,onGetLabelValues:i,invalidLabel:c,invalidValue:o}){const[d,h]=(0,e.useState)({}),f=(m=a.op)=>Le.find(L=>L.label===m)?.isMultiValue,u=m=>m?m.indexOf("|")>0?m.split("|"):[m]:[],C=()=>{const m=d.labelValues?[...d.labelValues]:[],L=u(a?.value).map(X.E);return(0,w.uniqBy)([...L,...m],"value")};return e.createElement("div",{"data-testid":"prometheus-dimensions-filter-item"},e.createElement(x.InputGroup,null,e.createElement(J.Ph,{placeholder:"Select label","aria-label":W.wl.components.QueryBuilder.labelSelect,inputId:"prometheus-dimensions-filter-item-key",width:"auto",value:a.label?(0,X.E)(a.label):null,allowCustomValue:!0,onOpenMenu:async()=>{h({isLoadingLabelNames:!0});const m=await r(a);h({labelNames:m,isLoadingLabelNames:void 0})},isLoading:d.isLoadingLabelNames,options:d.labelNames,onChange:m=>{m.label&&s({...a,op:a.op??t,label:m.label})},invalid:c}),e.createElement(J.Ph,{"aria-label":W.wl.components.QueryBuilder.matchOperatorSelect,value:(0,X.E)(a.op??t),options:Le,width:"auto",onChange:m=>{m.value!=null&&s({...a,op:m.value,value:f(m.value)?a.value:u(a?.value)[0]})}}),e.createElement(J.Ph,{placeholder:"Select value","aria-label":W.wl.components.QueryBuilder.valueSelect,inputId:"prometheus-dimensions-filter-item-value",width:"auto",value:f()?u(a?.value).map(X.E):u(a?.value).map(X.E)[0],allowCustomValue:!0,onOpenMenu:async()=>{h({isLoadingLabelValues:!0});const m=await i(a);h({...d,labelValues:m,isLoadingLabelValues:void 0})},isMulti:f(),isLoading:d.isLoadingLabelValues,options:C(),onChange:m=>{if(m.value)s({...a,value:m.value,op:a.op??t});else{const L=m.map(v=>v.label).join("|");s({...a,value:L,op:a.op??t})}},invalid:o}),e.createElement(x.AccessoryButton,{"aria-label":"remove",icon:"times",variant:"secondary",onClick:n})))}const Le=[{label:"=~",value:"=~",isMultiValue:!0},{label:"=",value:"=",isMultiValue:!1},{label:"!=",value:"!=",isMultiValue:!1},{label:"!~",value:"!~",isMultiValue:!0}],Xe="Select at least 1 label filter (label and value)";function Je({labelsFilters:a,onChange:t,onGetLabelNames:s,onGetLabelValues:n,labelFilterRequired:r}){const i="=",[c,o]=(0,e.useState)([{op:i}]);(0,e.useEffect)(()=>{a.length>0?o(a):o([{op:i}])},[a]);const d=f=>{o(f);const u=f.filter(C=>C.label!=null&&C.value!=null);(0,w.isEqual)(u,a)||t(u)},h=c.some(f=>f.label&&f.value);return e.createElement(x.EditorFieldGroup,null,e.createElement(x.EditorField,{label:"Label filters",error:Xe,invalid:r&&!h},e.createElement(x.EditorList,{items:c,onChange:d,renderItem:(f,u,C)=>e.createElement(Ye,{item:f,defaultOp:i,onChange:u,onDelete:C,onGetLabelNames:s,onGetLabelValues:n,invalidLabel:r&&!f.label,invalidValue:r&&!f.value})})))}var xe=l(58439),qe=l(41285),Se=l(19023),_e=l(73250),et=l(75765),se=l(45204),le=l(19370),Ce=l(91720);const Me="Fetch all log lines matching label filters.",Ne=e.memo(({query:a})=>{const t=(0,Z._)(a||"").query,s={grammar:le.xY,name:"lokiql"};return e.createElement(x.Stack,{gap:0,direction:"column"},e.createElement(xe.B,{stepNumber:1,title:e.createElement(se.U,{query:`${k.y.renderLabels(t.labels)}`,lang:s})},Me),e.createElement(Se.V,{stepNumber:2,queryModeller:k.y,query:t,lang:s}))});Ne.displayName="LokiQueryBuilderExplained";var he=l(68668),tt=l(8180),at=l(75215);const Qe=e.memo(({nestedQuery:a,index:t,datasource:s,onChange:n,onRemove:r,onRunQuery:i,showExplain:c})=>{const o=(0,O.wW)(lt);return e.createElement("div",{className:o.card},e.createElement("div",{className:o.header},e.createElement("div",{className:o.name},"Operator"),e.createElement(J.Ph,{"aria-label":"Select operator",width:"auto",options:st,value:(0,X.E)(a.operator),onChange:d=>{n(t,{...a,operator:d.value})}}),e.createElement("div",{className:o.name},"Vector matches"),e.createElement("div",{className:o.vectorMatchWrapper},e.createElement(J.Ph,{width:"auto",value:a.vectorMatchesType||"on",allowCustomValue:!0,options:[{value:"on",label:"on"},{value:"ignoring",label:"ignoring"}],onChange:d=>{n(t,{...a,vectorMatchesType:d.value})}}),e.createElement(he.H,{className:o.vectorMatchInput,minWidth:20,defaultValue:a.vectorMatches,onCommitChange:d=>{n(t,{...a,vectorMatches:d.currentTarget.value,vectorMatchesType:a.vectorMatchesType||"on"})}})),e.createElement(x.FlexItem,{grow:1}),e.createElement(tt.h,{ariaLabel:"Remove nested query",name:"times",size:"sm",onClick:()=>r(t)})),e.createElement("div",{className:o.body},e.createElement(x.EditorRows,null,e.createElement(pe,{showExplain:c,query:a.query,datasource:s,onRunQuery:i,onChange:d=>{n(t,{...a,query:d})}}))))}),st=at.i.map(a=>({label:a.sign,value:a.sign}));Qe.displayName="NestedQuery";const lt=a=>({card:(0,g.css)({label:"card",display:"flex",flexDirection:"column",gap:a.spacing(.5)}),header:(0,g.css)({label:"header",padding:a.spacing(.5,.5,.5,1),gap:a.spacing(1),display:"flex",alignItems:"center"}),name:(0,g.css)({label:"name",whiteSpace:"nowrap"}),body:(0,g.css)({label:"body",paddingLeft:a.spacing(2)}),vectorMatchInput:(0,g.css)({label:"vectorMatchInput",marginLeft:-1}),vectorMatchWrapper:(0,g.css)({label:"vectorMatchWrapper",display:"flex"})});function nt({query:a,datasource:t,onChange:s,onRunQuery:n,showExplain:r}){const i=a.binaryQueries??[],c=(d,h)=>{const f=[...i];f.splice(d,1,h),s({...a,binaryQueries:f})},o=d=>{const h=[...i.slice(0,d),...i.slice(d+1)];s({...a,binaryQueries:h})};return e.createElement(x.Stack,{direction:"column",gap:1},i.map((d,h)=>e.createElement(Qe,{key:h.toString(),nestedQuery:d,index:h,onChange:c,datasource:t,onRemove:o,onRunQuery:n,showExplain:r})))}const pe=e.memo(({datasource:a,query:t,onChange:s,onRunQuery:n,showExplain:r})=>{const[i,c]=(0,e.useState)(),[o,d]=(0,e.useState)(void 0),h=v=>{s({...t,labels:v})},f=async v=>{const p=await v;return[...a.getVariables(),...p].map(M=>({label:M,value:M}))},u=async v=>{const p=t.labels.filter(Y=>Y!==v);if(p.length===0)return await a.languageProvider.refreshLogLabels(),a.languageProvider.getLabelKeys();const M=k.y.renderLabels(p),y=await a.languageProvider.fetchSeriesLabels(M),q=p.map(Y=>Y.label);return Object.keys(y).filter(Y=>!q.includes(Y)).sort()},C=async v=>{if(!v.label)return[];let p;const M=t.labels.filter(y=>y!==v);if(M.length===0)p=await a.languageProvider.fetchLabelValues(v.label);else{const y=k.y.renderLabels(M);p=(await a.languageProvider.fetchSeriesLabels(y))[a.interpolateString(v.label)]}return p?p.map(y=>(0,ue.Hk)(y,v.op)):[]},m=(0,e.useMemo)(()=>{const{labels:v,operations:p}=t;return!v.length&&p.length?!(p.length===1&&p[0].id===Ce.B5.LineContains&&p[0].params[0]===""):!1},[t]);(0,e.useEffect)(()=>{(async()=>{const p={expr:k.y.renderQuery(t),refId:"data-samples"},y={series:await a.getDataSamples(p),state:F.Gu.Done,timeRange:(0,Ze.JK)()};c(y)})().catch(console.error)},[a,t]);const L={grammar:le.ZP,name:"logql"};return e.createElement("div",{"data-testid":Ee.editor},e.createElement(x.EditorRow,null,e.createElement(Je,{onGetLabelNames:v=>f(u(v)),onGetLabelValues:v=>f(C(v)),labelsFilters:t.labels,onChange:h,labelFilterRequired:m})),r&&e.createElement(xe.B,{stepNumber:1,title:e.createElement(se.U,{query:`${k.y.renderLabels(t.labels)}`,lang:L})},Me),e.createElement(_e.B,null,e.createElement(qe.P,{queryModeller:k.y,query:t,onChange:s,onRunQuery:n,datasource:a,highlightedOp:o}),e.createElement(et.L,{datasource:a,query:t,onChange:s,data:i,queryModeller:k.y,buildVisualQueryFromString:Z._})),r&&e.createElement(Se.V,{stepNumber:2,queryModeller:k.y,query:t,lang:L,onMouseEnter:v=>{d(v)},onMouseLeave:()=>{d(void 0)}}),t.binaryQueries&&t.binaryQueries.length>0&&e.createElement(nt,{query:t,datasource:a,onChange:s,onRunQuery:n,showExplain:r}))});pe.displayName="LokiQueryBuilder";function rt({query:a}){return e.createElement(x.EditorRow,null,e.createElement(x.EditorFieldGroup,null,e.createElement(se.U,{query:a,lang:{grammar:le.xY,name:"lokiql"}})))}function ot(a){const{query:t,onChange:s,onRunQuery:n,datasource:r,showExplain:i}=a,[c,o]=(0,e.useReducer)(Pe.reducer,{expr:t.expr,visQuery:t.expr===""?{labels:[],operations:[{id:"__line_contains",params:[""]}]}:void 0});(0,e.useEffect)(()=>{o(ct(t.expr))},[t.expr]);const d=h=>{const f=k.y.renderQuery(h);o(it({visQuery:h,expr:f})),s({...a.query,expr:f})};return c.visQuery?e.createElement(e.Fragment,null,e.createElement(pe,{query:c.visQuery,datasource:r,onChange:d,onRunQuery:n,showExplain:i,"data-testid":Ee.editor}),t.expr!==""&&e.createElement(rt,{query:t.expr})):null}const Pe=(0,He.oM)({name:"loki-builder-container",initialState:{expr:""},reducers:{visualQueryChange:(a,t)=>{a.expr=t.payload.expr,a.visQuery=t.payload.visQuery},exprChanged:(a,t)=>{if(!a.visQuery||a.expr!==t.payload){a.expr=t.payload;const s=(0,Z._)(t.payload);a.visQuery=s.query}}}}),{visualQueryChange:it,exprChanged:ct}=Pe.actions;var Fe=l(54291),ut=l(2594),dt=l(38435),ee=l(47138),mt=l(24666),fe=l(92555);const Te=e.memo(({app:a,query:t,onChange:s,onRunQuery:n,maxLines:r,datasource:i})=>{const[c,o]=(0,e.useState)(),d=(0,Fe.Z)(t),h=v=>{s({...t,queryType:v}),n()},f=v=>{(0,T.ff)("grafana_loki_resolution_clicked",{app:a,resolution:v.value}),s({...t,resolution:v.value}),n()},u=v=>{s({...t,legendFormat:v.currentTarget.value}),n()};function C(v){const p=(0,ee.Wz)(v.currentTarget.value);t.maxLines!==p&&(s({...t,maxLines:p}),n())}(0,e.useEffect)(()=>{if(t.expr===d?.expr)return;if(!t.expr){o(void 0);return}(async()=>{const p=await i.getQueryStats(t);Object.values(p).every(M=>M===0)?o(void 0):o(p)})()},[t,d,i]);let m=t.queryType??(t.instant?fe.EM.Instant:fe.EM.Range),L=(0,mt.rE)(t.expr);return e.createElement(x.EditorRow,null,e.createElement(dt.d,{title:"Options",collapsedInfo:gt(t,m,L,r),queryStats:c},e.createElement(x.EditorField,{label:"Legend",tooltip:"Series name override or template. Ex. {{hostname}} will be replaced with label value for hostname."},e.createElement(he.H,{placeholder:"{{label}}",id:"loki-query-editor-legend-format",type:"string",minWidth:14,defaultValue:t.legendFormat,onCommitChange:u})),e.createElement(x.EditorField,{label:"Type"},e.createElement(ut.S,{options:ee.uG,value:m,onChange:h})),L&&e.createElement(x.EditorField,{label:"Line limit",tooltip:"Upper limit for number of log lines returned by query."},e.createElement(he.H,{className:"width-4",placeholder:r.toString(),type:"number",min:0,defaultValue:t.maxLines?.toString()??"",onCommitChange:C})),e.createElement(x.EditorField,{label:"Resolution"},e.createElement(J.Ph,{isSearchable:!1,onChange:f,options:ee.oZ,value:t.resolution||1,"aria-label":"Select resolution"}))))});function gt(a,t,s,n){const r=ee.uG.find(o=>o.value===t),i=ee.oZ.find(o=>o.value===(a.resolution??1)),c=[];return a.legendFormat&&c.push(`Legend: ${a.legendFormat}`),a.resolution&&c.push(`Resolution: ${i?.label}`),c.push(`Type: ${r?.label}`),s&&c.push(`Line limit: ${a.maxLines??n}`),c}Te.displayName="LokiQueryBuilderOptions";var De=l(91159);function ht({query:a,datasource:t,range:s,onRunQuery:n,onChange:r,data:i,app:c,showExplain:o,history:d}){const h=(0,O.wW)(pt),f=c===E.zj.Explore?()=>{}:void 0;return e.createElement("div",{className:h.wrapper},e.createElement(De.n,{datasource:t,query:a,range:s,onRunQuery:n,onChange:r,onBlur:f,history:d,data:i,app:c,"data-testid":Ee.editor}),o&&e.createElement(Ne,{query:a.expr}))}const pt=a=>({wrapper:g.css`
      max-width: 100%;
      .gf-form {
        margin-bottom: 0.5;
      }
    `});var ft=l(2352),vt=l(99822),ve=l(72948);const Et=a=>{const{pattern:t,onPatternSelect:s,hasNewQueryOption:n,hasPreviousQuery:r,selectedPatternName:i,setSelectedPatternName:c}=a,o=(0,O.wW)(yt),d={grammar:le.ZP,name:"logql"};return e.createElement(ve.Z,{className:o.card},e.createElement(ve.Z.Heading,null,t.name),e.createElement("div",{className:o.rawQueryContainer},e.createElement(se.U,{query:k.y.renderQuery({labels:[],operations:t.operations}),lang:d,className:o.rawQuery})),e.createElement(ve.Z.Actions,null,i!==t.name?e.createElement(N.zx,{size:"sm",onClick:()=>{r?c(t.name):s(t)}},"Use this query"):e.createElement(e.Fragment,null,e.createElement("div",{className:o.spacing},`If you would like to use this query, ${n?"you can either replace your current query or create a new query":"your current query will be replaced"}.`),e.createElement(N.zx,{size:"sm",fill:"outline",onClick:()=>c(null)},"Back"),e.createElement(N.zx,{size:"sm",onClick:()=>{s(t)}},"Replace query"),n&&e.createElement(N.zx,{size:"sm",onClick:()=>{s(t,!0)}},"Create new query"))))},yt=a=>({card:g.css`
      width: 49.5%;
      display: flex;
      flex-direction: column;
    `,rawQueryContainer:g.css`
      flex-grow: 1;
    `,rawQuery:g.css`
      background-color: ${a.colors.background.primary};
      padding: ${a.spacing(1)};
      margin-top: ${a.spacing(1)};
    `,spacing:g.css`
      margin-bottom: ${a.spacing(1)};
    `}),bt=a=>{const{isOpen:t,onClose:s,onChange:n,onAddQuery:r,query:i,queries:c,app:o}=a,[d,h]=(0,e.useState)([]),[f,u]=(0,e.useState)(null),C=(0,O.wW)(Lt),m=!!r,L=(0,e.useMemo)(()=>(0,Z._)(i.expr).query.operations.length>0,[i.expr]),v=(p,M=!1)=>{const y=(0,Z._)(M?"":i.expr);(0,T.ff)("grafana_loki_query_patterns_selected",{version:"v2",app:o??"",editorMode:i.editorMode,selectedPattern:p.name,preSelectedOperationsCount:y.query.operations.length,preSelectedLabelsCount:y.query.labels.length,createNewQuery:m&&M}),y.query.operations=p.operations,m&&M?r({...i,refId:(0,vt.Hs)(c??[i]),expr:k.y.renderQuery(y.query)}):n({...i,expr:k.y.renderQuery(y.query)}),u(null),s()};return e.createElement(G.u,{isOpen:t,title:"Kick start your query",onDismiss:s,className:C.modal},e.createElement("div",{className:C.spacing},"Kick start your query by selecting one of these queries. You can then continue to complete your query."),Object.values(Ce.Hv).map(p=>e.createElement(ft.U,{key:p,label:`${(0,w.capitalize)(p)} query starters`,isOpen:d.includes(p),collapsible:!0,onToggle:()=>h(M=>M.includes(p)?M.filter(y=>y!==p):[...M,p])},e.createElement("div",{className:C.cardsContainer},k.y.getQueryPatterns().filter(M=>M.type===p).map(M=>e.createElement(Et,{key:M.name,pattern:M,hasNewQueryOption:m,hasPreviousQuery:L,onPatternSelect:v,selectedPatternName:f,setSelectedPatternName:u}))))),e.createElement(N.zx,{variant:"secondary",onClick:s},"Close"))},Lt=a=>({cardsContainer:g.css`
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      justify-content: space-between;
    `,spacing:g.css`
      margin-bottom: ${a.spacing(1)};
    `,modal:g.css`
      width: 85vw;
      ${a.breakpoints.down("md")} {
        width: 100%;
      }
    `});var Re=l(58379);const Oe="LokiQueryEditorModeDefault";function xt(a,t,s){a.expr===""&&Re.Z.set(Oe,t),s({...a,editorMode:t})}function St(a){if(a!=null&&a!=="")return S.c.Code;const t=Re.Z.get(Oe);switch(t){case S.c.Builder:case S.c.Code:return t;default:return S.c.Builder}}function Ct(a){let t=a;return a.editorMode||(t={...a,editorMode:St(a.expr)}),a.expr==null&&(t={...t,expr:""}),a.queryType==null&&(t={...t,queryType:fe.EM.Range}),t}const Ee={editor:"loki-editor"},Be=e.memo(a=>{const{onChange:t,onRunQuery:s,onAddQuery:n,data:r,app:i,queries:c,datasource:o}=a,[d,h]=(0,e.useState)(!1),[f,u]=(0,e.useState)(!1),[C,m]=(0,e.useState)(!1),[L,v]=(0,e.useState)(!1),{flag:p,setFlag:M}=(0,$.P5)($.iS),y=Ct(a.query),q=y.editorMode,ke=j=>{M(j.currentTarget.checked)},Y=(0,e.useCallback)(j=>{if((0,T.ff)("grafana_loki_editor_mode_clicked",{newEditor:j,previousEditor:y.editorMode??"",newQuery:!y.expr,app:i??""}),j===S.c.Builder&&(0,Z._)(y.expr||"").errors.length){h(!0);return}xt(y,j,t)},[t,y,i]);(0,e.useEffect)(()=>{m(!1)},[r]);const be=j=>{m(!0),t(j)},na=()=>{(0,T.ff)("grafana_loki_label_browser_opened",{app:i}),v(j=>!j)};return e.createElement(e.Fragment,null,e.createElement(re.s,{isOpen:d,title:"Query parsing",body:"There were errors while trying to parse the query. Continuing to visual builder may lose some parts of the query.",confirmText:"Continue",onConfirm:()=>{t({...y,editorMode:S.c.Builder}),h(!1)},onDismiss:()=>h(!1)}),e.createElement(bt,{isOpen:f,onClose:()=>u(!1),query:y,queries:c,app:i,onChange:t,onAddQuery:n}),e.createElement(Ke,{isOpen:L,datasource:o,query:y,app:i,onClose:()=>v(!1),onChange:be,onRunQuery:s}),e.createElement(x.EditorHeader,null,e.createElement(x.Stack,{gap:1},e.createElement(N.zx,{"aria-label":W.wl.components.QueryBuilder.queryPatterns,variant:"secondary",size:"sm",onClick:()=>{u(Ue=>!Ue);const j=(0,Z._)(y.expr||"");(0,T.ff)("grafana_loki_query_patterns_opened",{version:"v2",app:i??"",editorMode:y.editorMode,preSelectedOperationsCount:j.query.operations.length,preSelectedLabelsCount:j.query.labels.length})}},"Kick start your query"),e.createElement(N.zx,{variant:"secondary",size:"sm",onClick:na,"data-testid":"label-browser-button"},"Label browser")),e.createElement(D.n,{label:"Explain query",value:p,onChange:ke}),e.createElement(x.FlexItem,{grow:1}),i!==E.zj.Explore&&i!==E.zj.Correlations&&e.createElement(N.zx,{variant:C?"primary":"secondary",size:"sm",onClick:s,icon:r?.state===F.Gu.Loading?"fa fa-spinner":void 0,disabled:r?.state===F.Gu.Loading},"Run queries"),e.createElement(z.k,{mode:q,onChange:Y})),e.createElement(x.Space,{v:.5}),e.createElement(x.EditorRows,null,q===S.c.Code&&e.createElement(ht,{...a,query:y,onChange:be,showExplain:p}),q===S.c.Builder&&e.createElement(ot,{datasource:a.datasource,query:y,onChange:be,onRunQuery:a.onRunQuery,showExplain:p}),e.createElement(Te,{query:y,onChange:t,onRunQuery:s,app:i,maxLines:o.maxLines,datasource:o})))});Be.displayName="LokiQueryEditor";function Mt(a){const{query:t,data:s,datasource:n,onChange:r,onRunQuery:i,history:c}=a;return e.createElement(De.n,{datasource:n,query:t,onChange:r,onRunQuery:i,onBlur:i,history:c,data:s,placeholder:"Enter a Loki query","data-testid":Nt.editor})}const Nt={editor:"loki-editor-cloud-alerting"};function Qt(a){const{app:t}=a;switch(t){case E.zj.CloudAlerting:return e.createElement(Mt,{...a});default:return e.createElement(Be,{...a})}}const Pt=(0,e.memo)(Qt),ra={editor:"loki-editor"};var Ft=l(35645),Tt=l(12006),Dt=l(12580),Rt=l(64260),Ot=l(89029),Bt=l(28151),wt=l(9085),kt=l.n(wt),Ut=l(14582),Vt=l(19695),ye=l(14835),$t=l(71570);const{FormField:It}=ye.LegacyForms,At=a=>{const{derivedFields:t,className:s}=a,[n,r]=(0,e.useState)("");let i=[];return n&&t&&(i=zt(t,n)),e.createElement("div",{className:s},e.createElement(It,{labelWidth:12,label:"Debug log message",inputEl:e.createElement("textarea",{placeholder:"Paste an example log line here to test the regular expressions of your derived fields",className:kt()("gf-form-input gf-form-textarea",g.css`
                width: 100%;
              `),value:n,onChange:c=>r(c.currentTarget.value)})}),!!i.length&&e.createElement(Wt,{fields:i}))},Wt=({fields:a})=>e.createElement("table",{className:"filter-table"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,"Name"),e.createElement("th",null,"Value"),e.createElement("th",null,"Url"))),e.createElement("tbody",null,a.map(t=>{let s=t.value;return t.error&&t.error instanceof Error?s=t.error.message:t.href&&(s=e.createElement("a",{href:t.href},s)),e.createElement("tr",{key:`${t.name}=${t.value}`},e.createElement("td",null,t.name),e.createElement("td",null,s),e.createElement("td",null,t.href?e.createElement("a",{href:t.href},t.href):""))})));function zt(a,t){return a.filter(s=>s.name&&s.matcherRegex).map(s=>{try{const n=t.match(s.matcherRegex),r=n&&n[1];let i=null;return s.url&&r&&(i=(0,$t.a)({field:{name:"",type:Ut.fS.string,values:new Vt.G([r]),config:{links:[{title:"",url:s.url}]}},rowIndex:0,range:{}})[0]),{name:s.name,value:r||"<no match>",href:i?i.href:void 0}}catch(n){return{name:s.name,error:n}}})}var jt=l(53117),Kt=l(35919);const{Switch:Gt,FormField:ne}=ye.LegacyForms,Ht=a=>({row:g.css`
    display: flex;
    align-items: baseline;
  `,nameField:g.css`
    flex: 2;
  `,regexField:g.css`
    flex: 3;
  `,urlField:g.css`
    flex: 1;
    margin-right: ${a.spacing(.5)};
  `,urlDisplayLabelField:g.css`
    flex: 1;
  `}),Zt=a=>{const{value:t,onChange:s,onDelete:n,suggestions:r,className:i}=a,c=(0,O.wW)(Ht),[o,d]=(0,e.useState)(!!t.datasourceUid),h=(0,Fe.Z)(t.datasourceUid);(0,e.useEffect)(()=>{!h&&t.datasourceUid&&!o&&d(!0),h&&!t.datasourceUid&&o&&d(!1)},[h,t.datasourceUid,o]);const f=u=>C=>{s({...t,[u]:C.currentTarget.value})};return e.createElement("div",{className:i,"data-testid":"derived-field"},e.createElement("div",{className:"gf-form"},e.createElement(ne,{labelWidth:10,className:c.nameField,inputWidth:null,label:"Name",type:"text",value:t.name,onChange:f("name")}),e.createElement(ne,{labelWidth:10,className:c.regexField,inputWidth:null,label:"Regex",type:"text",value:t.matcherRegex,onChange:f("matcherRegex"),tooltip:"Use to parse and capture some part of the log message. You can use the captured groups in the template."}),e.createElement(N.zx,{variant:"destructive",title:"Remove field",icon:"times",onClick:u=>{u.preventDefault(),n()}})),e.createElement("div",{className:"gf-form"},e.createElement(ne,{labelWidth:10,label:o?"Query":"URL",inputEl:e.createElement(Kt.v,{placeholder:o?"${__value.raw}":"http://example.com/${__value.raw}",value:t.url||"",onChange:u=>s({...t,url:u}),suggestions:r}),className:c.urlField}),e.createElement(ne,{className:c.urlDisplayLabelField,labelWidth:10,inputWidth:null,label:"URL Label",type:"text",value:t.urlDisplayLabel,onChange:f("urlDisplayLabel"),tooltip:"Use to override the button label when this derived field is found in a log."})),e.createElement("div",{className:c.row},e.createElement(Gt,{label:"Internal link",checked:o,onChange:()=>{o&&s({...t,datasourceUid:void 0}),d(!o)}}),o&&e.createElement(jt.q,{tracing:!0,onChange:u=>s({...t,datasourceUid:u.uid}),current:t.datasourceUid})))},Yt=a=>({infoText:g.css`
    padding-bottom: ${a.spacing(2)};
    color: ${a.colors.text.secondary};
  `,derivedField:g.css`
    margin-bottom: ${a.spacing(1)};
  `}),Xt=({value:a=[],onChange:t})=>{const s=(0,O.l4)(),n=Yt(s),[r,i]=(0,e.useState)(!1);return e.createElement(e.Fragment,null,e.createElement("h3",{className:"page-heading"},"Derived fields"),e.createElement("div",{className:n.infoText},"Derived fields can be used to extract new fields from a log message and create a link from its value."),e.createElement("div",{className:"gf-form-group"},a.map((c,o)=>e.createElement(Zt,{className:n.derivedField,key:o,value:c,onChange:d=>{const h=[...a];h.splice(o,1,d),t(h)},onDelete:()=>{const d=[...a];d.splice(o,1),t(d)},suggestions:[{value:Ot.W.valueRaw,label:"Raw value",documentation:"Exact string captured by the regular expression",origin:Bt.L.Value}]})),e.createElement("div",null,e.createElement(N.zx,{variant:"secondary",className:g.css`
              margin-right: 10px;
            `,icon:"plus",onClick:c=>{c.preventDefault();const o=[...a,{name:"",matcherRegex:""}];t(o)}},"Add"),a.length>0&&e.createElement(N.zx,{variant:"secondary",type:"button",onClick:()=>i(!r)},r?"Hide example log message":"Show example log message"))),r&&e.createElement("div",{className:"gf-form-group"},e.createElement(At,{className:g.css`
              margin-bottom: 10px;
            `,derivedFields:a})))},{FormField:Jt}=ye.LegacyForms,qt=a=>{const{value:t,onChange:s}=a;return e.createElement(Jt,{label:"Maximum lines",labelWidth:11,inputWidth:20,inputEl:e.createElement("input",{type:"number",className:"gf-form-input width-8 gf-form-input--has-help-icon",value:t,onChange:n=>s(n.currentTarget.value),spellCheck:!1,placeholder:"1000"}),tooltip:e.createElement(e.Fragment,null,"Loki queries must contain a limit of the maximum number of lines returned (default: 1000). Increase this limit to have a bigger result set for ad-hoc analysis. Decrease this limit if your browser becomes sluggish when displaying the log results.")})},we=a=>(t,s)=>({...t,jsonData:{...t.jsonData,[a]:s}}),_t=we("maxLines"),ea=we("derivedFields"),ta=a=>{const{options:t,onOptionsChange:s}=a;return e.createElement(e.Fragment,null,e.createElement(Tt.E,{defaultUrl:"http://localhost:3100",dataSourceConfig:t,showAccessOptions:!1,onChange:s}),Ft.v.featureToggles.secureSocksDatasourceProxy&&e.createElement(Dt.i,{options:t,onOptionsChange:s}),e.createElement(Rt.O,{options:t,onOptionsChange:s}),e.createElement("div",{className:"gf-form-group"},e.createElement("div",{className:"gf-form-inline"},e.createElement("div",{className:"gf-form"},e.createElement(qt,{value:t.jsonData.maxLines||"",onChange:n=>s(_t(t,n))})))),e.createElement(Xt,{value:t.jsonData.derivedFields,onChange:n=>s(ea(t,n))}))};var aa=l(85444),sa=l(32920);const la=new P.hf(aa.KV).setQueryEditor(Pt).setConfigEditor(ta).setQueryEditorHelp(R);(0,K.N$)().subscribe(b.Pl,sa.u)},58439:(_,A,l)=>{l.d(A,{B:()=>e});var P=l(52423),b=l(68404),K=l(41959),w=l(72648);function e({title:Q,stepNumber:B,markdown:U,children:V}){const R=(0,w.wW)(T);return b.createElement("div",{className:R.box},B!==void 0&&b.createElement("div",{className:R.stepNumber},B),b.createElement("div",{className:R.boxInner},Q&&b.createElement("div",{className:R.header},b.createElement("span",null,Q)),b.createElement("div",{className:R.body},U&&b.createElement("div",{dangerouslySetInnerHTML:{__html:(0,K.a)(U)}}),V)))}const T=Q=>({box:(0,P.css)({background:Q.colors.background.secondary,padding:Q.spacing(1),borderRadius:Q.shape.borderRadius(),position:"relative"}),boxInner:(0,P.css)({marginLeft:Q.spacing(4)}),stepNumber:(0,P.css)({fontWeight:Q.typography.fontWeightMedium,background:Q.colors.secondary.main,width:"20px",height:"20px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"10px",left:"11px",fontSize:Q.typography.bodySmall.fontSize}),header:(0,P.css)({paddingBottom:Q.spacing(.5),display:"flex",alignItems:"center",fontFamily:Q.typography.fontFamilyMonospace}),body:(0,P.css)({color:Q.colors.text.secondary,"p:last-child":{margin:0},a:{color:Q.colors.text.link,textDecoration:"underline"}})})},19023:(_,A,l)=>{l.d(A,{V:()=>w});var P=l(68404),b=l(58439),K=l(45204);function w({query:e,queryModeller:T,stepNumber:Q,lang:B,onMouseEnter:U,onMouseLeave:V}){return P.createElement(P.Fragment,null,e.operations.map((R,E)=>{const F=T.getOperationDef(R.id);if(!F)return`Operation ${R.id} not found`;const W=F.renderer(R,F,"<expr>"),x=F.explainHandler?F.explainHandler(R,F):F.documentation??"no docs";return P.createElement("div",{key:E,onMouseEnter:()=>U?.(R,E),onMouseLeave:()=>V?.(R,E)},P.createElement(b.B,{stepNumber:E+Q,title:P.createElement(K.U,{query:W,lang:B}),markdown:x}))}))}},45204:(_,A,l)=>{l.d(A,{U:()=>T});var P=l(52423),b=l(57706),K=l.n(b),w=l(68404),e=l(72648);function T({query:B,lang:U,className:V}){const R=(0,e.l4)(),E=Q(R),F=K().highlight(B,U.grammar,U.name);return w.createElement("div",{className:(0,P.cx)(E.editorField,"prism-syntax-highlight",V),"aria-label":"selector",dangerouslySetInnerHTML:{__html:F}})}const Q=B=>({editorField:(0,P.css)({fontFamily:B.typography.fontFamilyMonospace,fontSize:B.typography.bodySmall.fontSize})})}}]);

//# sourceMappingURL=3320.0f79ee2cb74e22e026c0.js.map