"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5296,6092],{44927:(me,F,o)=>{o.d(F,{E:()=>e,z:()=>u});const u=()=>({type:"query",query:{params:["A","5m","now"]},reducer:{type:"avg",params:[]},evaluator:{type:"gt",params:[null]},operator:{type:"and"}}),e=async(D,x,w,E)=>{if(x.length===0)return"Could not find any metric queries";if(D&&D.length)return"Transformations are not supported in alert queries";let b=0,P=0;for(const f of x){const $=f.datasource||E,C=await w.get($);C.meta.alerting?C.targetContainsTemplate&&C.targetContainsTemplate(f)&&P++:b++}return b===x.length?"The datasource does not support alerting queries":P===x.length?"Template variables are not supported in alert queries":""}},94762:(me,F,o)=>{o.d(F,{F:()=>w});var u=o(52423),e=o(68404),D=o(72648),x=o(53731);const w=({renderExpandedContent:b,...P})=>{const f=(0,D.wW)(E);return e.createElement(x.t,{renderExpandedContent:b?($,C,A)=>e.createElement(e.Fragment,null,C!==A.length-1&&e.createElement("div",{className:(0,u.cx)(f.contentGuideline,f.guideline)}),b($,C,A)):void 0,renderPrefixHeader:()=>e.createElement("div",{className:f.relative},e.createElement("div",{className:(0,u.cx)(f.headerGuideline,f.guideline)})),renderPrefixCell:($,C,A)=>e.createElement("div",{className:f.relative},e.createElement("div",{className:(0,u.cx)(f.topGuideline,f.guideline)}),C!==A.length-1&&e.createElement("div",{className:(0,u.cx)(f.bottomGuideline,f.guideline)})),...P})},E=b=>({relative:u.css`
    position: relative;
    height: 100%;
  `,guideline:u.css`
    left: -19px;
    border-left: 1px solid ${b.colors.border.medium};
    position: absolute;

    ${b.breakpoints.down("md")} {
      display: none;
    }
  `,topGuideline:u.css`
    width: 18px;
    border-bottom: 1px solid ${b.colors.border.medium};
    top: 0;
    bottom: 50%;
  `,bottomGuideline:u.css`
    top: 50%;
    bottom: 0;
  `,contentGuideline:u.css`
    top: 0;
    bottom: 0;
    left: -49px !important;
  `,headerGuideline:u.css`
    top: -25px;
    bottom: 0;
  `})},29721:(me,F,o)=>{o.d(F,{V:()=>D});var u=o(68404),e=o(39904);const D=({namespace:x,group:w})=>w?u.createElement(u.Fragment,null,x," ",u.createElement(e.J,{name:"angle-right"})," ",w):u.createElement(u.Fragment,null,x)},25048:(me,F,o)=>{o.d(F,{i:()=>gt});var u=o(52423),e=o(68404),D=o(72648),x=o(84952),w=o(8055),E=o(37190),b=o(79662),P=o(53731),f=o(94762),$=o(40106),C=o(29721),A=o(46587),q=o(70356),_=o(26418),G=o(35645),O=o(61860),j=o(31403),B=o(94599),K=o(98102),Ce=o(60499),He=o(81168),Me=o(44391),pe=o(72004),le=o(45849),ne=o(10505),ge=o(60048),Ge=o(93411),st=o(41273);const Se=h=>window.matchMedia(`(max-width: ${h}px)`).matches,Te=({rule:h,rulesSource:U})=>{const W=(0,He.useDispatch)(),Y=(0,q.TH)(),re=(0,Ce.iG)(),S=(0,D.wW)(be),{namespace:k,group:T,rulerRule:Q}=h,[H,ce]=(0,e.useState)(),X=(0,le.EG)(U),he=(0,b.Pc)(h.rulerRule)&&Boolean(h.rulerRule.grafana_alert.provenance),ie=[],Re=(0,b.Jq)(T),{isEditable:ye,isRemovable:ft}=(0,Me.M)(X,Q),de=Y.pathname+Y.search,fe=ot(Y.pathname),je=()=>{if(H&&H.rulerRule){const z=ge.Zk((0,le.EG)(H.namespace.rulesSource),H.namespace.name,H.group.name,H.rulerRule);W((0,pe.hS)(z,{navigateTo:fe?"/alerting/list":void 0})),ce(void 0)}},$e=()=>{if((0,le.jq)(U)){const{appUrl:z,appSubUrl:ee}=G.v,Ae=ee!==""?`${z}${ee}/`:G.v.appUrl,Et=`${encodeURIComponent(U.name)}/${encodeURIComponent(h.name)}`;return`${Ae}alerting/${Et}/find`}return window.location.href.split("?")[0]},vt=(0,le.EG)(U);if(fe||ie.push(e.createElement(O.u,{placement:"top",content:"View"},e.createElement(j.Qj,{className:S.button,title:"View",size:"sm",key:"view",variant:"secondary",icon:"eye",href:(0,ne.V2)(U,h,de)}))),ye&&Q&&!Re){const z=ge.Zk(vt,k.name,T.name,Q);if(!he){const ee=(0,Ge.u)(`/alerting/${encodeURIComponent(ge.$V(z))}/edit`,{returnTo:de});fe&&ie.push(e.createElement(B.m,{key:"copy",icon:"copy",onClipboardError:Ae=>{re.error("Error while copying URL",Ae)},className:S.button,size:"sm",getText:$e},"Copy link to rule")),ie.push(e.createElement(O.u,{placement:"top",content:"Edit"},e.createElement(j.Qj,{title:"Edit",className:S.button,size:"sm",key:"edit",variant:"secondary",icon:"pen",href:ee})))}ie.push(e.createElement(O.u,{placement:"top",content:"Copy"},e.createElement(st.E,{ruleIdentifier:z,isProvisioned:he,className:S.button})))}return ft&&Q&&!Re&&!he&&ie.push(e.createElement(O.u,{placement:"top",content:"Delete"},e.createElement(j.zx,{title:"Delete",className:S.button,size:"sm",type:"button",key:"delete",variant:"secondary",icon:"trash-alt",onClick:()=>ce(h)}))),ie.length?e.createElement(e.Fragment,null,e.createElement(_.Stack,{gap:1},ie.map((z,ee)=>e.createElement(e.Fragment,{key:ee},z))),!!H&&e.createElement(K.s,{isOpen:!0,title:"Delete rule",body:"Deleting this rule will permanently remove it from your alert rule list. Are you sure you want to delete this rule?",confirmText:"Yes, delete",icon:"exclamation-triangle",onConfirm:je,onDismiss:()=>ce(void 0)})):null};function ot(h){return h.endsWith("/view")}const be=h=>({button:u.css`
    padding: 0 ${h.spacing(2)};
  `});var De=o(39904),ae=o(82963);function L({rule:h}){const U=(0,D.wW)(it),{exceedsLimit:W}=(0,e.useMemo)(()=>(0,ae.f)(h.group.interval),[h.group.interval]);return W?e.createElement(O.u,{theme:"error",content:e.createElement("div",null,"A minimum evaluation interval of"," ",e.createElement("span",{className:U.globalLimitValue},G.v.unifiedAlerting.minInterval)," has been configured in Grafana and will be used instead of the ",h.group.interval," interval configured for the Rule Group.")},e.createElement(De.J,{name:"stopwatch-slash",className:U.icon})):null}function it(h){return{globalLimitValue:u.css`
      font-weight: ${h.typography.fontWeightBold};
    `,icon:u.css`
      fill: ${h.colors.warning.text};
    `}}var lt=o(52694),Ie=o(80498),Ke=o(49279),ct=o(68854),Ne=o(24990),xe=o(8674),ke=o(78443);const oe=15,dt=({rule:h})=>{const U=(0,D.wW)(ut),{namespace:{rulesSource:W}}=h,Y=Object.entries(h.annotations).filter(([re,S])=>!!S.trim());return e.createElement("div",null,e.createElement(Ke.f,{rule:h,rulesSource:W,isViewMode:!1}),e.createElement("div",{className:U.wrapper},e.createElement("div",{className:U.leftSide},e.createElement(Ze,{rule:h}),!!h.labels&&!!Object.keys(h.labels).length&&e.createElement(Ie.C,{label:"Labels",horizontal:!0},e.createElement(lt.s,{labels:h.labels})),e.createElement(xe.C,{rulesSource:W,rule:h,annotations:Y}),e.createElement(ct.J,{annotations:Y})),e.createElement("div",{className:U.rightSide},e.createElement(Ne.C,{rulesSource:W,rule:h}))),e.createElement(ke.M,{rule:h,itemsDisplayLimit:oe}))},Ze=({rule:h})=>{let U,W=h.group.interval;return(0,b.yF)(h.rulerRule)||(U=h.rulerRule?.for),e.createElement(e.Fragment,null,W&&e.createElement(Ie.C,{label:"Evaluate",horizontal:!0},"Every ",W),U&&e.createElement(Ie.C,{label:"For",horizontal:!0},U))},ut=h=>({wrapper:u.css`
    display: flex;
    flex-direction: row;

    ${h.breakpoints.down("md")} {
      flex-direction: column;
    }
  `,leftSide:u.css`
    flex: 1;
  `,rightSide:u.css`
    ${h.breakpoints.up("md")} {
      padding-left: 90px;
      width: 300px;
    }
  `});var mt=o(80399),pt=o(48208);const gt=({rules:h,className:U,showGuidelines:W=!1,emptyMessage:Y="No rules found.",showGroupColumn:re=!1,showSummaryColumn:S=!1})=>{const k=(0,D.wW)(we),T=(0,u.cx)(k.wrapper,U,{[k.wrapperMargin]:W}),Q=(0,e.useMemo)(()=>h.map((X,he)=>({id:`${X.namespace.name}-${X.group.name}-${X.name}-${he}`,data:X})),[h]),H=ht(S,re);if(!h.length)return e.createElement("div",{className:(0,u.cx)(T,k.emptyMessage)},Y);const ce=W?f.F:P.t;return e.createElement("div",{className:T,"data-testid":"rules-table"},e.createElement(ce,{cols:H,isExpandable:!0,items:Q,renderExpandedContent:({data:X})=>e.createElement(dt,{rule:X}),pagination:{itemsPerPage:x.gN},paginationStyles:k.pagination}))},we=h=>({wrapperMargin:u.css`
    ${h.breakpoints.up("md")} {
      margin-left: 36px;
    }
  `,emptyMessage:u.css`
    padding: ${h.spacing(1)};
  `,wrapper:u.css`
    width: auto;
    border-radius: ${h.shape.borderRadius()};
  `,pagination:u.css`
    display: flex;
    margin: 0;
    padding-top: ${h.spacing(1)};
    padding-bottom: ${h.spacing(.25)};
    justify-content: center;
    border-left: 1px solid ${h.colors.border.strong};
    border-right: 1px solid ${h.colors.border.strong};
    border-bottom: 1px solid ${h.colors.border.strong};
  `});function ht(h,U){const{hasRuler:W,rulerRulesLoaded:Y}=(0,w.h)();return(0,e.useMemo)(()=>{const re=[{id:"state",label:"State",renderCell:({data:S})=>{const{namespace:k}=S,{rulesSource:T}=k,{promRule:Q,rulerRule:H}=S,ce=!!(W(T)&&Y(T)&&Q&&!H),X=!!(W(T)&&Y(T)&&H&&!Q),ie=(0,b.Pc)(H)&&Boolean(H.grafana_alert.is_paused);return e.createElement(pt.p,{rule:S,isDeleting:ce,isCreating:X,isPaused:ie})},size:"165px"},{id:"name",label:"Name",renderCell:({data:S})=>S.name,size:5},{id:"provisioned",label:"",renderCell:({data:S})=>{const k=S.rulerRule;return(0,b.Pc)(k)&&k.grafana_alert.provenance?e.createElement($.C0,null):null},size:"100px"},{id:"warnings",label:"",renderCell:({data:S})=>e.createElement(L,{rule:S}),size:"45px"},{id:"health",label:"Health",renderCell:({data:{promRule:S,group:k}})=>S?e.createElement(mt.V,{rule:S}):null,size:"75px"}];return h&&re.push({id:"summary",label:"Summary",renderCell:({data:S})=>e.createElement(A.Z,{input:S.annotations[E.q6.summary]??""}),size:5}),U&&re.push({id:"group",label:"Group",renderCell:({data:S})=>{const{namespace:k,group:T}=S;return T.name==="default"?e.createElement(C.V,{namespace:k.name}):e.createElement(C.V,{namespace:k.name,group:T.name})},size:5}),re.push({id:"actions",label:"Actions",renderCell:({data:S})=>e.createElement(Te,{rule:S,rulesSource:S.namespace.rulesSource}),size:"200px"}),re},[h,U,W,Y])}},8055:(me,F,o)=>{o.d(F,{h:()=>x});var u=o(68404),e=o(45849),D=o(69945);function x(){const w=(0,D._)(P=>P.rulerRules),E=(0,u.useCallback)(P=>{const f=typeof P=="string"?P:P.name;return f===e.GC||!!w[f]?.result},[w]),b=(0,u.useCallback)(P=>{const f=(0,e.EG)(P),$=w[f]?.result;return Boolean($)},[w]);return{hasRuler:E,rulerRulesLoaded:b}}},53051:(me,F,o)=>{o.r(F),o.d(F,{DashboardPage:()=>At,UnthemedDashboardPage:()=>$t,default:()=>Fs,mapStateToProps:()=>Pn});var u=o(52423),e=o(68404),D=o(36635),x=o(24844),w=o(83383),E=o(68183),b=o(37932),P=o(35645),f=o(72648),$=o(659),C=o(79396),A=o(34177),q=o(60499),_=o(96694),G=o(86245),O=o(30992),j=o(60265),B=o(81168),K=o(45984),Ce=o(85803),He=o(92624),Me=o(39514),pe=o(31460),le=o(77839),ne=o(82897),ge=o(70356),Ge=o(5191),st=o(97063),Se=o(82002),Te=o(22350),ot=o(70197),be=o(35029),De=o(46967),ae=o(39904),L=o(31403),it=o(86648),lt=o(74391),Ie=o(2313);const Ke=({panel:n,folderUid:t,isUnsavedPrompt:a,onDismiss:r,onConfirm:s,onDiscard:i})=>{const[l,c]=(0,e.useState)(""),d=(0,Te.Z)(async()=>{const I=await(0,it.E8)(n.libraryPanel.uid);return I.length>0?I.map(J=>J.title):[]},[n.libraryPanel.uid]),[p,m]=(0,e.useState)([]);(0,ot.Z)(()=>d.value?m(d.value.filter(I=>I.toLowerCase().includes(l.toLowerCase()))):m([]),300,[d.value,l]);const{saveLibraryPanel:g}=(0,Ie.E)(),y=(0,f.wW)(lt.J),v=(0,e.useCallback)(()=>{i()},[i]),R=a?"Unsaved library panel changes":"Save library panel";return e.createElement(be.u,{title:R,icon:"save",onDismiss:r,isOpen:!0},e.createElement("div",null,e.createElement("p",{className:y.textInfo},"This update will affect ",e.createElement("strong",null,n.libraryPanel.meta?.connectedDashboards," ",n.libraryPanel.meta?.connectedDashboards===1?"dashboard":"dashboards","."),"The following dashboards using the panel will be affected:"),e.createElement(De.I,{className:y.dashboardSearch,prefix:e.createElement(ae.J,{name:"search"}),placeholder:"Search affected dashboards",value:l,onChange:I=>c(I.currentTarget.value)}),d.loading?e.createElement("p",null,"Loading connected dashboards..."):e.createElement("table",{className:y.myTable},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,"Dashboard name"))),e.createElement("tbody",null,p.map((I,J)=>e.createElement("tr",{key:`dashrow-${J}`},e.createElement("td",null,I))))),e.createElement(be.u.ButtonRow,null,e.createElement(L.zx,{variant:"secondary",onClick:r,fill:"outline"},"Cancel"),a&&e.createElement(L.zx,{variant:"destructive",onClick:v},"Discard"),e.createElement(L.zx,{onClick:()=>{g(n,t).then(()=>{s()})}},"Update all"))))};var ct=o(82302),Ne=o(58379),xe=o(32294),ke=o(46732),oe=o(36281);function dt(n,t){return async a=>{const r=t.initEditPanel(n);a((0,oe.Hl)({panel:r,sourcePanel:n}))}}function Ze(){return async(n,t)=>{const{getPanel:a}=t().panelEditor;a().configRev=0,n((0,oe.yi)(!0))}}function ut(n,t){return a=>{if(n.libraryPanel?.uid===void 0||!t)return;const r=n.getSaveModel();for(const s of t.panels){if(mt(n,s))continue;s.restoreModel({...r,...(0,ne.pick)(s,"gridPos","id")});const i=s.plugin?.meta.id!==n.plugin?.meta.id;s.plugin=n.plugin,s.configRev++,i&&(s.generateNewKey(),a((0,ke.bc)({key:s.key,plugin:s.plugin}))),setTimeout(()=>{s.getQueryRunner().useLastResultFrom(n.getQueryRunner())},20)}n.repeat&&setTimeout(()=>t.processRepeats(),20)}}function mt(n,t){return!!(t.libraryPanel?.uid!==n.libraryPanel.uid||t.id&&t.id===n.id||t.repeatPanelId)}function pt(){return async(n,t)=>{const a=t().dashboard.getModel(),{getPanel:r,getSourcePanel:s,shouldDiscardChanges:i}=t().panelEditor,l=r();if(a&&a.exitPanelEditor(),gt(l)&&!i){const c=l.getSaveModel(),d=s(),p=d.type!==l.type;n(ut(l,a)),d.restoreModel(c),d.configRev++,p&&(d.plugin=l.plugin,d.generateNewKey(),await n((0,ke.bc)({key:d.key,plugin:l.plugin}))),setTimeout(()=>{d.getQueryRunner().useLastResultFrom(l.getQueryRunner()),d.render(),l.hasSavedPanelEditChange&&!l.hasChanged&&(d.configRev=0)},20)}n((0,xe.qj)(l.key)),n((0,oe.my)())}}function gt(n){return n.hasChanged||n.hasSavedPanelEditChange||n.isAngularPlugin()}function we(n){return(t,a)=>{const r={...a().panelEditor.ui,...n};t((0,oe.K9)(r));try{Ne.Z.setObject(oe.jy,r)}catch(s){console.error(s)}}}var ht=o(84135);const h=({dashboard:n,onSaveSuccess:t,onDiscard:a,onDismiss:r})=>e.createElement(be.u,{isOpen:!0,title:"Unsaved changes",onDismiss:r,icon:"exclamation-triangle",className:u.css`
        width: 500px;
      `},e.createElement("h5",null,"Do you want to save your changes?"),e.createElement(be.u.ButtonRow,null,e.createElement(L.zx,{variant:"secondary",onClick:r,fill:"outline"},"Cancel"),e.createElement(L.zx,{variant:"destructive",onClick:a},"Discard"),e.createElement(ht.i,{dashboard:n,onSaveSuccess:t}))),U=e.memo(({dashboard:n})=>{const[t,a]=(0,e.useState)({original:null}),r=(0,B.useDispatch)(),{original:s,originalPath:i}=t,{showModal:l,hideModal:c}=(0,e.useContext)(Ge.kr);(0,e.useEffect)(()=>{const p=setTimeout(()=>{const g=b.E1.getLocation().pathname,y=n.getSaveModelClone();a({originalPath:g,original:y})},1e3),m=st.h.subscribe(K.Jd,()=>{const g=n.getSaveModelClone();a({originalPath:i,original:g})});return()=>{clearTimeout(p),m.unsubscribe()}},[n,i]),(0,e.useEffect)(()=>{const p=m=>{Y(n,s)||S(n,s)&&(m.preventDefault(),m.returnValue="")};return window.addEventListener("beforeunload",p),()=>window.removeEventListener("beforeunload",p)},[n,s]);const d=p=>{const m=n.panelInEdit,g=new URLSearchParams(p.search);return m&&m.libraryPanel&&m.hasChanged&&!g.has("editPanel")?(l(Ke,{isUnsavedPrompt:!0,panel:n.panelInEdit,folderUid:n.meta.folderUid??"",onConfirm:()=>{c(),W(p)},onDiscard:()=>{r(Ze()),W(p),c()},onDismiss:c}),!1):i===p.pathname||!s?(m&&!g.has("editPanel")&&r(pt()),!0):Y(n,s)||!S(n,s)?!0:(l(h,{dashboard:n,onSaveSuccess:()=>{c(),W(p)},onDiscard:()=>{a({...t,original:null}),c(),W(p)},onDismiss:c}),!1)};return e.createElement(ge.NL,{when:!0,message:d})});U.displayName="DashboardPrompt";function W(n){n&&setTimeout(()=>b.E1.push(n),10)}function Y(n,t){if(!t||!Se.Vt.isSignedIn||!n)return!0;const{canSave:a,fromScript:r,fromFile:s}=n.meta;return!Se.Vt.isEditor&&!a?!0:!a||r||s}function re(n){const t=new ct.f(n);t.expandRows();const a=t.getSaveModelClone();return a.time=0,a.refresh="",a.schemaVersion=0,a.timezone=0,a.panels=[],(0,ne.each)(a.getVariables(),r=>{r.current=null,r.options=null,r.filters=null}),a}function S(n,t){if(n.hasUnsavedChanges())return!0;const a=re(n.getSaveModelClone()),r=re(t),s=(0,ne.find)(a.nav,{type:"timepicker"}),i=(0,ne.find)(r.nav,{type:"timepicker"});s&&i&&(s.now=i.now);const l=JSON.stringify(a,null),c=JSON.stringify(r,null);return l!==c}var k=o(36182),T=o(39653),Q=o(73952),H=o(89050),ce=o(40400),X=o(26418),he=o(30979),ie=o(26338),Re=o(72142),ye=o(79841),ft=o(67487),de=o(45253),fe=o(24799),je=o(53217),$e=o(94599),vt=o(9405),z=o(52081),ee=o(8944),Ae=o(3574),Et=o.n(Ae),Sn=o(38849),Qe=o(20112),Tn=o(38535),Le=o(19349),Je=o(87464),Lt=o(78197),Ue=(n=>(n[n.Support=0]="Support",n[n.Data=1]="Data",n))(Ue||{}),Ye=(n=>(n[n.PanelSnapshot=0]="PanelSnapshot",n[n.GithubComment=1]="GithubComment",n))(Ye||{});class Dn extends Tn.b{constructor(t){super({panel:t,panelTitle:t.replaceVariables(t.title,void 0,"text")||"Panel",currentTab:0,showMessage:1,snapshotText:"",markdownText:"",randomize:{},snapshotUpdate:0,options:[{label:"GitHub comment",description:"Copy and paste this message into a GitHub issue or comment",value:1},{label:"Panel support snapshot",description:"Dashboard JSON used to help troubleshoot visualization issues",value:0}]}),this.onCurrentTabChange=a=>{this.setState({currentTab:a})},this.onShowMessageChange=a=>{this.setState({showMessage:a.value})},this.onGetMarkdownForClipboard=()=>{const{markdownText:a}=this.state,r=Math.pow(1024,2)*1.5;return a.length>r?(this.setState({error:{title:"Copy to clipboard failed",message:"Snapshot is too large, consider download and attaching a file instead"}}),""):a},this.onDownloadDashboard=()=>{const{snapshotText:a,panelTitle:r}=this.state,s=new Blob([a],{type:"text/plain"}),i=`debug-${r}-${(0,Sn.dq)(new Date)}.json.txt`;Et()(s,i)},this.onSetSnapshotText=a=>{this.setState({snapshotText:a})},this.onToggleRandomize=a=>{const{randomize:r}=this.state;this.setState({randomize:{...r,[a]:!r[a]}})},this.onPreviewDashboard=()=>{const{snapshot:a}=this.state;a&&((0,Je.$M)({meta:{},dashboard:a}),o.g.open(P.v.appUrl+"dashboard/new","_blank"))}}async buildDebugDashboard(){const{panel:t,randomize:a,snapshotUpdate:r,iframeLoading:s,currentTab:i}=this.state,l=await(0,Lt.$R)(t,a,(0,Le.$t)().timeRange()),c=JSON.stringify(l,null,2),d=(0,Lt.S$)(t,c),p=(0,Qe.zc)((0,Qe.Cf)("bytes")(c?.length??0));s&&i===0&&(0,Je.$M)({meta:{},dashboard:l}),this.setState({snapshot:l,snapshotText:c,markdownText:d,snapshotSize:p,snapshotUpdate:r+1})}subscribeToIframeLoadingMessage(){const t=a=>{a.data==="GrafanaAppInit"&&((0,Je.$M)({meta:{},dashboard:this.state.snapshot}),this.setState({iframeLoading:!0}))};return window.addEventListener("message",t,!1),function(){window.removeEventListener("message",t)}}}function xn({panel:n,plugin:t,onClose:a}){const r=(0,f.wW)(Rn),s=(0,e.useMemo)(()=>new Dn(n),[n]),{currentTab:i,loading:l,error:c,iframeLoading:d,options:p,showMessage:m,snapshotSize:g,markdownText:y,snapshotText:v,randomize:R,panelTitle:I,snapshotUpdate:J}=s.useState();if((0,e.useEffect)(()=>{s.buildDebugDashboard()},[s,t,R]),(0,e.useEffect)(()=>s.subscribeToIframeLoadingMessage(),[s]),!t)return null;const M=[{label:"Snapshot",value:Ue.Support},{label:"Data",value:Ue.Data}];return e.createElement(he.d,{title:"Get help with this panel",width:"90%",onClose:a,expandable:!0,scrollableContent:!0,subtitle:e.createElement(X.Stack,{direction:"column",gap:1},e.createElement(X.Stack,{direction:"row",gap:1},e.createElement(ie.a,{featureState:ce.CQ.beta}),e.createElement("a",{href:"https://grafana.com/docs/grafana/latest/troubleshooting/",target:"blank",className:"external-link",rel:"noopener noreferrer"},"Troubleshooting docs ",e.createElement(ae.J,{name:"external-link-alt"}))),e.createElement("span",{className:"muted"},"To request troubleshooting help, send a snapshot of this panel to Grafana Labs Technical Support. The snapshot contains query response data and panel settings.")),tabs:e.createElement(Re.J,null,M.map((N,te)=>e.createElement(ye.O,{key:`${N.value}-${te}`,label:N.label,active:N.value===i,onChangeTab:()=>s.onCurrentTabChange(N.value)})))},l&&e.createElement(ft.$,null),c&&e.createElement(de.b,{title:c.title},c.message),i===Ue.Data&&e.createElement("div",{className:r.code},e.createElement("div",{className:r.opts},e.createElement(fe.g,{label:"Template",className:r.field},e.createElement(je.Ph,{options:p,value:m,onChange:s.onShowMessageChange})),m===Ye.GithubComment?e.createElement($e.m,{icon:"copy",getText:s.onGetMarkdownForClipboard},"Copy to clipboard"):e.createElement(L.zx,{icon:"download-alt",onClick:s.onDownloadDashboard},"Download (",g,")")),e.createElement(H.Z,{disableWidth:!0},({height:N})=>e.createElement(vt.p,{width:"100%",height:N,language:m===Ye.GithubComment?"markdown":"json",showLineNumbers:!0,showMiniMap:!0,value:m===Ye.GithubComment?y:v,readOnly:!1,onBlur:s.onSetSnapshotText}))),i===Ue.Support&&e.createElement(e.Fragment,null,e.createElement(fe.g,{label:"Randomize data",description:"Modify the original data to hide sensitve information.  Note the lengths will stay the same, and duplicate values will be equal."},e.createElement(z.Lh,null,e.createElement(ee.x,{label:"Labels",id:"randomize-labels",showLabel:!0,value:Boolean(R.labels),onChange:()=>s.onToggleRandomize("labels")}),e.createElement(ee.x,{label:"Field names",id:"randomize-field-names",showLabel:!0,value:Boolean(R.names),onChange:()=>s.onToggleRandomize("names")}),e.createElement(ee.x,{label:"String values",id:"randomize-string-values",showLabel:!0,value:Boolean(R.values),onChange:()=>s.onToggleRandomize("values")}))),e.createElement(fe.g,{label:"Support snapshot",description:`Panel: ${I}`},e.createElement(X.Stack,null,e.createElement(L.zx,{icon:"download-alt",onClick:s.onDownloadDashboard},"Dashboard (",g,")"),e.createElement($e.m,{icon:"github",getText:s.onGetMarkdownForClipboard,title:"Copy a complete GitHub comment to the clipboard"},"Copy to clipboard"),e.createElement(L.zx,{onClick:s.onPreviewDashboard,variant:"secondary",title:"Open support snapshot dashboard in a new tab"},"Preview"))),e.createElement(H.Z,{disableWidth:!0},({height:N})=>e.createElement(e.Fragment,null,e.createElement("iframe",{title:"Support snapshot preview",src:`${P.v.appUrl}dashboard/new?orgId=${Se.Vt.user.orgId}&kiosk&${J}`,width:"100%",height:N-100,frameBorder:"0",style:{display:d?"block":"none",marginTop:16}}),!d&&e.createElement("div",null,"\xA0")))))}const Rn=n=>({code:u.css`
    flex-grow: 1;
    height: 100%;
    overflow: scroll;
  `,field:u.css`
    width: 100%;
  `,opts:u.css`
    display: flex;
    display: flex;
    width: 100%;
    flex-grow: 0;
    align-items: center;
    justify-content: flex-end;

    button {
      margin-left: 8px;
    }
  `});var On=o(49922);const bt=(n,t,a)=>{const r=(0,e.useRef)(),[s,i]=(0,e.useState)();return(0,e.useEffect)(()=>{let l=-1,c=0;return r.current=n.getQueryRunner().getData(t).subscribe({next:d=>{if(a){if(l===d.structureRev){const p=Date.now();if(p-c<1e4)return;c=p}l=d.structureRev??-1}i(d)}}),()=>{r.current&&r.current.unsubscribe()}},[n,t.withFieldConfig,t.withTransforms]),{data:s,error:s&&s.error,isLoading:s?s.state===On.Gu.Loading:!0,hasSeries:s?!!s.series:!1}};var Mn=o(40885),ue=o(35287),In=o(21957),Nn=o(46835),wn=o(18893);const $n=({data:n,metadataDatasource:t})=>!t||!t.components?.MetadataInspector?e.createElement(ue.cC,{i18nKey:"dashboard.inspect-meta.no-inspector"},"No Metadata Inspector"):e.createElement(t.components.MetadataInspector,{datasource:t,data:n.series});var An=o(82090),Ln=o(72062);const Un=({panel:n,plugin:t,dashboard:a,tabs:r,data:s,isDataLoading:i,dataOptions:l,metadataDatasource:c,defaultTab:d,onDataOptionsChange:p,onClose:m})=>{const[g,y]=(0,e.useState)(d??T.q.Data);if(!t)return null;const v=s?.error;let R=g;r.find(M=>M.value===g)||(R=T.q.JSON);const I=(0,Mn.J)().replace(n.title,n.scopedVars,"text")||"Panel",J=(0,ue.t)("dashboard.inspect.title","Inspect: {{panelTitle}}",{panelTitle:I});return e.createElement(he.d,{title:J,subtitle:s&&zn(s),width:"50%",onClose:m,expandable:!0,scrollableContent:!0,tabs:e.createElement(Re.J,null,r.map((M,N)=>e.createElement(ye.O,{key:`${M.value}-${N}`,label:M.label,active:M.value===R,onChangeTab:()=>y(M.value||T.q.Data)})))},R===T.q.Data&&e.createElement(In.E,{panel:n,data:s&&s.series,isLoading:i,options:l,onOptionsChange:p,timeZone:a.timezone,app:ce.zj.Dashboard}),s&&R===T.q.Meta&&e.createElement($n,{data:s,metadataDatasource:c}),R===T.q.JSON&&e.createElement(wn.W,{panel:n,dashboard:a,data:s,onClose:m}),R===T.q.Error&&e.createElement(Nn.l,{error:v}),s&&R===T.q.Stats&&e.createElement(An.f,{data:s,timeZone:a.getTimezone()}),s&&R===T.q.Query&&e.createElement(Ln.D,{panel:n,data:s.series,onRefreshQuery:()=>n.refresh()}))};function zn(n){const{request:t}=n;if(!t)return"";const a=t.targets.length,r=t.endTime?t.endTime-t.startTime:0,s=(0,Qe.zc)((0,Qe.Cf)("ms")(r));return e.createElement(ue.cC,{i18nKey:"dashboard.inspect.subtitle"},{queryCount:a}," queries with total query time of ",{formatted:s})}var Fn=o(50700),Ut=o(86647),yt=o(13505);const Bn=n=>(0,Fn.Z)(async()=>{const a=n?.request?.targets||[];if(n&&n.series&&a.length){for(const r of n.series)if(r.meta&&r.meta.custom){const s=await(0,Ut.F)().get(a[0].datasource);if(s&&s.components?.MetadataInspector)return s}}},[n]).value,Wn=(n,t,a,r,s)=>(0,e.useMemo)(()=>{const i=[];(0,yt.sY)(a)&&(i.push({label:(0,ue.t)("dashboard.inspect.data-tab","Data"),value:T.q.Data}),i.push({label:(0,ue.t)("dashboard.inspect.stats-tab","Stats"),value:T.q.Stats})),s&&i.push({label:(0,ue.t)("dashboard.inspect.meta-tab","Meta Data"),value:T.q.Meta}),i.push({label:(0,ue.t)("dashboard.inspect.json-tab","JSON"),value:T.q.JSON}),r&&r.message&&i.push({label:(0,ue.t)("dashboard.inspect.error-tab","Error"),value:T.q.Error});const l=window.grafanaPanelInspectActionSupplier;return l&&l.getActions(n)?.length&&i.push({label:(0,ue.t)("dashboard.inspect.actions-tab","Actions"),value:T.q.Actions}),t.meta.canEdit&&(0,yt.sY)(a)&&i.push({label:(0,ue.t)("dashboard.inspect.query-tab","Query"),value:T.q.Query}),i},[n,a,s,t,r]),Vn=({panel:n,dashboard:t,plugin:a})=>{const[r,s]=(0,e.useState)({withTransforms:!1,withFieldConfig:!0}),i=(0,ge.TH)(),{data:l,isLoading:c,error:d}=bt(n,r,!0),p=Bn(l),m=Wn(n,t,a,d,p),g=new URLSearchParams(i.search).get("inspectTab"),y=()=>{b.E1.partial({inspect:null,inspectTab:null})};return a?g===T.q.Help?e.createElement(xn,{panel:n,plugin:a,onClose:y}):e.createElement(Un,{dashboard:t,panel:n,plugin:a,defaultTab:g,tabs:m,data:l,isDataLoading:c,dataOptions:r,onDataOptionsChange:s,metadataDatasource:p,onClose:y}):null},Hn=(n,t)=>{const a=(0,Q.i)(n,t.panel);return a?{plugin:a.plugin}:{plugin:null}},Gn=(0,D.connect)(Hn)(Vn);var zt=o(95484),Xe=o(2594),qe=o(64319),Kn=o(8125),kn=o(35224),Zn=o(7804),jn=o(95379),Ft=o(80177),Qn=o(77582),ze=o(61860),Jn=o(22323),Pt=o(10672);const Yn=n=>{const t=(0,e.useMemo)(()=>Jn.z.get(n.variable.type).picker,[n.variable]);return n.variable?e.createElement("div",{className:"gf-form"},e.createElement(Xn,{variable:n.variable}),n.variable.hide!==Pt.bU.hideVariable&&t&&e.createElement(t,{variable:n.variable,readOnly:n.readOnly??!1})):e.createElement("div",null,"Couldn't load variable")};function Xn({variable:n}){const t=(0,e.useMemo)(()=>n.label||n.name,[n]);if(n.hide!==Pt.bU.dontHide)return null;const a=`var-${n.id}`;return n.description?e.createElement(ze.u,{content:n.description,placement:"bottom"},e.createElement("label",{className:"gf-form-label gf-form-label--variable","data-testid":E.wl.pages.Dashboard.SubMenu.submenuItemLabels(t),htmlFor:a},t)):e.createElement("label",{className:"gf-form-label gf-form-label--variable","data-testid":E.wl.pages.Dashboard.SubMenu.submenuItemLabels(t),htmlFor:a},t)}const Bt=({variables:n,readOnly:t})=>{const[a,r]=(0,e.useState)([]);return(0,e.useEffect)(()=>{r(n.filter(s=>s.hide!==Pt.bU.hideVariable))},[n]),a.length===0?null:e.createElement(e.Fragment,null,a.map(s=>e.createElement("div",{key:s.id,className:"submenu-item gf-form-inline","data-testid":E.wl.pages.Dashboard.SubMenu.submenuItem},e.createElement(Yn,{variable:s,readOnly:t}))))};var qn=o(54294),_n=o(81283),Fe=o(6297),Ct=o(87095),ea=o(61802),ta=o(37877),na=o(7196),Wt=o(14747),Be=o(68226),Vt=o(11484);function aa(n,t){Ne.Z.set(`panel-edit-section-${n}`,t?"true":"false")}function ra(n,t){return Ne.Z.getBool(`panel-edit-section-${n}`,t)}const Ht=(n,t)=>({angularPanelComponent:(0,Q.i)(n,t.panel)?.angularComponent}),Gt={changePanelPlugin:xe.Kc},Ws=(0,D.connect)(Ht,Gt);class sa extends e.PureComponent{constructor(t){super(t)}componentDidMount(){this.loadAngularOptions()}componentDidUpdate(t){(this.props.plugin!==t.plugin||this.props.angularPanelComponent!==t.angularPanelComponent)&&this.cleanUpAngularOptions(),this.loadAngularOptions()}componentWillUnmount(){this.cleanUpAngularOptions()}cleanUpAngularOptions(){this.angularOptions&&(this.angularOptions.destroy(),this.angularOptions=null)}loadAngularOptions(){const{panel:t,angularPanelComponent:a,changePanelPlugin:r}=this.props;if(!this.element||!a||this.angularOptions)return;const s=a.getScope();if(!s.$$childHead){setTimeout(()=>{this.forceUpdate()});return}const i=s.$$childHead.ctrl;i.initEditMode(),i.onPluginTypeChange=p=>{r({panel:t,pluginId:p.id})};let l="";for(let p=0;p<i.editorTabs.length;p++){const m=i.editorTabs[p];m.isOpen=ra(m.title,p===0),l+=`
      <div class="panel-options-group" ng-cloak>
        <div class="panel-options-group__header" ng-click="toggleOptionGroup(${p})" aria-label="${m.title} section">
          <div class="panel-options-group__icon">
            <icon name="ctrl.editorTabs[${p}].isOpen ? 'angle-down' : 'angle-right'"></icon>
          </div>
          <div class="panel-options-group__title">${m.title}</div>
        </div>
        <div class="panel-options-group__body" ng-if="ctrl.editorTabs[${p}].isOpen">
          <panel-editor-tab editor-tab="ctrl.editorTabs[${p}]" ctrl="ctrl"></panel-editor-tab>
        </div>
      </div>
      `}const c=(0,Vt.w)(),d={ctrl:i,toggleOptionGroup:p=>{const m=i.editorTabs[p];m.isOpen=!m.isOpen,aa(m.title,Boolean(m.isOpen))}};this.angularOptions=c.load(this.element,d,l),this.angularOptions.digest()}render(){return e.createElement("div",{ref:t=>this.element=t})}}const oa=(0,D.connect)(Ht,Gt)(sa);var St=o(91183),_e=o(68061),Kt=o(43714),kt=o(15670),et=o(64703),ia=o(14677),la=o.n(ia),ca=o(64353),da=o(51275),tt=o(8180);const ua=({property:n,context:t,registry:a,onChange:r,onRemove:s,isSystemOverride:i,searchQuery:l})=>{const c=(0,f.wW)(ma),d=a?.getIfExists(n.id);if(!d)return null;const p=Array.isArray(n.value)||n.id===_e.qb.Thresholds||n.id===_e.qb.Links||n.id===_e.qb.Mappings,m=d.category?.filter(v=>v!==d.name);let g;const y=(v=!0,R=!1)=>(I=!1)=>e.createElement(z.Lh,{justify:"space-between"},e.createElement(ca._,{category:m,description:v?d.description:void 0},e.createElement(la(),{textToHighlight:d.name,searchWords:[l],highlightClassName:"search-fragment-highlight"}),!I&&R&&d.getItemsCount&&e.createElement(da.A,{value:d.getItemsCount(n.value)})),!i&&e.createElement("div",null,e.createElement(tt.h,{name:"times",onClick:s})));return p?g=e.createElement(St.u,{id:d.name,renderTitle:y(!1,!0),className:u.css`
          padding-left: 0;
          padding-right: 0;
        `,isNested:!0,isOpenDefault:n.value!==void 0},e.createElement(d.override,{value:n.value,onChange:v=>{r(v)},item:d,context:t})):g=e.createElement("div",null,e.createElement(fe.g,{label:y()(),description:d.description},e.createElement(d.override,{value:n.value,onChange:v=>{r(v)},item:d,context:t}))),e.createElement("div",{className:(0,u.cx)(p&&c.collapsibleOverrideEditor,!p&&"dynamicConfigValueEditor--nonCollapsible")},g)},ma=n=>({collapsibleOverrideEditor:u.css`
      label: collapsibleOverrideEditor;
      & + .dynamicConfigValueEditor--nonCollapsible {
        margin-top: ${n.spacing(1)};
      }
    `});var Pe=o(91752),se=o(66352);const Zt=({isExpanded:n,registry:t,matcherUi:a,overrideName:r,override:s,onOverrideRemove:i})=>{const l=(0,f.wW)(pa),d=s.properties.map(m=>t.getIfExists(m.id)).filter(m=>!!m).map(m=>m?.name).join(", "),p=a.optionsToLabel(s.matcher.options);return e.createElement("div",null,e.createElement(z.Lh,{justify:"space-between"},e.createElement("div",null,r),e.createElement(tt.h,{name:"trash-alt",onClick:i,title:"Remove override"})),!n&&e.createElement("div",{className:l.overrideDetails},e.createElement("div",{className:l.options,title:p},p," ",e.createElement(ae.J,{name:"angle-right"})," ",d)))};Zt.displayName="OverrideTitle";const pa=n=>({matcherUi:u.css`
      padding: ${n.spacing(1)};
    `,propertyPickerWrapper:u.css`
      margin-top: ${n.spacing(2)};
    `,overrideDetails:u.css`
      font-size: ${n.typography.bodySmall.fontSize};
      color: ${n.colors.text.secondary};
      font-weight: ${n.typography.fontWeightRegular};
    `,options:u.css`
      overflow: hidden;
      padding-right: ${n.spacing(4)};
    `,unknownLabel:u.css`
      margin-bottom: 0;
    `});function ga(n,t){const a=[],r=n.panel.fieldConfig,s=n.plugin.fieldConfigRegistry,i=n.data?.series??[];if(s.isEmpty())return[];const l=(m,g)=>{let y=(0,ne.cloneDeep)(r.overrides);y[m]=g,n.onFieldConfigsChange({...r,overrides:y})},c=m=>{let g=(0,ne.cloneDeep)(r.overrides);g.splice(m,1),n.onFieldConfigsChange({...r,overrides:g})},d=m=>{n.onFieldConfigsChange({...r,overrides:[...r.overrides,{matcher:{id:m.value},properties:[]}]})},p={data:i,getSuggestions:m=>(0,et.PW)(i,m),isOverride:!0};for(let m=0;m<r.overrides.length;m++){const g=r.overrides[m],y=`Override ${m+1}`,v=Kt.i.get(g.matcher.id),R=ha(s),I=(0,_e.v3)(g),J=g.properties.length===0?1:0,M=new Pe.j({title:y,id:y,forceOpen:J,renderTitle:function(Ee){return e.createElement(Zt,{override:g,isExpanded:Ee,registry:s,overrideName:y,matcherUi:v,onOverrideRemove:()=>c(m)})}}),N=Z=>{g.matcher.options=Z,l(m,g)},te=(Z,Ee)=>{const Ve=s.get(Ee.value),rt={id:Ve.id,value:Ve.defaultValue};g.properties?Z.properties.push(rt):Z.properties=[rt],l(m,Z)};M.addItem(new se.a({title:v.name,render:function(){return e.createElement(v.component,{id:`${v.matcher.id}-${m}`,matcher:v.matcher,data:n.data?.series??[],options:g.matcher.options,onChange:N})}}));for(let Z=0;Z<g.properties.length;Z++){const Ee=g.properties[Z],Ve=s.getIfExists(Ee.id);if(!Ve)continue;const rt=Cn=>{g.properties[Z].value=Cn,l(m,g)},Bs=()=>{g.properties.splice(Z,1),l(m,g)};M.addItem(new se.a({title:Ve.name,skipField:!0,render:function(){return e.createElement(ua,{key:`${Ee.id}/${Z}`,isSystemOverride:I,onChange:rt,onRemove:Bs,property:Ee,registry:s,context:p,searchQuery:t})}}))}!I&&g.matcher.options&&M.addItem(new se.a({title:"----------",skipField:!0,render:function(){return e.createElement(kt.b,{key:"Add override property",label:"Add override property",variant:"secondary",isFullWidth:!0,icon:"plus",menuPlacement:"auto",options:R,onChange:Ee=>te(g,Ee)})}})),a.push(M)}return a.push(new Pe.j({title:"add button",id:"add button",customRender:function(){return e.createElement(fa,{key:"Add override"},e.createElement(kt.b,{icon:"plus",label:"Add field override",variant:"secondary",menuPlacement:"auto",isFullWidth:!0,size:"md",options:Kt.i.list().filter(g=>!g.excludeFromPicker).map(g=>({label:g.name,value:g.id,description:g.description})),onChange:g=>d(g)}))}})),a}function ha(n){return n.list().filter(t=>!t.hideFromOverrides).map(t=>{let a=t.name;return t.category&&(a=[...t.category,t.name].join(" > ")),{label:a,value:t.id,description:t.description}})}function fa({children:n}){const t=(0,f.wW)(va);return e.createElement("div",{className:t},n)}function va(n){return(0,u.css)({borderTop:`1px solid ${n.colors.border.weak}`,padding:`${n.spacing(2)}`,display:"flex"})}const Ea=({panel:n,formatDate:t})=>{const a=(0,f.wW)(ba),r=n.libraryPanel?.meta;return r?e.createElement("div",{className:a.info},e.createElement("div",{className:a.libraryPanelInfo},`Used on ${r.connectedDashboards} `,r.connectedDashboards===1?"dashboard":"dashboards"),e.createElement("div",{className:a.libraryPanelInfo},"Last edited on ",t?.(r.updated,"L")??r.updated," by",r.updatedBy.avatarUrl&&e.createElement("img",{width:"22",height:"22",className:a.userAvatar,src:r.updatedBy.avatarUrl,alt:`Avatar for ${r.updatedBy.name}`}),r.updatedBy.name)):null},ba=n=>({info:u.css`
      line-height: 1;
    `,libraryPanelInfo:u.css`
      color: ${n.colors.text.secondary};
      font-size: ${n.typography.bodySmall.fontSize};
    `,userAvatar:u.css`
      border-radius: 50%;
      box-sizing: content-box;
      width: 22px;
      height: 22px;
      padding-left: ${n.spacing(1)};
      padding-right: ${n.spacing(1)};
    `});function ya(n){const{panel:t,onPanelConfigChange:a,dashboard:r}=n,s=new Pe.j({title:"Library panel options",id:"Library panel options",isOpenDefault:!0});return(0,Fe.V)(t)&&s.addItem(new se.a({title:"Name",value:t.libraryPanel.name,popularRank:1,render:function(){return e.createElement(De.I,{id:"LibraryPanelFrameName",defaultValue:t.libraryPanel.name,onBlur:l=>a("libraryPanel",{...t.libraryPanel,name:l.currentTarget.value})})}})).addItem(new se.a({title:"Information",render:function(){return e.createElement(Ea,{panel:t,formatDate:r.formatDate})}})),s}var Pa=o(97379),Ca=o(68037),Sa=o(21599);function Ta(n){const{panel:t,onPanelConfigChange:a}=n;return new Pe.j({title:"Panel options",id:"Panel options",isOpenDefault:!0}).addItem(new se.a({title:"Title",value:t.title,popularRank:1,render:function(){return e.createElement(De.I,{id:"PanelFrameTitle",defaultValue:t.title,onBlur:i=>a("title",i.currentTarget.value)})}})).addItem(new se.a({title:"Description",description:t.description,value:t.description,render:function(){return e.createElement(Pa.K,{id:"description-text-area",defaultValue:t.description,onBlur:i=>a("description",i.currentTarget.value)})}})).addItem(new se.a({title:"Transparent background",render:function(){return e.createElement(ee.r,{value:t.transparent,id:"transparent-background",onChange:i=>a("transparent",i.currentTarget.checked)})}})).addCategory(new Pe.j({title:"Panel links",id:"Panel links",isOpenDefault:!1,itemsCount:t.links?.length}).addItem(new se.a({title:"Panel links",render:function(){return e.createElement(Ca.d,{links:t.links,onChange:i=>a("links",i),getSuggestions:et.PR,data:[]})}}))).addCategory(new Pe.j({title:"Repeat options",id:"Repeat options",isOpenDefault:!1}).addItem(new se.a({title:"Repeat by variable",description:"Repeat this panel for each value in the selected variable. This is not visible while in edit mode. You need to go back to dashboard and then update the variable or reload the dashboard.",render:function(){return e.createElement(Sa.X,{id:"repeat-by-variable-select",repeat:t.repeat,onChange:i=>{a("repeat",i)}})}})).addItem(new se.a({title:"Repeat direction",showIf:()=>!!t.repeat,render:function(){const i=[{label:"Horizontal",value:"h"},{label:"Vertical",value:"v"}];return e.createElement(Xe.S,{options:i,value:t.repeatDirection||"h",onChange:l=>a("repeatDirection",l)})}})).addItem(new se.a({title:"Max per row",showIf:()=>Boolean(t.repeat&&t.repeatDirection==="h"),render:function(){const i=[2,3,4,6,8,12].map(l=>({label:l.toString(),value:l}));return e.createElement(je.Ph,{options:i,value:t.maxPerRow,onChange:l=>a("maxPerRow",l.value)})}})))}var Da=o(57054);class xa{constructor(t,a){this.categories=t,this.overrides=a}search(t){const a=new RegExp(t,"i"),s=this.collectHits(this.categories,a,[]).sort(jt).map(c=>c.item),l=this.collectHits(this.overrides,a,[]).sort(jt).map(c=>c.item);return{optionHits:s,overrideHits:this.buildOverrideHitCategories(l),totalCount:this.getAllOptionsCount(this.categories)}}collectHits(t,a,r){for(const s of t){const i=a.test(s.props.title);for(const l of s.items){if(a.test(l.props.title)){r.push({item:l,rank:1});continue}if(l.props.description&&a.test(l.props.description)){r.push({item:l,rank:2});continue}i&&r.push({item:l,rank:3})}s.categories.length>0&&this.collectHits(s.categories,a,r)}return r}getAllOptionsCount(t){let a=0;for(const r of t)a+=r.items.length,r.categories.length>0&&(a+=this.getAllOptionsCount(r.categories));return a}buildOverrideHitCategories(t){const a={};for(const r of t){let s=a[r.parent.props.title];s||(s=a[r.parent.props.title]=new Pe.j(r.parent.props),s.addItem(r.parent.items[0])),s.items[0].props.title!==r.props.title&&s.addItem(r)}return Object.values(a)}}function jt(n,t){return n.rank-t.rank}function Ra(n){const t=[];for(const a of n)for(const r of a.items)r.props.title==="Unit"&&(r.props.popularRank=2),r.props.title==="Min"&&(r.props.popularRank=3),r.props.title==="Max"&&(r.props.popularRank=4),r.props.title==="Display name"&&(r.props.popularRank=5),r.props.popularRank&&t.push(r);return t.sort((a,r)=>a.props.popularRank-r.props.popularRank)}const Oa=n=>{const{plugin:t,dashboard:a,panel:r}=n,[s,i]=(0,e.useState)(""),[l,c]=(0,e.useState)(ve.All),d=(0,f.wW)(Na),[p,m,g]=(0,e.useMemo)(()=>[Ta(n),(0,Da.AL)(n),ya(n)],[r.configRev,n.data,n.instanceState,s]),y=(0,e.useMemo)(()=>ga(n,s),[r.configRev,n.data,n.instanceState,s]),v=[],R=s.length>0,I=(0,e.useMemo)(Ma,[]),J=(0,Fe.V)(r)?[g,p,...m]:[p,...m];if(R)v.push(Ia(J,y,s)),n.plugin.angularPanelCtrl&&v.push(e.createElement("div",{className:d.searchNotice,key:"Search notice"},"This is an old visualization type that does not support searching all options."));else switch(l){case ve.All:(0,Fe.V)(r)&&v.push(g.render()),v.push(p.render()),n.plugin.angularPanelCtrl&&v.push(e.createElement(oa,{plugin:t,dashboard:a,panel:r,key:"AngularOptions"}));for(const N of m)v.push(N.render());for(const N of y)v.push(N.render());break;case ve.Overrides:for(const N of y)v.push(N.render());break;case ve.Recent:v.push(e.createElement(St.u,{id:"Recent options",title:"Recent options",key:"Recent options",forceOpen:1},Ra(J).map(N=>N.render())));break}const M=!R&&!t.fieldConfigRegistry.isEmpty();return e.createElement("div",{className:d.wrapper},e.createElement("div",{className:d.formBox},e.createElement("div",{className:d.formRow},e.createElement(Wt.H,{width:0,value:s,onChange:i,placeholder:"Search options"})),M&&e.createElement("div",{className:d.formRow},e.createElement(Xe.S,{options:I,value:l,fullWidth:!0,onChange:c}))),e.createElement("div",{className:d.scrollWrapper},e.createElement(Be.$,{autoHeightMin:"100%"},e.createElement("div",{className:d.mainBox},v))))};function Ma(){return[{label:ve.All,value:ve.All},{label:ve.Overrides,value:ve.Overrides}]}var ve=(n=>(n.All="All",n.Overrides="Overrides",n.Recent="Recent",n))(ve||{});function Ia(n,t,a){const r=new xa(n,t),{optionHits:s,totalCount:i,overrideHits:l}=r.search(a);return e.createElement("div",{key:"search results"},e.createElement(St.u,{id:"Found options",title:`Matched ${s.length}/${i} options`,key:"Normal options",forceOpen:1},s.map(c=>c.render(a))),l.map(c=>c.render(a)))}const Na=n=>({wrapper:u.css`
    height: 100%;
    display: flex;
    flex-direction: column;
    flex: 1 1 0;

    .search-fragment-highlight {
      color: ${n.colors.warning.text};
      background: transparent;
    }
  `,searchBox:u.css`
    display: flex;
    flex-direction: column;
    min-height: 0;
  `,formRow:u.css`
    margin-bottom: ${n.spacing(1)};
  `,formBox:u.css`
    padding: ${n.spacing(1)};
    background: ${n.colors.background.primary};
    border: 1px solid ${n.components.panel.borderColor};
    border-top-left-radius: ${n.shape.borderRadius(1.5)};
    border-bottom: none;
  `,closeButton:u.css`
    margin-left: ${n.spacing(1)};
  `,searchHits:u.css`
    padding: ${n.spacing(1,1,0,1)};
  `,scrollWrapper:u.css`
    flex-grow: 1;
    min-height: 0;
  `,searchNotice:u.css`
    font-size: ${n.typography.size.sm};
    color: ${n.colors.text.secondary};
    padding: ${n.spacing(1)};
    text-align: center;
  `,mainBox:u.css`
    background: ${n.colors.background.primary};
    border: 1px solid ${n.components.panel.borderColor};
    border-top: none;
    flex-grow: 1;
  `});var wa=o(26202),$a=o(35974);const Qt=n=>t=>t.plugins.panels[n]||(0,$a.X)(`Panel plugin not found (${n})`,!0),Tt=({panel:n})=>{const t=(0,B.useDispatch)(),a=(0,B.useSelector)(Qt(n.type)),r=(0,B.useSelector)(c=>c.panelEditor.ui.isPanelOptionsVisible),s=(0,B.useSelector)(c=>c.panelEditor.isVizPickerOpen),i=()=>{t((0,oe.g_)(!s))},l=()=>{t(we({isPanelOptionsVisible:!r}))};return a?e.createElement("div",{className:Jt.wrapper},e.createElement(wa.h,null,e.createElement(qe.h,{className:Jt.vizButton,tooltip:"Click to change visualization",imgSrc:a.meta.info.logos.small,isOpen:s,onClick:i,"aria-label":E.wl.components.PanelEditor.toggleVizPicker,variant:"canvas",fullWidth:!0},a.meta.name),e.createElement(qe.h,{tooltip:r?"Close options pane":"Show options pane",icon:r?"angle-right":"angle-left",onClick:l,variant:"canvas","aria-label":E.wl.components.PanelEditor.toggleVizOptions}))):null};Tt.displayName="VisualizationTab";const Jt={wrapper:u.css`
    display: flex;
    flex-direction: column;
  `,vizButton:u.css`
    text-align: left;
  `};var Aa=o(24664),La=o(84952),Ua=o(9398),za=o(53708),Fa=o(76647),Yt=o(98102);const Ba=({onConfirm:n,onDismiss:t,panel:a})=>{const r=(0,Fe.V)(a),s=`${r?"Changing":"Replace with"} library panel`,i=`${r?"Changing":"Replacing with a"} library panel will remove any changes since last save.`;return e.createElement(Yt.s,{onConfirm:n,onDismiss:t,confirmText:r?"Change":"Replace",title:s,body:i,dismissText:"Cancel",isOpen:!0})};var Wa=o(18027);const Va=({panel:n,searchQuery:t})=>{const[a,r]=(0,e.useState)(!1),[s,i]=(0,e.useState)(void 0),[l,c]=(0,e.useState)([]),d=(0,e.useCallback)(R=>{c(R.map(I=>I.id))},[c]),p=(0,Ua.h4)().getCurrent(),m=(0,B.useDispatch)(),g=async()=>{s&&(i(void 0),m((0,xe.ih)(n,s)))},y=()=>r(!0),v=()=>i(void 0);return e.createElement(z.wc,{spacing:"md"},!n.libraryPanel&&e.createElement(z.wc,{align:"center"},e.createElement(L.zx,{icon:"plus",onClick:y,variant:"secondary",fullWidth:!0},"Create new library panel")),e.createElement(za.j,{onChange:d}),e.createElement("div",{className:Ha.libraryPanelsView},e.createElement(Wa.u,{currentPanelId:n.libraryPanel?.uid,searchString:t,panelFilter:l,onClickCard:i,showSecondaryActions:!0})),a&&e.createElement(Fa.c,{panel:n,onDismiss:()=>r(!1),initialFolderUid:p?.meta.folderUid,isOpen:a}),s&&e.createElement(Ba,{panel:n,onDismiss:v,onConfirm:g}))},Ha={libraryPanelsView:u.css`
    width: 100%;
  `};var Dt=o(20251),Ga=o(38490);const Ka=["timeseries","barchart","gauge","stat","piechart","bargauge","table","state-timeline","status-history","logs","candlestick"];async function ka(n,t){const a=new Dt.mi(n,t);for(const s of Ka){const l=(await(0,Ga.Ub)(s)).getSuggestionsSupplier();l&&l.getSuggestionsForData(a)}const r=a.getList();if(a.dataSummary.fieldCount===0)for(const s of Object.values(P.v.panels))!s.skipDataQuery||s.hideFromList||r.push({name:s.name,pluginId:s.id,description:s.info.description,cardOptions:{imgSrc:s.info.logos.small}});return r.sort((s,i)=>(i.score??Dt._.OK)-(s.score??Dt._.OK))}var Xt=o(98141);function Za({data:n,suggestion:t,onChange:a,width:r}){const s=(0,f.wW)(ja),{innerStyles:i,outerStyles:l,renderWidth:c,renderHeight:d}=Qa(r),p=t.cardOptions??{},m={"aria-label":t.name,className:s.vizBox,"data-testid":E.wl.components.VisualizationPreview.card(t.name),style:l,onClick:()=>{a({pluginId:t.pluginId,options:t.options,fieldConfig:t.fieldConfig})}};if(p.imgSrc)return e.createElement(ze.u,{content:t.description??t.name},e.createElement("button",{...m,className:(0,u.cx)(s.vizBox,s.imgBox)},e.createElement("div",{className:s.name},t.name),e.createElement("img",{className:s.img,src:p.imgSrc,alt:t.name})));let g=t;return t.cardOptions?.previewModifier&&(g=(0,ne.cloneDeep)(t),t.cardOptions.previewModifier(g)),e.createElement("button",{...m},e.createElement(ze.u,{content:t.name},e.createElement("div",{style:i,className:s.renderContainer},e.createElement(Xt.$,{title:"",data:n,pluginId:t.pluginId,width:c,height:d,options:g.options,fieldConfig:g.fieldConfig}),e.createElement("div",{className:s.hoverPane}))))}const ja=n=>({hoverPane:(0,u.css)({position:"absolute",top:0,right:0,left:0,borderRadius:n.spacing(2),bottom:0}),vizBox:u.css`
      position: relative;
      background: none;
      border-radius: ${n.shape.borderRadius(1)};
      cursor: pointer;
      border: 1px solid ${n.colors.border.medium};

      transition: ${n.transitions.create(["background"],{duration:n.transitions.duration.short})};

      &:hover {
        background: ${n.colors.background.secondary};
      }
    `,imgBox:u.css`
      display: flex;
      flex-direction: column;
      height: 100%;

      justify-self: center;
      color: ${n.colors.text.primary};
      width: 100%;
      display: flex;

      justify-content: center;
      align-items: center;
      text-align: center;
    `,name:u.css`
      padding-bottom: ${n.spacing(.5)};
      margin-top: ${n.spacing(-1)};
      font-size: ${n.typography.bodySmall.fontSize};
      white-space: nowrap;
      overflow: hidden;
      color: ${n.colors.text.secondary};
      font-weight: ${n.typography.fontWeightMedium};
      text-overflow: ellipsis;
    `,img:u.css`
      max-width: ${n.spacing(8)};
      max-height: ${n.spacing(8)};
    `,renderContainer:u.css`
      position: absolute;
      transform-origin: left top;
      top: 6px;
      left: 6px;
    `});function Qa(n){const a=n,r=n*(1/1.6),s=350,i=s*(1/1.6),l=6,c=(a-l*2)/s,d=(r-l*2)/i;return{renderHeight:i,renderWidth:s,outerStyles:{width:a,height:r},innerStyles:{width:s,height:i,transform:`scale(${c}, ${d})`}}}function Ja({onChange:n,data:t,panel:a,searchQuery:r}){const s=(0,f.wW)(Xa),{value:i}=(0,Te.Z)(()=>ka(t,a),[t,a]),l=Ya(r,i);return e.createElement(H.Z,{disableHeight:!0,style:{width:"100%",height:"100%"}},({width:c})=>{if(!c)return null;const d=Math.floor(c/170),p=8*(d-1),m=(c-p)/d;return e.createElement("div",null,e.createElement("div",{className:s.filterRow},e.createElement("div",{className:s.infoText},"Based on current data")),e.createElement("div",{className:s.grid,style:{gridTemplateColumns:`repeat(auto-fill, ${m-1}px)`}},l.map((g,y)=>e.createElement(Za,{key:y,data:t,suggestion:g,onChange:n,width:m})),r&&l.length===0&&e.createElement("div",{className:s.infoText},"No results matched your query")))})}function Ya(n,t){if(!n||!t)return t||[];const a=new RegExp(n,"i");return t.filter(r=>a.test(r.name)||a.test(r.pluginId))}const Xa=n=>({heading:(0,u.css)({...n.typography.h5,margin:n.spacing(0,.5,1)}),filterRow:(0,u.css)({display:"flex",flexDirection:"row",justifyContent:"space-around",alignItems:"center",paddingBottom:"8px"}),infoText:(0,u.css)({fontSize:n.typography.bodySmall.fontSize,color:n.colors.text.secondary,fontStyle:"italic"}),grid:(0,u.css)({display:"grid",gridGap:n.spacing(1),gridTemplateColumns:"repeat(auto-fill, 144px)",marginBottom:n.spacing(1),justifyContent:"space-evenly"})});var qa=o(69097),qt=o(13440),_a=o(89710);const _t=({isCurrent:n,plugin:t,onClick:a,disabled:r})=>e.createElement(_a.X,{title:t.name,plugin:t,description:t.info.description,onClick:a,isCurrent:n,disabled:r,showBadge:!0});_t.displayName="VizTypePickerPlugin";function er({searchQuery:n,onChange:t,current:a,data:r}){const s=(0,f.wW)(tr),i=(0,e.useMemo)(()=>(0,qt.x)(),[]),l=(0,e.useMemo)(()=>(0,qt.r)(i,n,a),[a,i,n]);return l.length===0?e.createElement(qa.K,null,"Could not find anything matching your query"):e.createElement("div",{className:s.grid},l.map((c,d)=>e.createElement(_t,{disabled:!1,key:c.id,isCurrent:c.id===a.id,plugin:c,onClick:p=>t({pluginId:c.id,withModKey:Boolean(p.metaKey||p.ctrlKey||p.altKey)})})))}const tr=n=>({grid:u.css`
      max-width: 100%;
      display: grid;
      grid-gap: ${n.spacing(.5)};
    `,heading:(0,u.css)({...n.typography.h5,margin:n.spacing(0,.5,1)})});var V=o(16200);const en=({panel:n,data:t})=>{const a=(0,B.useSelector)(Qt(n.type)),[r,s]=(0,e.useState)(""),[i,l]=(0,Aa.Z)(La.FL,V.Ok.Visualizations),c=(0,B.useDispatch)(),d=(0,f.wW)(nr),p=(0,e.useRef)(null),m=(0,e.useCallback)(v=>{c((0,xe.Kc)({panel:n,...v})),v.withModKey||c((0,oe.g_)(!1))},[c,n]),g=()=>{c((0,oe.g_)(!1))};if(!a)return null;const y=[{label:"Visualizations",value:V.Ok.Visualizations},{label:"Suggestions",value:V.Ok.Suggestions},{label:"Library panels",value:V.Ok.LibraryPanels,description:"Reusable panels you can share between multiple dashboards."}];return e.createElement("div",{className:d.openWrapper},e.createElement("div",{className:d.formBox},e.createElement("div",{className:d.searchRow},e.createElement(Wt.H,{value:r,onChange:s,ref:p,autoFocus:!0,placeholder:"Search for..."}),e.createElement(L.zx,{title:"Close",variant:"secondary",icon:"angle-up",className:d.closeButton,"aria-label":E.wl.components.PanelEditor.toggleVizPicker,onClick:g})),e.createElement(fe.g,{className:d.customFieldMargin},e.createElement(Xe.S,{options:y,value:i,onChange:l,fullWidth:!0}))),e.createElement("div",{className:d.scrollWrapper},e.createElement(Be.$,{autoHeightMin:"100%"},e.createElement("div",{className:d.scrollContent},i===V.Ok.Visualizations&&e.createElement(er,{current:a.meta,onChange:m,searchQuery:r,data:t,onClose:()=>{}}),i===V.Ok.Suggestions&&e.createElement(Ja,{current:a.meta,onChange:m,searchQuery:r,panel:n,data:t,onClose:()=>{}}),i===V.Ok.LibraryPanels&&e.createElement(Va,{searchQuery:r,panel:n,key:"Panel Library"})))))};en.displayName="VisualizationSelectPane";const nr=n=>({icon:u.css`
      color: ${n.v1.palette.gray33};
    `,wrapper:u.css`
      display: flex;
      flex-direction: column;
      flex: 1 1 0;
      height: 100%;
    `,vizButton:u.css`
      text-align: left;
    `,scrollWrapper:u.css`
      flex-grow: 1;
      min-height: 0;
    `,scrollContent:u.css`
      padding: ${n.spacing(1)};
    `,openWrapper:u.css`
      display: flex;
      flex-direction: column;
      flex: 1 1 100%;
      height: 100%;
      background: ${n.colors.background.primary};
      border: 1px solid ${n.colors.border.weak};
    `,searchRow:u.css`
      display: flex;
      margin-bottom: ${n.spacing(1)};
    `,closeButton:u.css`
      margin-left: ${n.spacing(1)};
    `,customFieldMargin:u.css`
      margin-bottom: ${n.spacing(1)};
    `,formBox:u.css`
      padding: ${n.spacing(1)};
      padding-bottom: 0;
    `}),ar=({plugin:n,panel:t,onFieldConfigsChange:a,onPanelOptionsChanged:r,onPanelConfigChange:s,dashboard:i,instanceState:l})=>{const c=(0,f.wW)(rr),d=(0,B.useSelector)(m=>m.panelEditor.isVizPickerOpen),{data:p}=bt(t,{withTransforms:!0,withFieldConfig:!1},!0);return e.createElement("div",{className:c.wrapper,"aria-label":E.wl.components.PanelEditor.OptionsPane.content},!d&&e.createElement(e.Fragment,null,e.createElement("div",{className:c.vizButtonWrapper},e.createElement(Tt,{panel:t})),e.createElement("div",{className:c.optionsWrapper},e.createElement(Oa,{panel:t,dashboard:i,plugin:n,instanceState:l,data:p,onFieldConfigsChange:a,onPanelOptionsChanged:r,onPanelConfigChange:s}))),d&&e.createElement(en,{panel:t,data:p}))},rr=n=>({wrapper:u.css`
      height: 100%;
      width: 100%;
      display: flex;
      flex: 1 1 0;
      flex-direction: column;
      padding: 0;
    `,optionsWrapper:u.css`
      flex-grow: 1;
      min-height: 0;
    `,vizButtonWrapper:u.css`
      padding: 0 ${n.spacing(2,2)} 0;
    `,legacyOptions:u.css`
      label: legacy-options;
      .panel-options-grid {
        display: flex;
        flex-direction: column;
      }
      .panel-options-group {
        margin-bottom: 0;
      }
      .panel-options-group__body {
        padding: ${n.spacing(2)} 0;
      }

      .section {
        display: block;
        margin: ${n.spacing(2)} 0;

        &:first-child {
          margin-top: 0;
        }
      }
    `});var tn=o(82378),sr=o(86635),or=o(2476),ir=o(53821);function lr({width:n,height:t,panel:a,dashboard:r}){const{data:s}=bt(a,{withTransforms:!0,withFieldConfig:!1},!1),[i,l]=(0,e.useState)({frameIndex:0,showHeader:!0,showTypeIcons:!0});return(0,e.useEffect)(()=>{const c=(0,Le.$t)(),d=a.events.subscribe(tn.U5,()=>{const p=(0,or.W1)(a,c.timeRange());a.runAllPanelQueries({dashboardId:r.id,dashboardUID:r.uid,dashboardTimezone:r.getTimezone(),timeData:p,width:n})});return()=>{d.unsubscribe()}},[a,r,n]),s?e.createElement(sr.fm,{width:n,height:t,padding:"none"},(c,d)=>e.createElement(e.Fragment,null,e.createElement(ir.Z,{panel:a,error:s?.error?.message}),e.createElement(Xt.$,{title:"Raw data",pluginId:"table",width:c,height:d,data:s,options:i,onOptionsChange:l}))):null}var nn=o(32434),xt=o(40419),cr=o(94893),dr=o(85081),ur=o(69142);function an({message:n}){const t=(0,e.useCallback)(()=>{b.E1.partial({tab:V.Ip.Query})},[]);return e.createElement(z.Ar,{justify:"center",style:{marginTop:"100px"}},e.createElement(z.wc,{spacing:"md"},e.createElement("h2",null,n),e.createElement("div",null,e.createElement(L.zx,{size:"md",variant:"secondary",icon:"arrow-left",onClick:t},"Go back to Queries"))))}var Rt=o(54899),mr=o(71657),rn=o(67162);class pr extends e.PureComponent{constructor(){super(...arguments),this.state={stateHistoryItems:[]},this.clearHistory=async()=>{const{dashboard:t,panelId:a,onRefresh:r}=this.props;await(0,Rt.i)().post("/api/annotations/mass-delete",{dashboardId:t.id,panelId:a}),this.setState({stateHistoryItems:[]}),r()}}componentDidMount(){const{dashboard:t,panelId:a}=this.props;(0,Rt.i)().get(`/api/annotations?dashboardId=${t.id}&panelId=${a}&limit=50&type=alert`,{},`state-history-${t.id}-${a}`).then(r=>{const s=r.map(i=>({stateModel:rn.Z.getStateDisplayModel(i.newState),time:t.formatDate(i.time,"MMM D, YYYY HH:mm:ss"),info:rn.Z.getAlertAnnotationInfo(i)}));this.setState({stateHistoryItems:s})})}render(){const{stateHistoryItems:t}=this.state;return e.createElement("div",null,t.length>0&&e.createElement("div",{className:"p-b-1"},e.createElement("span",{className:"muted"},"Last 50 state changes"),e.createElement(mr.p,{onConfirm:this.clearHistory,confirmVariant:"destructive",confirmText:"Clear"},e.createElement(L.zx,{className:u.css`
                  direction: ltr;
                `,variant:"destructive",icon:"trash-alt"},"Clear history"))),e.createElement("ol",{className:"alert-rule-list"},t.length>0?t.map((a,r)=>e.createElement("li",{className:"alert-rule-item",key:`${a.time}-${r}`},e.createElement("div",{className:`alert-rule-item__icon ${a.stateModel.stateClass}`},e.createElement(ae.J,{name:a.stateModel.iconClass,size:"xl"})),e.createElement("div",{className:"alert-rule-item__body"},e.createElement("div",{className:"alert-rule-item__header"},e.createElement("p",{className:"alert-rule-item__name"},a.alertName),e.createElement("div",{className:"alert-rule-item__text"},e.createElement("span",{className:`${a.stateModel.stateClass}`},a.stateModel.text))),a.info),e.createElement("div",{className:"alert-rule-item__time"},a.time))):e.createElement("i",null,"No state changes recorded")))}}const gr=pr;var sn=o(61744),Ot=o(16065);class hr extends e.PureComponent{constructor(){super(...arguments),this.state={isLoading:!1,allNodesExpanded:null,testRuleResponse:{}},this.setFormattedJson=t=>{this.formattedJson=t},this.getTextForClipboard=()=>JSON.stringify(this.formattedJson,null,2),this.onToggleExpand=()=>{this.setState(t=>({...t,allNodesExpanded:!this.state.allNodesExpanded}))},this.getNrOfOpenNodes=()=>this.state.allNodesExpanded===null?3:this.state.allNodesExpanded?20:1,this.renderExpandCollapse=()=>{const{allNodesExpanded:t}=this.state,a=e.createElement(e.Fragment,null,e.createElement(ae.J,{name:"minus-circle"})," Collapse All"),r=e.createElement(e.Fragment,null,e.createElement(ae.J,{name:"plus-circle"})," Expand All");return t?a:r}}componentDidMount(){this.testRule()}async testRule(){const{dashboard:t,panel:a}=this.props,r=t.getSaveModelClone();r.panels=r.panels.map(l=>l.id===a.id?a.getSaveModel():l);const s={dashboard:r,panelId:a.id};this.setState({isLoading:!0});const i=await(0,Rt.i)().post("/api/alerts/test",s);this.setState({isLoading:!1,testRuleResponse:i})}render(){const{testRuleResponse:t,isLoading:a}=this.state;if(a===!0)return e.createElement(sn.u,{text:"Evaluating rule"});const r=this.getNrOfOpenNodes();return e.createElement(e.Fragment,null,e.createElement("div",{className:"pull-right"},e.createElement(z.Lh,{spacing:"md"},e.createElement("div",{onClick:this.onToggleExpand},this.renderExpandCollapse()),e.createElement($e.m,{getText:this.getTextForClipboard,icon:"copy"},"Copy to Clipboard"))),e.createElement(Ot.g,{json:t,open:r,onDidRender:this.setFormattedJson}))}}var fr=o(44927);class vr extends e.PureComponent{constructor(){super(...arguments),this.state={validationMessage:"",showStateHistory:!1,showDeleteConfirmation:!1,showTestRule:!1},this.onAngularPanelUpdated=()=>{this.forceUpdate()},this.onAddAlert=()=>{this.panelCtrl?._enableAlert(),this.component?.digest(),this.forceUpdate()},this.onToggleModal=t=>{const a=this.state[t];this.setState({...this.state,[t]:!a})},this.renderTestRule=()=>{if(!this.state.showTestRule)return null;const{panel:t,dashboard:a}=this.props,r=()=>this.onToggleModal("showTestRule");return e.createElement(be.u,{isOpen:!0,icon:"bug",title:"Testing rule",onDismiss:r,onClickBackdrop:r},e.createElement(hr,{panel:t,dashboard:a}))},this.renderDeleteConfirmation=()=>{if(!this.state.showDeleteConfirmation)return null;const{panel:t}=this.props,a=()=>this.onToggleModal("showDeleteConfirmation");return e.createElement(Yt.s,{isOpen:!0,icon:"trash-alt",title:"Delete",body:e.createElement("div",null,"Are you sure you want to delete this alert rule?",e.createElement("br",null),e.createElement("small",null,"You need to save dashboard for the delete to take effect.")),confirmText:"Delete alert",onDismiss:a,onConfirm:()=>{delete t.alert,t.thresholds=[],this.panelCtrl&&(this.panelCtrl.alertState=null,this.panelCtrl.render()),this.component?.digest(),a()}})},this.renderStateHistory=()=>{if(!this.state.showStateHistory)return null;const{panel:t,dashboard:a}=this.props,r=()=>this.onToggleModal("showStateHistory");return e.createElement(be.u,{isOpen:!0,icon:"history",title:"State history",onDismiss:r,onClickBackdrop:r},e.createElement(gr,{dashboard:a,panelId:t.id,onRefresh:()=>this.panelCtrl?.refresh()}))}}async componentDidMount(){P.v.angularSupportEnabled?(await o.e(5718).then(o.bind(o,30789)),this.loadAlertTab()):alert("Angular support disabled, legacy alerting cannot function without angular support")}componentDidUpdate(t){this.loadAlertTab()}componentWillUnmount(){this.component&&this.component.destroy()}async loadAlertTab(){const{panel:t,angularPanelComponent:a}=this.props;if(!this.element||this.component)return;if(a){const c=a.getScope();if(!c.$$childHead){setTimeout(()=>{this.forceUpdate()});return}this.panelCtrl=c.$$childHead.ctrl}else this.panelCtrl=this.getReactAlertPanelCtrl();const r=(0,Vt.w)(),s="<alert-tab />",i={ctrl:this.panelCtrl};this.component=r.load(this.element,i,s);const l=await(0,fr.E)(t.transformations,t.targets,(0,Ut.F)(),t.datasource);l&&this.setState({validationMessage:l})}getReactAlertPanelCtrl(){return{panel:this.props.panel,events:new dr.F,render:()=>{this.props.panel.render()}}}render(){const{alert:t,transformations:a}=this.props.panel,{validationMessage:r}=this.state,s=a&&a.length>0;if(!t&&r)return e.createElement(an,{message:r});const i={title:"Panel has no alert rule defined",buttonIcon:"bell",onClick:this.onAddAlert,buttonTitle:"Create Alert"};return e.createElement(e.Fragment,null,e.createElement(Be.$,{autoHeightMin:"100%"},e.createElement(z.W2,{padding:"md"},e.createElement("div",{"aria-label":E.wl.components.AlertTab.content},t&&s&&e.createElement(de.b,{severity:B.AppNotificationSeverity.Error,title:"Transformations are not supported in alert queries"}),e.createElement("div",{ref:l=>this.element=l}),t&&e.createElement(z.Lh,null,e.createElement(L.zx,{onClick:()=>this.onToggleModal("showStateHistory"),variant:"secondary"},"State history"),e.createElement(L.zx,{onClick:()=>this.onToggleModal("showTestRule"),variant:"secondary"},"Test rule"),e.createElement(L.zx,{onClick:()=>this.onToggleModal("showDeleteConfirmation"),variant:"destructive"},"Delete")),!t&&!r&&e.createElement(ur.Z,{...i})))),this.renderTestRule(),this.renderDeleteConfirmation(),this.renderStateHistory())}}const Er=(n,t)=>({angularPanelComponent:(0,Q.i)(n,t.panel)?.angularComponent}),br={},yr=(0,D.connect)(Er,br)(vr);var Pr=o(27677),Cr=o(54408),Sr=o(41904),Tr=o(21767);const on=({dashboard:n,panel:t,className:a})=>{const r=(0,B.useSelector)(d=>d.templating),s=(0,ge.TH)(),{loading:i,value:l}=(0,Te.Z)(()=>(0,Tr.aR)(t,n),[t,n,r]);if(i)return e.createElement(L.zx,{disabled:!0},"Create alert rule from this panel");if(!l)return e.createElement(de.b,{severity:"info",title:"No alerting capable query found"},"Cannot create alerts from this panel because no query to an alerting capable datasource is found.");const c=Pr.Cj.renderUrl("alerting/new",{defaults:JSON.stringify(l),returnTo:s.pathname+s.search});return e.createElement(L.Qj,{icon:"bell",onClick:()=>(0,Cr.PN)(Sr.z7.alertRuleFromPanel),href:c,className:a,"data-testid":"create-alert-rule-button"},"Create alert rule from this panel")};var Dr=o(25048),ln=o(72004),Mt=o(37190),Oe=o(45849),cn=o(46818),xr=o(61627),dn=o(69945);function un({dashboard:n,panel:t,poll:a=!1}){const r=(0,B.useDispatch)(),s=(0,dn._)(m=>m.promRules[Oe.GC])??cn.oq,i=(0,dn._)(m=>m.rulerRules[Oe.GC])??cn.oq;(0,e.useEffect)(()=>{const m=()=>{r((0,ln.y6)({rulesSourceName:Oe.GC,filter:{dashboardUID:n.uid,panelId:t.id}})),r((0,ln.UR)({rulesSourceName:Oe.GC,filter:{dashboardUID:n.uid,panelId:t.id}}))};if(m(),a){const g=setInterval(m,Mt.p4);return()=>{clearInterval(g)}}return()=>{}},[r,a,t.id,n.uid]);const l=s.loading||i.loading,c=[s.error,i.error].filter(m=>!!m),d=(0,xr.Zo)(Oe.GC);return{rules:(0,e.useMemo)(()=>d.flatMap(m=>m.groups).flatMap(m=>m.rules).filter(m=>m.annotations[Mt.q6.dashboardUID]===n.uid&&m.annotations[Mt.q6.panelID]===String(t.id)),[d,n,t]),errors:c,loading:l}}var mn=o(97953);const Rr=({dashboard:n,panel:t})=>{const a=(0,f.wW)(Or),{errors:r,loading:s,rules:i}=un({dashboard:n,panel:t,poll:!0}),l=(0,mn.Bz)("grafana"),c=Se.Vt.hasPermission(l.create),d=r.length?e.createElement(de.b,{title:"Errors loading rules",severity:"error"},r.map((p,m)=>e.createElement("div",{key:m},"Failed to load Grafana rules state: ",p.message||"Unknown error."))):null;return s&&!i.length?e.createElement("div",{className:a.innerWrapper},d,e.createElement(sn.u,{text:"Loading rules..."})):i.length?e.createElement(Be.$,{autoHeightMin:"100%"},e.createElement("div",{className:a.innerWrapper},d,e.createElement(Dr.i,{rules:i}),!!n.meta.canSave&&c&&e.createElement(on,{className:a.newButton,panel:t,dashboard:n}))):e.createElement("div",{"aria-label":E.wl.components.PanelAlertTabContent.content,className:a.noRulesWrapper},d,!!n.uid&&e.createElement(e.Fragment,null,e.createElement("p",null,"There are no alert rules linked to this panel."),!!n.meta.canSave&&c&&e.createElement(on,{panel:t,dashboard:n})),!n.uid&&!!n.meta.canSave&&e.createElement(de.b,{severity:"info",title:"Dashboard not saved"},"Dashboard must be saved before alerts can be added."))},Or=n=>({newButton:u.css`
    margin-top: ${n.spacing(3)};
  `,innerWrapper:u.css`
    padding: ${n.spacing(2)};
  `,noRulesWrapper:u.css`
    margin: ${n.spacing(2)};
    background-color: ${n.colors.background.secondary};
    padding: ${n.spacing(3)};
  `}),Mr=P.v.unifiedAlertingEnabled?Rr:yr,Ir=({panel:n,dashboard:t,...a})=>{const{rules:r,loading:s}=un({panel:n,dashboard:t});return e.createElement(ye.O,{...a,counter:s?null:r.length})};var pn=o(19677),It=o(20256),nt=o(80548),at=o(72948),Nr=o(59796);const wr={[nt.x.Transformations]:"https://grafana.com/docs/grafana/latest/panels/transformations",[nt.x.FieldConfig]:"https://grafana.com/docs/grafana/latest/panels/field-configuration-options/",[nt.x.FieldConfigOverrides]:"https://grafana.com/docs/grafana/latest/panels/field-configuration-options/#override-a-field"},$r=n=>wr[n];var gn=o(81731),hn=o(86253),Ar=o(85854),Lr=o(19117),We=o(1029),Ur=o(67254),zr=o(98356),Fr=o(3249),Nt=o(79720);const Br=({debugMode:n,index:t,data:a,uiConfig:r,configs:s,onChange:i})=>{const l=(0,f.wW)(Wr),[c,d]=(0,e.useState)([]),[p,m]=(0,e.useState)([]),g=(0,e.useMemo)(()=>s[t],[s,t]);(0,e.useEffect)(()=>{const v=s[t].transformation,R=v.filter?.options?(0,Fr.b9)(v.filter):void 0,I=s.slice(0,t).map(te=>te.transformation),J=s.slice(t,t+1).map(te=>te.transformation),M=(0,Nt.H)(I,a).subscribe(te=>{R&&(te=a.filter(Z=>R(Z))),d(te)}),N=(0,Nt.H)(I,a).pipe((0,zr.z)(te=>(0,Nt.H)(J,te))).subscribe(m);return function(){M.unsubscribe(),N.unsubscribe()}},[t,a,s]);const y=(0,e.useMemo)(()=>e.createElement(r.editor,{options:{...r.transformation.defaultOptions,...g.transformation.options},input:c,onChange:v=>{i(t,{...g.transformation,options:v})}}),[r.editor,r.transformation.defaultOptions,g.transformation,c,i,t]);return e.createElement("div",{className:l.editor,"aria-label":E.wl.components.TransformTab.transformationEditor(r.name)},y,n&&e.createElement("div",{className:l.debugWrapper,"aria-label":E.wl.components.TransformTab.transformationEditorDebugger(r.name)},e.createElement("div",{className:l.debug},e.createElement("div",{className:l.debugTitle},"Transformation input data"),e.createElement("div",{className:l.debugJson},e.createElement(Ot.g,{json:c}))),e.createElement("div",{className:l.debugSeparator},e.createElement(ae.J,{name:"arrow-right"})),e.createElement("div",{className:l.debug},e.createElement("div",{className:l.debugTitle},"Transformation output data"),e.createElement("div",{className:l.debugJson},p&&e.createElement(Ot.g,{json:p})))))},Wr=n=>{const t=n.isLight?n.v1.palette.gray85:n.v1.palette.gray15;return{title:u.css`
      display: flex;
      padding: 4px 8px 4px 8px;
      position: relative;
      height: 35px;
      border-radius: 4px 4px 0 0;
      flex-wrap: nowrap;
      justify-content: space-between;
      align-items: center;
    `,name:u.css`
      font-weight: ${n.typography.fontWeightMedium};
      color: ${n.colors.primary.text};
    `,iconRow:u.css`
      display: flex;
    `,icon:u.css`
      background: transparent;
      border: none;
      box-shadow: none;
      cursor: pointer;
      color: ${n.colors.text.secondary};
      margin-left: ${n.spacing(1)};
      &:hover {
        color: ${n.colors.text};
      }
    `,editor:u.css``,debugWrapper:u.css`
      display: flex;
      flex-direction: row;
    `,debugSeparator:u.css`
      width: 48px;
      min-height: 300px;
      display: flex;
      align-items: center;
      align-self: stretch;
      justify-content: center;
      margin: 0 ${n.spacing(.5)};
      color: ${n.colors.primary.text};
    `,debugTitle:u.css`
      padding: ${n.spacing(1)} ${n.spacing(.25)};
      font-family: ${n.typography.fontFamilyMonospace};
      font-size: ${n.typography.bodySmall.fontSize};
      color: ${n.colors.text};
      border-bottom: 1px solid ${t};
      flex-grow: 0;
      flex-shrink: 1;
    `,debug:u.css`
      margin-top: ${n.spacing(1)};
      padding: 0 ${n.spacing(1,1,1)};
      border: 1px solid ${t};
      background: ${n.isLight?n.v1.palette.white:n.v1.palette.gray05};
      border-radius: ${n.shape.borderRadius(1)};
      width: 100%;
      min-height: 300px;
      display: flex;
      flex-direction: column;
      align-self: stretch;
    `,debugJson:u.css`
      flex-grow: 1;
      height: 100%;
      overflow: hidden;
      padding: ${n.spacing(.5)};
    `}};var Vr=o(92465);const Hr=({index:n,data:t,config:a,onChange:r})=>{const s=(0,f.wW)(Gr),i=(0,e.useMemo)(()=>({data:t}),[t]);return e.createElement("div",{className:s.wrapper},e.createElement("h5",null,"Apply tranformation to"),e.createElement(Vr.M,{value:a.filter,context:i,item:{},onChange:l=>r(n,{...a,filter:l})}))},Gr=n=>{const t=n.shape.borderRadius();return{wrapper:u.css`
      padding: ${n.spacing(2)};
      border: 2px solid ${n.colors.background.secondary};
      border-top: none;
      border-radius: 0 0 ${t} ${t};
      position: relative;
      top: -4px;
    `}},Kr=({onRemove:n,index:t,id:a,data:r,configs:s,uiConfig:i,onChange:l})=>{const[c,d]=(0,hn.Z)(!1),[p,m]=(0,hn.Z)(!1),g=s[t].transformation.disabled,y=s[t].transformation.filter!=null,v=y||r.length>1,R=(0,e.useCallback)(M=>{const N=s[M].transformation;l(M,{...N,disabled:N.disabled?void 0:!0})},[l,s]),I=(0,e.useCallback)(()=>{let M={...s[t].transformation};M.filter?delete M.filter:M.filter={id:Ar.E4.byRefId,options:""},l(t,M)},[l,t,s]),J=({isOpen:M})=>e.createElement(z.Lh,{align:"center",width:"auto"},i.state&&e.createElement(gn.u,{state:i.state}),e.createElement(We.y,{title:"Show/hide transform help",icon:"info-circle",onClick:m,active:p}),v&&e.createElement(We.y,{title:"Filter",icon:"filter",onClick:I,active:y}),e.createElement(We.y,{title:"Debug",disabled:!M,icon:"bug",onClick:d,active:c}),e.createElement(We.y,{title:"Disable/Enable transformation",icon:g?"eye-slash":"eye",onClick:()=>R(t),active:g}),e.createElement(We.y,{title:"Remove",icon:"trash-alt",onClick:()=>n(t)}));return e.createElement(Ur.t,{id:a,index:t,title:i.name,draggable:!0,actions:J,disabled:g},p&&e.createElement(Lr.h,{markdown:kr(i)}),y&&e.createElement(Hr,{index:t,config:s[t].transformation,data:r,onChange:l}),e.createElement(Br,{debugMode:c,index:t,data:r,configs:s,uiConfig:i,onChange:l}))};function kr(n){return`
${n.help??n.description}

Go the <a href="https://grafana.com/docs/grafana/latest/panels/transformations/?utm_source=grafana" target="_blank" rel="noreferrer">
transformation documentation
</a> for more.
`}const Zr=({data:n,onChange:t,onRemove:a,configs:r})=>e.createElement(e.Fragment,null,r.map((s,i)=>{const l=It.Z.getIfExists(s.transformation.id);return l?e.createElement(Kr,{index:i,id:`${s.id}`,key:`${s.id}`,data:n,configs:r,uiConfig:l,onRemove:a,onChange:t}):null})),jr="dashboard.components.TransformationEditor.featureInfoBox.isDismissed";class Qr extends e.PureComponent{constructor(t){super(t),this.onSearchChange=s=>{this.setState({search:s.target.value})},this.onSearchKeyDown=s=>{if(s.key==="Enter"){const{search:i}=this.state;if(i){const l=i.toLowerCase(),c=It.Z.list().filter(d=>(d.name+d.description).toLowerCase().indexOf(l)>=0);c.length>0&&this.onTransformationAdd({value:c[0].id})}}else s.keyCode===27&&(this.setState({search:"",showPicker:!1}),s.stopPropagation())},this.getTransformationNextId=s=>{const{transformations:i}=this.state;let l=0;const c=i.filter(d=>d.id.startsWith(s)).map(d=>d.id);return c.length!==0&&(l=Math.max(...c.map(d=>parseInt(d.match(/\d+/)[0],10)))+1),`${s}-${l}`},this.onTransformationAdd=s=>{const{transformations:i}=this.state,l=this.getTransformationNextId(s.value);this.setState({search:"",showPicker:!1}),this.onChange([...i,{id:l,transformation:{id:s.value,options:{}}}])},this.onTransformationChange=(s,i)=>{const{transformations:l}=this.state,c=Array.from(l);c[s].transformation=i,this.onChange(c)},this.onTransformationRemove=s=>{const{transformations:i}=this.state,l=Array.from(i);l.splice(s,1),this.onChange(l)},this.onDragEnd=s=>{const{transformations:i}=this.state;if(!s||!s.destination)return;const l=s.source.index,c=s.destination.index;if(l===c)return;const d=Array.from(i),[p]=d.splice(l,1);d.splice(c,0,p),this.onChange(d)},this.renderTransformationEditors=()=>{const{data:s,transformations:i}=this.state;return e.createElement(pn.Z5,{onDragEnd:this.onDragEnd},e.createElement(pn.bK,{droppableId:"transformations-list",direction:"vertical"},l=>e.createElement("div",{ref:l.innerRef,...l.droppableProps},e.createElement(Zr,{configs:i,data:s,onRemove:this.onTransformationRemove,onChange:this.onTransformationChange}),l.placeholder)))};const a=t.panel.transformations||[],r=this.buildTransformationIds(a);this.state={transformations:a.map((s,i)=>({transformation:s,id:r[i]})),data:[],search:""}}buildTransformationIds(t){const a={},r=[];for(let s=0;s<t.length;s++){const i=t[s];a[i.id]===void 0?a[i.id]=0:a[i.id]+=1,r.push(`${t[s].id}-${a[t[s].id]}`)}return r}componentDidMount(){this.subscription=this.props.panel.getQueryRunner().getData({withTransforms:!1,withFieldConfig:!1}).subscribe({next:t=>this.setState({data:t.series})})}componentWillUnmount(){this.subscription&&this.subscription.unsubscribe()}onChange(t){this.setState({transformations:t}),this.props.panel.setTransformations(t.map(a=>a.transformation))}renderTransformsPicker(){const{transformations:t,search:a}=this.state;let r=null,s=It.Z.list().sort((c,d)=>c.name>d.name?1:d.name>c.name?-1:0);if(a){const c=a.toLowerCase(),d=s.filter(p=>(p.name+p.description).toLowerCase().indexOf(c)>=0);r=e.createElement(e.Fragment,null,d.length," / ",s.length," \xA0\xA0",e.createElement(tt.h,{name:"times",onClick:()=>{this.setState({search:""})}})),s=d}const i=!t?.length,l=i||this.state.showPicker;return!r&&l&&!i&&(r=e.createElement(tt.h,{name:"times",onClick:()=>{this.setState({showPicker:!1})}})),e.createElement(e.Fragment,null,i&&e.createElement(z.W2,{grow:1},e.createElement(Nr.G,{storageKey:jr,defaultValue:!1},(c,d)=>c?null:e.createElement(de.b,{title:"Transformations",severity:"info",onRemove:()=>{d(!0)}},e.createElement("p",null,"Transformations allow you to join, calculate, re-order, hide, and rename your query results before they are visualized. ",e.createElement("br",null),"Many transforms are not suitable if you're using the Graph visualization, as it currently only supports time series data. ",e.createElement("br",null),"It can help to switch to the Table visualization to understand what a transformation is doing."," "),e.createElement("a",{href:$r(nt.x.Transformations),className:"external-link",target:"_blank",rel:"noreferrer"},"Read more")))),l?e.createElement(z.wc,null,e.createElement(De.I,{"aria-label":E.wl.components.Transforms.searchInput,value:a??"",autoFocus:!i,placeholder:"Add transformation",onChange:this.onSearchChange,onKeyDown:this.onSearchKeyDown,suffix:r}),s.map(c=>e.createElement(Jr,{key:c.name,transform:c,onClick:()=>{this.onTransformationAdd({value:c.id})}}))):e.createElement(L.zx,{icon:"plus",variant:"secondary",onClick:()=>{this.setState({showPicker:!0})}},"Add transformation"))}render(){const{panel:{alert:t}}=this.props,{transformations:a}=this.state,r=a.length>0;return!r&&t?e.createElement(an,{message:"Transformations can't be used on a panel with existing alerts"}):e.createElement(Be.$,{autoHeightMin:"100%"},e.createElement(z.W2,{padding:"md"},e.createElement("div",{"aria-label":E.wl.components.TransformTab.content},r&&t?e.createElement(de.b,{severity:B.AppNotificationSeverity.Error,title:"Transformations can't be used on a panel with alerts"}):null,r&&this.renderTransformationEditors(),this.renderTransformsPicker())))}}function Jr({transform:n,onClick:t}){const a=(0,f.wW)(Yr);return e.createElement(at.Z,{className:a.card,"aria-label":E.wl.components.TransformTab.newTransform(n.name),onClick:t},e.createElement(at.Z.Heading,null,n.name),e.createElement(at.Z.Description,null,n.description),n.state&&e.createElement(at.Z.Tags,null,e.createElement(gn.u,{state:n.state})))}const Yr=n=>({card:u.css`
      margin: 0;
      padding: ${n.spacing(1)};
    `}),Xr=(0,f.Zz)(Qr);var qr=o(5916),fn=o(91162),_r=o(98016);class es extends e.PureComponent{constructor(t){super(t),this.onRunQueries=()=>{this.props.panel.refresh()},this.onOpenQueryInspector=()=>{b.E1.partial({inspect:this.props.panel.id,inspectTab:"query"})},this.onOptionsChange=a=>{const{panel:r}=this.props;r.updateQueries(a),a.dataSource.uid!==r.datasource?.uid&&setTimeout(this.onRunQueries,10),this.forceUpdate()}}buildQueryOptions(t){const a=t.datasource??{default:!0},r=(0,fn.ak)().getInstanceSettings(a);return{cacheTimeout:r?.meta.queryOptions?.cacheTimeout?t.cacheTimeout:void 0,dataSource:{default:r?.isDefault,type:r?.type,uid:r?.uid},queries:t.targets,maxDataPoints:t.maxDataPoints,minInterval:t.interval,savedQueryUid:t.savedQueryLink?.ref.uid??null,timeRange:{from:t.timeFrom,shift:t.timeShift,hide:t.hideTimeOverride}}}async componentDidMount(){const{panel:t}=this.props;if(!t.datasource){const a=(0,fn.ak)().getInstanceSettings(null);t.datasource=(0,qr.iU)(a),this.forceUpdate()}}render(){const{panel:t}=this.props;if(!t.datasource)return null;const a=this.buildQueryOptions(t);return e.createElement(_r.D,{options:a,queryRunner:t.getQueryRunner(),onRunQueries:this.onRunQueries,onOpenQueryInspector:this.onOpenQueryInspector,onOptionsChange:this.onOptionsChange})}}const vn=e.memo(({panel:n,dashboard:t,tabs:a,onChangeTab:r})=>{const s=(0,nn.N)(),i=(0,f.wW)(ns);(0,e.useEffect)(()=>{const c=new zt.w0;return c.add(n.events.subscribe(K.pO,s)),c.add(n.events.subscribe(K.Xw,s)),()=>c.unsubscribe()},[n,t,s]);const l=a.find(c=>c.active);return a.length===0?null:e.createElement("div",{className:i.wrapper},e.createElement(Re.J,{className:i.tabBar,hideBorder:!0},a.map(c=>c.id===V.Ip.Alert?ts(c,n,t,r):e.createElement(ye.O,{key:c.id,label:c.text,active:c.active,onChangeTab:()=>r(c),icon:(0,xt.toIconName)(c.icon),counter:En(n,c)}))),e.createElement(cr.I,{className:i.tabContent},l.id===V.Ip.Query&&e.createElement(es,{panel:n,queries:n.targets}),l.id===V.Ip.Alert&&e.createElement(Mr,{panel:n,dashboard:t}),l.id===V.Ip.Transform&&e.createElement(Xr,{panel:n})))});vn.displayName="PanelEditorTabs";function En(n,t){switch(t.id){case V.Ip.Query:return n.targets.length;case V.Ip.Alert:return n.alert?1:0;case V.Ip.Transform:return(n.getTransformations()??[]).length}return null}function ts(n,t,a,r){return!P.v.alertingEnabled&&!P.v.unifiedAlertingEnabled?null:P.v.unifiedAlertingEnabled?e.createElement(Ir,{key:n.id,label:n.text,active:n.active,onChangeTab:()=>r(n),icon:(0,xt.toIconName)(n.icon),panel:t,dashboard:a}):P.v.alertingEnabled?e.createElement(ye.O,{key:n.id,label:n.text,active:n.active,onChangeTab:()=>r(n),icon:(0,xt.toIconName)(n.icon),counter:En(t,n)}):null}const ns=n=>({wrapper:u.css`
      display: flex;
      flex-direction: column;
      height: 100%;
    `,tabBar:u.css`
      padding-left: ${n.spacing(2)};
    `,tabContent:u.css`
      padding: 0;
      display: flex;
      flex-direction: column;
      flex-grow: 1;
      min-height: 0;
      background: ${n.colors.background.primary};
      border: 1px solid ${n.components.panel.borderColor};
      border-left: none;
      border-bottom: none;
      border-top-right-radius: ${n.shape.borderRadius(1.5)};
    `});var as=o(58635),rs=o(47694);const ss=(0,as.Z)((n,t)=>{const a=[];if(!t)return a;let r=V.Ip.Visualize;if(t.meta.skipDataQuery)return[];t.meta.skipDataQuery||(r=V.Ip.Query,a.push({id:V.Ip.Query,text:"Query",icon:"database",active:!1}),a.push({id:V.Ip.Transform,text:"Transform",icon:"process",active:!1}));const{alertingEnabled:s,unifiedAlertingEnabled:i}=(0,rs.iE)(),l=Se.Vt.hasPermission((0,mn.Bz)(Oe.GC).read),c=s||i&&l,d=t.meta.id==="graph",p=t.meta.id==="timeseries";(c&&d||p)&&a.push({id:V.Ip.Alert,text:"Alert",icon:"bell",active:!1});const m=a.find(g=>g.id===(n||r))??a[0];return m.active=!0,a}),os=(n,t)=>{const a=n.panelEditor.getPanel(),r=(0,Q.i)(n,a);return{panel:a,plugin:r?.plugin,instanceState:r?.instanceState,initDone:n.panelEditor.initDone,uiState:n.panelEditor.ui,tableViewEnabled:n.panelEditor.tableViewEnabled,variables:(0,Ct.gt)(t.dashboard.uid,n)}},is={initPanelEditor:dt,discardPanelChanges:Ze,updatePanelEditorUIState:we,updateTimeZoneForSession:qn.YT,toggleTableView:oe.OT,notifyApp:$.$l},ls=(0,D.connect)(os,is);class cs extends e.PureComponent{constructor(){super(...arguments),this.state={showSaveLibraryPanelModal:!1},this.triggerForceUpdate=()=>{this.forceUpdate()},this.onBack=()=>{b.E1.partial({editPanel:null,tab:null,showCategory:null})},this.onDiscard=()=>{this.props.discardPanelChanges(),this.onBack()},this.onSaveDashboard=()=>{Qn.h$.publish(new K.Dn({component:na.d,props:{dashboard:this.props.dashboard}}))},this.onSaveLibraryPanel=async()=>{(0,Fe.V)(this.props.panel)&&this.setState({showSaveLibraryPanelModal:!0})},this.onChangeTab=t=>{b.E1.partial({tab:t.id})},this.onFieldConfigChange=t=>{this.props.panel.updateFieldConfig({...t})},this.onPanelOptionsChanged=t=>{this.props.panel.updateOptions(t)},this.onPanelConfigChanged=(t,a)=>{this.props.panel.setProperty(t,a),this.props.panel.render(),this.forceUpdate()},this.onDisplayModeChange=t=>{const{updatePanelEditorUIState:a}=this.props;this.props.tableViewEnabled&&this.props.toggleTableView(),a({mode:t})},this.onToggleTableView=()=>{this.props.toggleTableView()},this.onGoBackToDashboard=()=>{b.E1.partial({editPanel:null,tab:null,showCategory:null})},this.onConfirmAndDismissLibarayPanelModel=()=>{this.setState({showSaveLibraryPanelModal:!1})}}componentDidMount(){this.props.initPanelEditor(this.props.sourcePanel,this.props.dashboard)}componentDidUpdate(){const{panel:t,initDone:a}=this.props;a&&!this.eventSubs&&(this.eventSubs=new zt.w0,this.eventSubs.add(t.events.subscribe(K.Wj,this.triggerForceUpdate)))}componentWillUnmount(){this.eventSubs?.unsubscribe()}renderPanel(t,a){const{dashboard:r,panel:s,uiState:i,tableViewEnabled:l,theme:c}=this.props;return e.createElement("div",{className:t.mainPaneWrapper,key:"panel"},this.renderPanelToolbar(t),e.createElement("div",{className:t.panelWrapper},e.createElement(H.Z,null,({width:d,height:p})=>{if(d<3||p<3)return null;if(a&&(p-=c.spacing.gridSize*2),l)return e.createElement(lr,{width:d,height:p,panel:s,dashboard:r});const m=(0,yt.jF)(i.mode,d,p,s);return e.createElement("div",{className:t.centeringContainer,style:{width:d,height:p}},e.createElement("div",{style:m,"data-panelid":s.id},e.createElement(ea.l,{key:s.key,stateKey:s.key,dashboard:r,panel:s,isEditing:!0,isViewing:!1,lazy:!1,width:m.width,height:m.height})))})))}renderPanelAndEditor(t,a){const{panel:r,dashboard:s,plugin:i,tab:l}=this.props,c=ss(l,i),d=c.length===0,p=this.renderPanel(a,d);return c.length===0?e.createElement("div",{className:a.onlyPanel},p):e.createElement(Ft.U,{splitOrientation:"horizontal",maxSize:-200,paneSize:t.topPaneSize,primary:"first",secondaryPaneStyle:{minHeight:0},onDragFinished:m=>{m&&we({topPaneSize:m/window.innerHeight})}},p,e.createElement("div",{className:a.tabsWrapper,"aria-label":E.wl.components.PanelEditor.DataPane.content,key:"panel-editor-tabs"},e.createElement(vn,{key:r.key,panel:r,dashboard:s,tabs:c,onChangeTab:this.onChangeTab})))}renderTemplateVariables(t){const{variables:a}=this.props;return a.length?e.createElement("div",{className:t.variablesWrapper},e.createElement(Bt,{variables:a})):null}renderPanelToolbar(t){const{dashboard:a,uiState:r,variables:s,updateTimeZoneForSession:i,panel:l,tableViewEnabled:c}=this.props;return e.createElement("div",{className:t.panelToolbar},e.createElement(z.Lh,{justify:s.length>0?"space-between":"flex-end",align:"flex-start"},this.renderTemplateVariables(t),e.createElement(X.Stack,{gap:1},e.createElement(ee.x,{label:"Table view",showLabel:!0,id:"table-view",value:c,onClick:this.onToggleTableView,"aria-label":E.wl.components.PanelEditor.toggleTableView}),e.createElement(Xe.S,{value:r.mode,options:V.d7,onChange:this.onDisplayModeChange}),e.createElement(ta.C,{dashboard:a,onChangeTimeZone:i,isOnCanvas:!0}),!r.isPanelOptionsVisible&&e.createElement(Tt,{panel:l}))))}renderEditorActions(){const t=P.v.featureToggles.topnav?"sm":"md";let a=[e.createElement(L.zx,{onClick:this.onDiscard,title:"Undo all changes",key:"discard",size:t,variant:"destructive",fill:"outline"},"Discard"),this.props.panel.libraryPanel?e.createElement(L.zx,{onClick:this.onSaveLibraryPanel,variant:"primary",size:t,title:"Apply changes and save library panel",key:"save-panel"},"Save library panel"):e.createElement(L.zx,{onClick:this.onSaveDashboard,title:"Apply changes and save dashboard",key:"save",size:t,variant:"secondary"},"Save"),e.createElement(L.zx,{onClick:this.onBack,variant:"primary",title:"Apply changes and go back to dashboard","data-testid":E.wl.components.PanelEditor.applyButton,key:"apply",size:t},"Apply")];return this.props.panel.libraryPanel&&(a.splice(1,0,e.createElement(Ge.JY,{key:"unlink-controller"},({showModal:r,hideModal:s})=>e.createElement(qe.h,{onClick:()=>{r(_n.i,{onConfirm:()=>{this.props.panel.unlinkLibraryPanel(),this.forceUpdate()},onDismiss:s,isOpen:!0})},title:"Disconnects this panel from the library panel so that you can edit it regularly.",key:"unlink"},"Unlink"))),a.pop()),a}renderOptionsPane(){const{plugin:t,dashboard:a,panel:r,instanceState:s}=this.props;return t?e.createElement(ar,{plugin:t,dashboard:a,panel:r,instanceState:s,onFieldConfigsChange:this.onFieldConfigChange,onPanelOptionsChanged:this.onPanelOptionsChanged,onPanelConfigChange:this.onPanelConfigChanged}):e.createElement("div",null)}renderToolbar(){return P.v.featureToggles.topnav?e.createElement(jn.A,{actions:e.createElement(Kn.R,{alignment:"right"},this.renderEditorActions())}):e.createElement(kn.X,{title:this.props.dashboard.title,section:"Edit Panel",onGoBack:this.onGoBackToDashboard},this.renderEditorActions())}render(){const{initDone:t,uiState:a,theme:r,sectionNav:s,pageNav:i,className:l,updatePanelEditorUIState:c}=this.props,d=us(r,this.props);return t?e.createElement(C.T,{navModel:s,pageNav:i,"aria-label":E.wl.components.PanelEditor.General.content,layout:x.Qz.Custom,toolbar:this.renderToolbar(),className:l},e.createElement("div",{className:d.wrapper},e.createElement("div",{className:d.verticalSplitPanesWrapper},a.isPanelOptionsVisible?e.createElement(Ft.U,{splitOrientation:"vertical",maxSize:-300,paneSize:a.rightPaneSize,primary:"second",onDragFinished:p=>{p&&c({rightPaneSize:p/window.innerWidth})}},this.renderPanelAndEditor(a,d),this.renderOptionsPane()):this.renderPanelAndEditor(a,d)),this.state.showSaveLibraryPanelModal&&e.createElement(Ke,{panel:this.props.panel,folderUid:this.props.dashboard.meta.folderUid??"",onConfirm:this.onConfirmAndDismissLibarayPanelModel,onDiscard:this.onDiscard,onDismiss:this.onConfirmAndDismissLibarayPanelModel}))):null}}const ds=(0,f.HE)(ls(cs)),us=(0,Zn.B)((n,t)=>{const{uiState:a}=t,r=n.spacing(2);return{wrapper:(0,u.css)({width:"100%",flexGrow:1,minHeight:0,display:"flex",paddingTop:P.v.featureToggles.topnav?n.spacing(2):0}),verticalSplitPanesWrapper:u.css`
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
      position: relative;
    `,mainPaneWrapper:u.css`
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
      padding-right: ${a.isPanelOptionsVisible?0:r};
    `,variablesWrapper:u.css`
      label: variablesWrapper;
      display: flex;
      flex-grow: 1;
      flex-wrap: wrap;
      gap: ${n.spacing(1,2)};
    `,panelWrapper:u.css`
      flex: 1 1 0;
      min-height: 0;
      width: 100%;
      padding-left: ${r};
    `,tabsWrapper:u.css`
      height: 100%;
      width: 100%;
    `,panelToolbar:u.css`
      display: flex;
      padding: 0 0 ${r} ${r};
      justify-content: space-between;
      flex-wrap: wrap;
    `,toolbarLeft:u.css`
      padding-left: ${n.spacing(1)};
    `,centeringContainer:u.css`
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      flex-direction: column;
    `,onlyPanel:u.css`
      height: 100%;
      position: absolute;
      overflow: hidden;
      width: 100%;
    `}});var ms=o(11543),ps=o(81764),gs=o(8861),hs=o(87865);const fs=({annotation:n,events:t,onEnabledChanged:a})=>{const[r,s]=(0,e.useState)(!1),i=(0,f.wW)(vs),l=()=>(0,hs.kt)().cancel(n);return(0,e.useEffect)(()=>{const c=t.getStream(K.z).subscribe({next:p=>{p.payload===n&&s(!0)}}),d=t.getStream(K.RB).subscribe({next:p=>{p.payload===n&&s(!1)}});return()=>{c.unsubscribe(),d.unsubscribe()}}),e.createElement("div",{key:n.name,className:i.annotation},e.createElement(ms.Z,null,e.createElement(ps._,{label:n.name,disabled:r},e.createElement(ee.x,{value:n.enable,onChange:()=>a(n),disabled:r})),e.createElement("div",{className:i.indicator},e.createElement(gs.T,{loading:r,onCancel:l}))))};function vs(n){return{annotation:u.css`
      display: inline-block;
      margin-right: ${n.spacing(1)};

      .fa-caret-down {
        font-size: 75%;
        padding-left: ${n.spacing(1)};
      }

      .gf-form-inline .gf-form {
        margin-bottom: 0;
      }
    `,indicator:u.css`
      align-self: center;
      padding: 0 ${n.spacing(.5)};
    `}}const Es=({annotations:n,onAnnotationChanged:t,events:a})=>{const[r,s]=(0,e.useState)([]);return(0,e.useEffect)(()=>{s(n.filter(i=>i.hide!==!0))},[n]),r.length===0?null:e.createElement(e.Fragment,null,r.map(i=>e.createElement(fs,{events:a,annotation:i,onEnabledChanged:t,key:i.name})))};var bs=o(58252),wt=o(68004),ys=o(18428),Ps=o(29930);const Cs=n=>{const{link:t,linkInfo:a}=n,r=(0,e.useRef)(null),[s,i]=(0,e.useState)("invisible"),[l,c]=(0,e.useState)(0),d=Ss(n,l),p=(0,f.wW)(Rs);return(0,e.useLayoutEffect)(()=>{i(xs(r.current))},[d]),t.asDropdown?e.createElement(bn,{link:t,key:"dashlinks-dropdown","data-testid":E.wl.components.DashboardLinks.dropDown},e.createElement(e.Fragment,null,e.createElement(qe.h,{onClick:()=>c(Date.now()),className:(0,u.cx)("gf-form-label gf-form-label--dashlink",p.button),"data-placement":"bottom","data-toggle":"dropdown","aria-expanded":!!l,"aria-controls":"dropdown-list","aria-haspopup":"menu"},e.createElement(ae.J,{"aria-hidden":!0,name:"bars",className:p.iconMargin}),e.createElement("span",null,a.title)),e.createElement("ul",{id:"dropdown-list",className:`dropdown-menu ${p.dropdown} ${s}`,role:"menu",ref:r},d.length>0&&d.map((m,g)=>e.createElement("li",{role:"none",key:`dashlinks-dropdown-item-${m.uid}-${g}`},e.createElement("a",{role:"menuitem",href:m.url,target:t.targetBlank?"_blank":void 0,rel:"noreferrer","data-testid":E.wl.components.DashboardLinks.link,"aria-label":`${m.title} dashboard`},m.title)))))):e.createElement(e.Fragment,null,d.length>0&&d.map((m,g)=>e.createElement(bn,{link:t,key:`dashlinks-list-item-${m.uid}-${g}`,"data-testid":E.wl.components.DashboardLinks.container},e.createElement("a",{className:"gf-form-label gf-form-label--dashlink",href:m.url,target:t.targetBlank?"_blank":void 0,rel:"noreferrer","data-testid":E.wl.components.DashboardLinks.link,"aria-label":`${m.title} dashboard`},e.createElement(ae.J,{"aria-hidden":!0,name:"apps",style:{marginRight:"4px"}}),e.createElement("span",null,m.title)))))},bn=n=>{const{link:t,children:a,...r}=n;return e.createElement("div",{...r,className:"gf-form"},t.tooltip&&e.createElement(ze.u,{content:t.tooltip},a),!t.tooltip&&e.createElement(e.Fragment,null,a))},Ss=({link:n,dashboardUID:t},a)=>{const{tags:r}=n,s=(0,Te.Z)(()=>Ts(r),[r,a]);return s.value?Ds(t,n,s.value):[]};async function Ts(n,t={getBackendSrv:Ps.i}){return await t.getBackendSrv().search({tag:n,limit:100})}function Ds(n,t,a,r={getLinkSrv:et.Bq,sanitize:wt.Nw,sanitizeUrl:wt.Nm}){return a.filter(s=>s.uid!==n).map(s=>{const i=s.uid,l=r.sanitize(s.title),c=r.getLinkSrv().getLinkUrl({...t,url:s.url}),d=r.sanitizeUrl(c);return{uid:i,title:l,url:d}})}function xs(n){if(!n)return"invisible";const t=n.parentElement.getBoundingClientRect(),a=n.getBoundingClientRect();return a.width===0?"invisible":t.left+a.width+10>window.innerWidth?"pull-left":"pull-right"}function Rs(n){return{iconMargin:(0,u.css)({marginRight:n.spacing(.5)}),dropdown:(0,u.css)({maxWidth:"max(30vw, 300px)",maxHeight:"70vh",overflowY:"auto",a:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}),button:(0,u.css)({color:n.colors.text.primary})}}const Os=({dashboard:n,links:t})=>{const a=(0,nn.N)();return(0,bs.Z)(()=>{const r=n.events.subscribe(tn.md,a);return()=>r.unsubscribe()}),t.length?e.createElement(e.Fragment,null,t.map((r,s)=>{const i=(0,et.Bq)().getAnchorInfo(r),l=`${r.title}-$${s}`;if(r.type==="dashboards")return e.createElement(Cs,{key:l,link:r,linkInfo:i,dashboardUID:n.uid});const c=ys.xy[r.icon],d=e.createElement("a",{className:"gf-form-label gf-form-label--dashlink",href:(0,wt.Nm)(i.href),target:r.targetBlank?"_blank":void 0,rel:"noreferrer","data-testid":E.wl.components.DashboardLinks.link},c&&e.createElement(ae.J,{"aria-hidden":!0,name:c,style:{marginRight:"4px"}}),e.createElement("span",null,i.title));return e.createElement("div",{key:l,className:"gf-form","data-testid":E.wl.components.DashboardLinks.container},r.tooltip?e.createElement(ze.u,{content:i.tooltip},d):d)})):null};class Ms extends e.PureComponent{constructor(){super(...arguments),this.onAnnotationStateChanged=t=>{for(let a=0;a<this.props.dashboard.annotations.list.length;a++){const r=this.props.dashboard.annotations.list[a];if(r.name===t.name){r.enable=!r.enable;break}}this.props.dashboard.startRefresh(),this.forceUpdate()}}render(){const{dashboard:t,variables:a,links:r,annotations:s}=this.props;if(!t.isSubMenuVisible())return null;const i=t.meta.isSnapshot??!1;return e.createElement("div",{className:"submenu-controls"},e.createElement("form",{"aria-label":"Template variables",className:Ns},e.createElement(Bt,{variables:a,readOnly:i})),e.createElement(Es,{annotations:s,onAnnotationChanged:this.onAnnotationStateChanged,events:t.events}),e.createElement("div",{className:"gf-form gf-form--grow"}),t&&e.createElement(Os,{dashboard:t,links:r}))}}const Is=(n,t)=>{const{uid:a}=t.dashboard,r=(0,Ct.AE)(a,n);return{variables:(0,Ct.IV)(a,r.variables)}},Ns=u.css`
  display: flex;
  flex-wrap: wrap;
  display: contents;
`,yn=(0,D.connect)(Is)(Ms);yn.displayName="SubMenu";var ws=o(56130),$s=o(6911),As=o(86977);const Pn=n=>({initPhase:n.dashboard.initPhase,initError:n.dashboard.initError,dashboard:n.dashboard.getModel(),navIndex:n.navIndex}),Ls={initDashboard:Je.mV,cleanUpDashboardAndVariables:As.lw,notifyApp:$.$l,cancelVariables:Ce.wX,templateVarsChangedInUrl:Ce.xs},Us=(0,D.connect)(Pn,Ls);class $t extends e.PureComponent{constructor(){super(...arguments),this.forceRouteReloadCounter=0,this.state=this.getCleanState(),this.updateLiveTimer=()=>{let t;this.props.dashboard?.liveNow&&(t=(0,Le.$t)().timeRange()),$s.A.setLiveTimeRange(t)},this.onAddPanel=()=>{const{dashboard:t}=this.props;if(!t||t.panels.length>0&&t.panels[0].type==="add-panel")return;const a=8;for(const r of t.panelIterator())r.gridPos.y+=a;t.addPanel({type:"add-panel",gridPos:{x:0,y:0,w:12,h:a},title:"Panel Title"}),this.setState({updateScrollTop:0})},this.setScrollRef=t=>{this.setState({scrollElement:t})}}getCleanState(){return{editPanel:null,viewPanel:null,showLoadingState:!1,panelNotFound:!1,editPanelAccessDenied:!1}}componentDidMount(){this.initDashboard(),this.forceRouteReloadCounter=this.props.history.location.state?.routeReloadCounter||0}componentWillUnmount(){this.closeDashboard()}closeDashboard(){this.props.cleanUpDashboardAndVariables(),this.setState(this.getCleanState())}initDashboard(){const{dashboard:t,match:a,queryParams:r}=this.props;t&&this.closeDashboard(),this.props.initDashboard({urlSlug:a.params.slug,urlUid:a.params.uid,urlType:a.params.type,urlFolderUid:r.folderUid,panelType:r.panelType,routeName:this.props.route.routeName,fixUrl:!0,accessToken:a.params.accessToken,keybindingSrv:this.context.keybindings}),setTimeout(this.updateLiveTimer,250)}componentDidUpdate(t,a){const{dashboard:r,match:s,templateVarsChangedInUrl:i}=this.props,l=this.props.history.location.state?.routeReloadCounter;if(r){if(t.match.params.uid!==s.params.uid||l!==void 0&&this.forceRouteReloadCounter!==l){this.initDashboard(),this.forceRouteReloadCounter=l;return}if(t.location.search!==this.props.location.search){const c=t.queryParams,d=this.props.queryParams;(d?.from!==c?.from||d?.to!==c?.to)&&((0,Le.$t)().updateTimeRangeFromUrl(),this.updateLiveTimer()),!c?.refresh&&d?.refresh&&(0,Le.$t)().setAutoRefresh(d.refresh);const p=(0,He.xT)(this.props.queryParams,t.queryParams);p&&i(r.uid,p)}this.state.editPanel&&!a.editPanel&&(O.H.setEditingState(!0),this.props.dashboard?.events.publish(new K.xF(this.state.editPanel.id))),!this.state.editPanel&&a.editPanel&&(O.H.setEditingState(!1),this.props.dashboard?.events.publish(new K.Yr(a.editPanel.id))),this.state.editPanelAccessDenied&&(this.props.notifyApp((0,q.t_)("Permission to edit panel denied")),b.E1.partial({editPanel:null})),this.state.panelNotFound&&(this.props.notifyApp((0,q.t_)("Panel not found")),b.E1.partial({editPanel:null,viewPanel:null}))}}static getDerivedStateFromProps(t,a){const{dashboard:r,queryParams:s}=t,i=s.editPanel,l=s.viewPanel;if(!r)return a;const c={...a};if(!a.editPanel&&i){const d=r.getPanelByUrlId(i);d?r.canEditPanel(d)?(c.editPanel=d,c.rememberScrollTop=a.scrollElement?.scrollTop):c.editPanelAccessDenied=!0:c.panelNotFound=!0}else a.editPanel&&!i&&(c.editPanel=null,c.updateScrollTop=a.rememberScrollTop);if(!a.viewPanel&&l){const d=r.getPanelByUrlId(l);d?(r.initViewPanel(d),c.viewPanel=d,c.rememberScrollTop=a.scrollElement?.scrollTop,c.updateScrollTop=0):c.panelNotFound=!0}else a.viewPanel&&!l&&(r.exitViewPanel(a.viewPanel),c.viewPanel=null,c.updateScrollTop=a.rememberScrollTop);return(a.panelNotFound||a.editPanelAccessDenied&&!i)&&(c.panelNotFound=!1,c.editPanelAccessDenied=!1),zs(t,c)}getInspectPanel(){const{dashboard:t,queryParams:a}=this.props,r=a.inspect;if(!t||!r)return null;const s=t.getPanelById(parseInt(r,10));return s||null}render(){const{dashboard:t,initError:a,queryParams:r}=this.props,{editPanel:s,viewPanel:i,updateScrollTop:l,pageNav:c,sectionNav:d}=this.state,p=(0,_.U)(this.props.queryParams);if(!t||!c||!d)return e.createElement(le.B,{initPhase:this.props.initPhase});const m=this.getInspectPanel(),g=!s&&!p&&!this.props.queryParams.editview,y=p!==B.KioskMode.Full&&!r.editview&&e.createElement("header",{"data-testid":E.wl.pages.Dashboard.DashNav.navV2},e.createElement(Me.t,{dashboard:t,title:t.title,folderTitle:t.meta.folderTitle,isFullscreen:!!i,onAddPanel:this.onAddPanel,kioskMode:p,hideTimePicker:t.timepicker.hidden,shareModalActiveTab:this.props.queryParams.shareView})),v=(0,u.cx)({"panel-in-fullscreen":Boolean(i),"page-hidden":Boolean(r.editview||s)});return e.createElement(e.Fragment,null,e.createElement(C.T,{navModel:d,pageNav:c,layout:x.Qz.Canvas,toolbar:y,className:v,scrollRef:this.setScrollRef,scrollTop:l},e.createElement(U,{dashboard:t}),a&&e.createElement(pe.u,null),g&&e.createElement("section",{"aria-label":E.wl.pages.Dashboard.SubMenu.submenu},e.createElement(yn,{dashboard:t,annotations:t.annotations.list,links:t.links})),e.createElement(ws.Z,{dashboard:t,isEditable:!!t.meta.canEdit,viewPanel:i,editPanel:s}),m&&e.createElement(Gn,{dashboard:t,panel:m})),s&&e.createElement(ds,{dashboard:t,sourcePanel:s,tab:this.props.queryParams.tab,sectionNav:d,pageNav:c}),r.editview&&e.createElement(k.D,{dashboard:t,editview:r.editview,pageNav:c,sectionNav:d}))}}$t.contextType=A.h;function zs(n,t){const{dashboard:a}=n;if(!a)return t;let r=t.pageNav,s=t.sectionNav;(!r||a.title!==r.text)&&(r={text:a.title,url:w.u.getUrlForPartial(n.history.location,{editview:null,editPanel:null,viewPanel:null})});const{folderTitle:i,folderUid:l}=a.meta;if(i&&l&&r&&r.parentItem?.text!==i&&(r={...r,parentItem:{text:i,url:`/dashboards/f/${a.meta.folderUid}`}}),n.route.routeName===B.DashboardRoutes.Path){s=(0,j.getRootContentNavModel)();const c=(0,j.getPageNavFromSlug)(n.match.params.slug);c?.parentItem&&(c.parentItem=c.parentItem)}else s=(0,G.ht)(n.navIndex,P.v.featureToggles.topnav?"dashboards/browse":"dashboards");return(t.editPanel||t.viewPanel)&&(r={...r,text:`${t.editPanel?"Edit":"View"} panel`,parentItem:r,url:void 0}),t.pageNav===r&&t.sectionNav===s?t:{...t,pageNav:r,sectionNav:s}}const At=(0,f.HE)($t);At.displayName="DashboardPage";const Fs=Us(At)},66959:(me,F,o)=>{o.r(F),o.d(F,{default:()=>f});var u=o(68404),e=o(58252),D=o(35645),x=o(35287),w=o(87513),E=o(25e3),b=o(81168),P=o(53051);function f($){const C=(0,b.useDispatch)();(0,e.Z)(()=>{C((0,E.bZ)())});const{hasDatasource:A,loading:q}=(0,b.useSelector)(j=>({hasDatasource:j.dataSources.dataSourcesCount>0,loading:!j.dataSources.hasFetched})),[_,G]=(0,u.useState)(!1);return A||_||!D.v.featureToggles.datasourceOnboarding?u.createElement(P.default,{...$}):u.createElement(w.O,{onCTAClick:()=>G(!0),loading:q,title:(0,x.t)("datasource-onboarding.welcome","Welcome to Grafana dashboards!"),CTAText:(0,x.t)("datasource-onboarding.sampleData","Or set up a new dashboard with sample data"),navId:"dashboards/browse",pageNav:{text:(0,x.t)("datasource-onboarding.new-dashboard","New dashboard"),url:"/dashboard/new"}})}},81704:(me,F,o)=>{o.r(F),o.d(F,{default:()=>E});var u=o(68404),e=o(86647),D=o(37932),x=o(79396),w=o(87464);function E(b){const[P,f]=(0,u.useState)(null),{datasourceUid:$}=b.match.params;return(0,u.useEffect)(()=>{const C=(0,e.F)().getInstanceSettings($);if(!C){f("Data source not found");return}const A=(0,w.ZQ)(),{dashboard:q}=A;q.panels[0]={...q.panels[0],datasource:{uid:C.uid,type:C.type}},(0,w.$M)(A),D.E1.replace("/dashboard/new")},[$]),P?u.createElement(x.T,{navId:"dashboards"},u.createElement(x.T.Contents,null,u.createElement("div",null,'Data source with UID "',$,'" not found.'))):null}},60265:(me,F,o)=>{o.r(F),o.d(F,{StorageFolderPage:()=>$,default:()=>q,getPageNavFromSlug:()=>C,getRootContentNavModel:()=>A});var u=o(68404),e=o(22350),D=o(35645),x=o(72948),w=o(39904),E=o(67487),b=o(45253),P=o(79396),f=o(63163);function $(_){const G=_.match.params.slug??"",O=(0,e.Z)(()=>(0,f.$)().list("content/"+G),[G]),j=G.length>0?`g/${G}/`:"g/",B=C(G),K=()=>O.value?O.value.fields[0].values.toArray().map(Me=>{let pe=Me;const le=pe.indexOf(".")<0,ne=!le&&pe.endsWith(".json"),ge=`${j}${pe}`;return u.createElement(x.Z,{key:pe,href:le||ne?ge:void 0},u.createElement(x.Z.Heading,null,pe),u.createElement(x.Z.Figure,null,u.createElement(w.J,{name:le?"folder":ne?"gf-grid":"file-alt",size:"sm"})))}):O.loading?u.createElement(E.$,null):u.createElement("div",null,"?"),Ce=A();return u.createElement(P.T,{navModel:Ce,pageNav:B},!D.v.featureToggles.topnav&&u.createElement("div",null,u.createElement(b.b,{title:"Enable the topnav feature toggle"},"This page is designed assuming topnav is enabled")),K())}function C(_){const G=_.split("/");let O=[],j="g",B;for(let K=0;K<G.length;K++)j+=`/${G[K]}`,O.push({text:G[K],url:j,parentItem:B}),B=O[O.length-1];return B}function A(){return{main:{text:"C:"},node:{text:"Content",url:"/g"}}}const q=$},92465:(me,F,o)=>{o.d(F,{M:()=>E});var u=o(68404),e=o(89890),D=o(85854),x=o(53217);const w=(b,P,f)=>{if(!f)return;let $=b.find(C=>!P.some(A=>C===A));if($)return $},E=({value:b,context:P,onChange:f,item:$})=>{const C=(0,u.useMemo)(()=>P.data.map(O=>({value:O.refId,label:`Query: ${O.refId} (size: ${O.length})`,description:O.fields.map(j=>(0,e.C)(j)).join(", ")})),[P.data]),[A,q]=(0,u.useState)({refIds:[],value:void 0}),_=(0,u.useMemo)(()=>C.find(O=>O.value===b?.options)??w(C,A.refIds,A.value),[b,C,A]),G=(0,u.useCallback)(O=>{f(O?.value?{id:D.E4.byRefId,options:O.value}:void 0)},[f]);return(C!==A.refIds||_?.value!==A.value)&&q({refIds:C,value:_?.value}),u.createElement(x.Ph,{options:C,onChange:G,isClearable:!0,placeholder:"Change filter",value:_})}}}]);

//# sourceMappingURL=DashboardPage.74bb325f53d47878b2e2.js.map